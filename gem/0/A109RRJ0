ç™¼ä¿¡äºº: wens.bbs@processor.tfcis.org (ã€€) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [ä¿®æ­£] åœ¨ BBS ä¸Šè¨­å®šè½‰ä¿¡
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2004/05/01 Sat 20:58:40)                Updated: 2004/10/23

ä»Šå¤©æ¸¬è©¦éäº†  å¯ä»¥ç”¨
TIMEOUTçš„å–®ä½æ˜¯ç§’
è‹¥TIMEOUTç§’å¾Œæœªèƒ½é€£ç·š å°±é€£ç·šå¤±æ•—
é€™æ¯”ç­‰æ ¸å¿ƒtimeoutè¦ä¾†çš„å¿«

: bbslink.c æ–°å¢é€™ä¸€æ®µæ–¼ inetclient() å‰é¢

#include <setjmp.h>

static sigjmp_buf timeout_env;

static void
abort_timeout(sig)
  int sig;
{
  siglongjmp(timeout_env, -1);
}

: bbslink.c:inetclient()

  /* Allocate a socket */
  fd = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);
  if (fd < 0)
    return -1;

+ signal(SIGALRM, abort_timeout);
+ if (sigsetjmp(timeout_env, 1) != 0)
+ {
+   signal(SIGALRM, SIG_DFL);
+   return -1;
+ }
+ alarm(10);        /* 10 ç§’å¾Œ timeout */

  /* Connect the socket to the server */
  if (connect(fd, (struct sockaddr *) & sin, sizeof(sin)) < 0)
  {
    close(fd);
    return -1;
  }

+ signal(SIGALRM, SIG_DFL);
+ alarm(0);

  return fd;

--
 [1;43mâ•­[46mâ”¼[m Or[1mig[30min[m: [41m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [32;47m processor.tfcis.org [m
 [1;44mâ”¼[41mâ•¯[m A[1mut[30mho[mr: [1;33mwens [30må¾ [35m220-134-246-97.hinet-ip.hinet.net [30mç™¼è¡¨[m
