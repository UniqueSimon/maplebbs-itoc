ç™¼ä¿¡äºº: itoc.bbs@cpu.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [å•é¡Œ] ç”¨æ”¯ç¥¨ç™¼çµ¦å…¨ç«™çé‡‘
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2005/04/18 Mon 08:40:31)                Updated: 2005/04/22

â€» å¼•è¿°ã€Šjcw (å¤œç©ºä¸‹çš„å‚‘è¥¿)ã€‹ä¹‹éŠ˜è¨€ï¼š
> çˆ¬æ–‡æœ‰æ‰¾åˆ°ä»¥ transacct ç›´æ¥åŠ éŒ¢çš„æ–¹æ³•
> å¯æ˜¯æƒ³èªªæ—¢ç„¶å·²ç¶“æœ‰æ”¯ç¥¨é€™éº¼æ–¹ä¾¿çš„æ±è¥¿
> å°±åƒå…¨ç«™é€šå‘Šä¸€æ¨£çš„ç°¡ä¾¿æ–¹æ³•
> èƒ½ç”¨æ”¯ç¥¨ç™¼éŒ¢çµ¦å…¨ç«™ä½¿ç”¨è€…å—ï¼Ÿ

: util/Makefile

EXE =   ... give_paycheck

: util/give_paycheck.c æ–°å¢æ­¤ç¨‹å¼

/*-------------------------------------------------------*/
/* util/give_paycheck.c ( NTHU CS MapleBBS Ver 3.10 )    */
/*-------------------------------------------------------*/
/* target : ç™¼çµ¦å…¨ç«™ä½¿ç”¨è€…æ”¯ç¥¨                           */
/* create : 05/04/18                                     */
/* update :   /  /                                       */
/* author : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/


#if 0

  çµ¦ itoc ä¸€å¼µ 100 éŠ€ 200 é‡‘ çš„æ”¯ç¥¨
  % ~/bin/give_paycheck 100 200 itoc

  çµ¦ sysop ä¸€å¼µ 100 éŠ€ 0 é‡‘ çš„æ”¯ç¥¨
  % ~/bin/give_paycheck 100 0 sysop

  çµ¦å…¨ç«™ä½¿ç”¨è€…å„ä¸€å¼µ 50 éŠ€ 30 é‡‘ çš„æ”¯ç¥¨
  % ~/bin/give_paycheck 50 30

  çµ¦å…¨ç«™ä½¿ç”¨è€…æ”¯ç¥¨è¦åŸ·è¡Œä¸€æ®µæ™‚é–“ï¼Œè«‹è€å¿ƒç­‰å€™

#endif


#include "bbs.h"


int
main(argc, argv)
  int argc;
  char *argv[];
{
  int money, gold;
  char c, *str, buf[64];
  struct dirent *de;
  DIR *dirp;
  PAYCHECK paycheck;

  if (argc == 3 || argc == 4)
  {
    money = atoi(argv[1]);
    gold = atoi(argv[2]);
    if (money < 0 || gold < 0)
      printf("money and gold should not be negative.\n");
  }
  else
  {
    printf("Usage: %s money gold [userid]\n", argv[0]);
    return -1;
  }

  memset(&paycheck, 0, sizeof(PAYCHECK));
  time(&paycheck.tissue);
  paycheck.money = money;
  paycheck.gold = gold;
  strcpy(paycheck.reason, "[ç™¼éŒ¢] ç«™é•·");

  if (argc == 4)
  {
    chdir(BBSHOME);
    usr_fpath(buf, argv[3], FN_PAYCHECK);
    rec_add(buf, &paycheck, sizeof(PAYCHECK));
    return 0;
  }

  for (c = 'a'; c <= 'z'; c++)
  {
    sprintf(buf, BBSHOME "/usr/%c", c);
    chdir(buf);

    if (!(dirp = opendir(".")))
      continue;

    while (de = readdir(dirp))
    {
      str = de->d_name;
      if (*str <= ' ' || *str == '.')
        continue;

      sprintf(buf, "%s/" FN_PAYCHECK, str);
      rec_add(buf, &paycheck, sizeof(PAYCHECK));
    }

    closedir(dirp);
  }

  return 0;
}


--
 [1;43mâ—¤[46mâ—¥[m Or[1mig[30min[m: [41m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [36;47m cpu.tfcis.org [m
 [1;45mâ–‚[42mâ–ˆ[m [1mMo[30mdi[mfy: [1;35m2005/04/18 Mon 08:41:30[m
