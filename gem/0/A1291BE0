ç™¼ä¿¡äºº: TKyo.bbs@cpu.tfcis.org (æš—é»‘è²´å…¬å­) çœ‹æ¿: plan
æ¨™  é¡Œ: [æ›´æ–° 2]PTT's pmore.c åŠŸèƒ½ patch for M3 more.c
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2006/06/14 Wed 22:46:50)                Updated: 2006/06/16

[å‰ç‰ˆå‰è¨€]

  1.å‰µä½œæœ¬åŠŸèƒ½å‰, å·²ç¶“å…ˆè¡ŒçŸ¥æœƒ PTT (æ‰¹è¸¢è¸¢å¯¦æ¥­åŠ) BBS ç«™é•· in2
    ä¸¦ç²å¾—ä»–å…è¨± "å‰µæ„å‰µä½œ" è€Œå¾Œ, è‡ªè¡Œä¾ç…§å…¶åŠŸèƒ½é¢æ­é…åŸæœ¬ more.c ç¨‹å¼ç¢¼å‰µä½œ
    ä¸”æœªåƒè€ƒ pmore.c ä»»ä½•ç¨‹å¼ç¢¼

  2.å‰µä½œæœ¬åŠŸèƒ½å¾Œ, ä¹Ÿå·²ç¶“çŸ¥æœƒ PTT (æ‰¹è¸¢è¸¢å¯¦æ¥­åŠ) BBS pmore.c åŸå‰µè€… piaip
    ä¸¦ç²å¾—ä»–å…è¨±, å°‡ patch åŸå§‹ç¢¼äº¤ç”± itoc å…¬ä½ˆ

[æœ¬æ¿å‰è¨€]

  æœ¬æ¬¡æ›´æ–°ç‰ˆæœ¬, [1;33må®Œå…¨å–ä»£[må…ˆå‰ç™¼è¡¨ä¹‹ç‰ˆæœ¬

[åŠŸèƒ½é¢ç°¡ä»‹]

  a.æŒ‰éµ :
                   [1;32mTab[m - å‘å³ç¿»é–±ä¸€æ¬¡ 4 åˆ—
         [1;32mShift+Tab[m/[1;32mZ[m/[1;32mz[m - å‘å·¦ç¿»é–±ä¸€æ¬¡ 4 åˆ—
                   [1;32m.[m/[1;32m>[m - å‘å³ç¿»é–±ä¸€æ¬¡ 1 åˆ— (ç¬¬ä¸€æ¬¡ç§»å‹• 2 åˆ—)
                   [1;32m,[m/[1;32m<[m - å‘å·¦ç¿»é–±ä¸€æ¬¡ 1 åˆ—

  b.ç¬¬ä¸€æ¬¡æŒ‰ [1;32m.[m å‘å³ç¿»é–±æ™‚, ç”±æ–¼æœ‰ [1;37m<[m æç¤ºç¬¦è™Ÿçš„é—œä¿‚
    å¦‚æœåªç§»å‹• 1 åˆ—çš„è©±, æœƒè®“ä½¿ç”¨è€…æ„Ÿè¦ºä¸å‡ºä¾†ç•«é¢æœ‰åœ¨ç§»å‹•, å› æ­¤æ‰ç§»å‹• 2 åˆ—

  c.PCMan/KKMan(å°šæœªå¯¦é©—) ä¸æ”¯æ´ Shift+Tab æŒ‰éµ, æœƒèª¤åˆ¤ç‚º Tab æŒ‰éµ
    è«‹ç”¨ [1;32mz[m å’Œ [1;32mZ[m æ›¿ä»£

[æœ¬æ¬¡æ›´æ–°]

  1.ç•¶ "ä¸€è¡Œå­—æ•¸ > 80 è¡Œ" æ™‚, ç•«é¢å†æ¬¡æ•´ç†å‹•æ…‹ç§»å‹•åŠç‰¹åˆ¥é¡¯ç¤º

    ç‰¹åˆ¥é¡¯ç¤º (Header å€åŸŸä¾‹å¤–)

      '\' - ç‚ºè‡ªå‹•æ–·è¡Œç¬¦è™Ÿ
      '>' - æ–‡ç« ä½ç§»å¾Œ, è¡¨ç¤ºå°šæœ‰æ–‡ç« æœªé¡¯ç¤º

  2.ä¿®æ­£ :

      æ“·å– Header è³‡è¨Šæ™‚, åŸå…ˆä½¿ç”¨ f_map() æ–¹å¼, <== æµªè²»äº†å¤ªå¤šæ™‚é–“
      æ•…æ”¹ç‚ºä½¿ç”¨ä¸€èˆ¬æª”æ¡ˆ I/O æ–¹å¼, å¾—çŸ¥æ˜¯å¦æœ‰ Header, ä¸¦é©æ™‚æ’å…¥åˆ†éš”ç·š

      å…¶ä»–é¡å¤–ä¿®æ­£

------------------------------------------------------------------------------
:src/include/global.h

  #define KEY_TAB   9   /* å’Œ Ctrl('I') ç›¸åŒ */
+ #define KEY_STAB  90  /* å’Œ Z ç›¸åŒ */

  #define QUOTE_CHAR1   '>'
  #define QUOTE_CHAR2   ':'
+ #define QUOTE_CHAR3   '='
+ #define QUOTE_CHAR4   '<'
+ #define QUOTE_CHAR5   '\\'


/* æ–°æ¿æœ¬å·²å°‡ LINE_HEADER æ¬ç§»è‡³ global.h
   çµ¦ more.c/bhttpd.c ä½¿ç”¨ */

+ #define LINE_HEADER   3   /* æª”é ­æœ‰ä¸‰è¡Œ */
+ #define STR_HEADER  {"ä½œè€…", "æ¨™é¡Œ", "æ™‚é–“"}
+ #define STR_HEADER2 {"ç™¼ä¿¡äºº", "æ¨™  é¡Œ", "ç™¼ä¿¡ç«™"}

------------------------------------------------------------------------------
:scr/include/theme.h

- #define FOOTER_MORE \
- COLOR1 " ç€è¦½ P.%d (%d%%) " COLOR2 " (h)èªªæ˜ [PgUp][PgDn][0][$]ç§»å‹•" \
- " (/n)æœå°‹ (C)æš«å­˜ (â†q)çµæŸ "

+ #define FOOTER_MORE \
+ COLOR1 " ç€è¦½ P.%d (%d%%) " COLOR2 " (/n)æœå°‹ (h)èªªæ˜ (â†/q)é›¢é–‹%*s" \
+ "â•‘åˆ—ï¼š%d - %dâ”‚è¡Œï¼š%d - %dâ•‘ "

+ /* ----------------------------------------------------- */
+ /* æ–‡ç« é–±è®€é¡è‰²                                          */
+ /* ----------------------------------------------------- */

+ #define COLOR_MORE_MASK   "\033[7m"    /* æ¯”å°æ­£ç¢º Color */
+ #define COLOR_MORE_OFFSET "\033[1;37m" /* ç‰¹åˆ¥é¡¯ç¤ºç¬¦è™Ÿé¡è‰² */
+ #define COLOR_MORE_QUOTE  "\033[1;32m" /* ç¬¬ä¸€å±¤ QUOTE é¡è‰² 1 */
+ #define COLOR_MORE_QUOTE2 "\033[35m"   /* ç¬¬äºŒå±¤ QUOTE é¡è‰² 2 */
+ #define COLOR_MORE_QUOTE3 "\033[32m"   /* ç¬¬ä¸‰å±¤ QUOTE é¡è‰² 3 */

------------------------------------------------------------------------------
:src/maple/visio.c

/*
   æ–°å¢å…©å‡½å¼ outa() å’Œ outax()

   outa() - åŸå…ˆè¨­è¨ˆçµ¦å…‰æ£’ä»‹é¢ä¸­æ–‡æ­£ç¢ºæ–·è¡Œä½¿ç”¨
   outax() - è¨­è¨ˆçµ¦ more.c å°ˆç”¨, æ”¯æ´ä¸­æ–‡æ­£ç¢ºæ–·è¡ŒåŠç‰¹æ®Š Ansi Code
             ä¸¦å›å‚³è©²è¼¸å‡ºå¤šå°‘ space

   å› æ‡‰ outax(), æ›´æ–° outx(), æ–°å¢ out_extend_ansi_char() çµ¦å…©å‡½å¼å…±ç”¨å‡½å¼
*/

#ifdef SHOW_USER_IN_TEXT

static int
out_extend_ansi_char(ch)
  uschar ch;
{
  char buf[20];

  switch (ch)
  {
    case 's':           /* **s é¡¯ç¤º ID */
      sprintf(buf, "%s", cuser.userid);
      break;

    case 'n':           /* **n é¡¯ç¤ºæš±ç¨± */
      sprintf(buf, "%s", cuser.username);
      break;

    case 'l':           /* **l é¡¯ç¤ºä¸Šç«™æ¬¡æ•¸ */
      sprintf(buf, "%d", cuser.numlogins);
      break;

    case 'p':           /* **p é¡¯ç¤ºç™¼æ–‡æ¬¡æ•¸ */
      sprintf(buf, "%d", cuser.numposts);
      break;

    case 'g':           /* **g é¡¯ç¤ºé‡‘å¹£ */
      sprintf(buf, "%d", cuser.gold);
      break;

    case 'm':           /* **m é¡¯ç¤ºéŠ€å¹£ */
      sprintf(buf, "%u", cuser.money);
      break;

    case 't':           /* **t é¡¯ç¤ºæ—¥æœŸ */
      sprintf(buf, "%s", Now());
      break;

    case 'u':           /* **u é¡¯ç¤ºç·šä¸Šäººæ•¸ */
      sprintf(buf, "%d", total_user);
      break;

    case 'b':           /* **b é¡¯ç¤ºç«™å */
      sprintf(buf, "%s", BBSNAME);
      break;

    default:
      *buf = '\0';
  }

  if (*buf)
  {
    outs(buf);

    return strlen(buf);
  }
  else
    return 0;
}

void
outx(str)
  uschar *str;
{
  int ch;

  while (ch = *str)
  {
    /* itoc.020301: ESC + * + s ç­‰æ§åˆ¶ç¢¼ */
    if (ch == KEY_ESC && str[1] == '*')
    {
      if (out_extend_ansi_char(str[2]))
      {
        str += 3;
        continue;
      }
    }
    outc(ch);
    str++;
  }
}

char
outax(str, max)
  uschar *str;
  int max;
{
  uschar old_ch, ch;
  char *ptr, ret;
  char ansi_buf[80];                          /* é›™è‰²å­—ç·©è¡å€ */
  int len, in_ansi, in_chi, i;

  in_chi = in_ansi = len = ret = i = 0;
  *ansi_buf = '\0';

  ptr = str;

  while ((ch = *ptr++))
  {
    if (in_ansi)
    {
      if (!(strchr(STR_ANSICODE, ch)))
      {
        in_ansi = 0;

        if (i)
          ansi_buf[i++] = ch;
      }
    }
    else
    {
      if (ch == KEY_ESC)
      {
        in_ansi = 1;

        if (*ptr == '*')
        {
          in_ansi = out_extend_ansi_char(ptr[1]);

          if (in_ansi)
          {
            len += in_ansi;
            ptr += 2;
            in_ansi = 0;
            continue;
          }
        }
      }
      else
      {
        if (in_chi || IS_ZHC_HI(ch))
        {
          in_chi ^= 1;
          if (in_chi)
            old_ch = ch;
          else
          {
            outc(old_ch);

            if (i)
            {
              ansi_buf[i] = '\0';
              outs(ansi_buf);
              i = 0;
              *ansi_buf = '\0';
            }
          }
        }

        len++;
      }
    }

    if (in_chi && in_ansi)
      ansi_buf[i++] = ch;
    else if (!(in_chi))
      outc(ch);

    if (len >= max)
    {
      if (in_ansi || (*ptr == KEY_ESC))
        continue;

      /* è§£æ±º '>' èª¤åˆ¤å•é¡Œ, åŠ ANSI Code */
      if (*(ptr + 1) == '\0' || *(ptr + 1) == KEY_ESC)
        continue;

      ret++;

      if (in_chi)
        ret++;

      break;
    }
  }

  return ret;
}

char
outa(str, max, end)
  uschar *str;
  int max;
  int end;
{
  uschar old_ch, ch;
  char *ptr, ret;
  int len, in_ansi, in_chi;

  in_chi = in_ansi = len = ret = 0;
  ptr = str;

  while ((ch = *ptr++))
  {
    if (in_chi || IS_ZHC_HI(ch))
      in_chi ^= 1;

    if (in_ansi)
    {
      if (!(strchr(STR_ANSICODE, ch)))
        in_ansi = 0;
    }
    else
    {
      if (ch == KEY_ESC)
        in_ansi = 1;
      else if (++len >= max)
        break;
    }
  }

  if (ch)
  {
    old_ch = *ptr;
    *ptr = '\0';
  }

  max = (in_chi) ? max - 1 : max;

  prints("%-*.*s", max, max, str);

  if (ch)
    *ptr = old_ch;

  if (in_chi)
  {
    outc(' ');
    ret++;
  }

  if (end)
    outs(str_ransi);

  return ret;
}

------------------------------------------------------------------------------
:src/maple/more.c

+ typedef struct MORELINE
+ {
+   char data[ANSILINELEN];
+   char auto_break_flag;     /* 0: ç„¡æ›è¡Œ, 1: æœ‰æ›è¡Œ */
+   int more_offset;          /* ç•«é¢åç§»å€¼ */
+   int b_cols;               /* bottom columns length */
+ #ifdef SLIDE_SHOW
+   int slideshow;            /* !=0: æ’¥æ”¾ movie çš„é€Ÿåº¦ */
+ #endif
+   off_t header_offset;      /* Header å€åŸŸ */
+ }        MORELINE;


static uschar *fimage;      /* file image begin */
static uschar *fend;        /* file image end */
static uschar *foff;        /* ç›®å‰è®€åˆ°å“ªè£¡ */
+ static uschar *flast;     /* last page start offset address*/

------------------------------------------------------------------------------
:src/maple/more.c - more_slideshow()

/* å› æ‡‰æœ¬æ¬¡æ›´æ–°ä¿®æ­£ */

static int
more_slideshow(moreline)
  MORELINE *moreline;
{
  int ch;

  if (moreline->slideshow == 0)
  {
    ch = vkey();

    if (ch == '@')
    {
      moreline->slideshow =
        vans("è«‹é¸æ“‡æ”¾æ˜ çš„é€Ÿåº¦ 1(æœ€æ…¢)ï½9(æœ€å¿«)ï¼Ÿæ’¥æ”¾ä¸­æŒ‰ä»»æ„éµå¯åœæ­¢æ’¥æ”¾ï¼š")
        - '0';
      if (moreline->slideshow < 1 || moreline->slideshow > 9)
        moreline->slideshow = 5;

      ch = KEY_PGDN;
    }
  }
  else
  {
    struct timeval tv[9] =
    {
      {4, 0}, {3, 0}, {2, 0}, {1, 500000}, {1, 0},
      {0, 800000}, {0, 600000}, {0, 400000}, {0, 200000}
    };

    refresh();
    ch = 1;
    if (select(1, (fd_set *) &ch, NULL, NULL,
      tv + moreline->slideshow - 1) > 0)
    {
      /* è‹¥æ’¥æ”¾ä¸­æŒ‰ä»»æ„éµï¼Œå‰‡åœæ­¢æ’¥æ”¾ */
      moreline->slideshow = 0;
      ch = vkey();
    }
    else
    {
      ch = KEY_PGDN;
    }
  }

  return ch;
}

------------------------------------------------------------------------------
:src/maple/more.c - more_line()

/*
   mode = 0 : ä¸€èˆ¬æ¨¡å¼
   mode = 1 : Get Offset
*/

static int
more_line(moreline, fsrc, mode)
  MORELINE *moreline;
  uschar *fsrc;
  char mode;
{
  int len, bytes, in_ansi, in_chi;
  uschar ch, *offset;
  char *buf, no_auto_break;

  len = bytes = in_ansi = in_chi = moreline->auto_break_flag = 0;
  offset = fsrc;

  if (offset <= fimage + moreline->header_offset)
    no_auto_break = 1;
  else
    no_auto_break = moreline->more_offset;

  if (mode == 0)
    buf = moreline->data;
  for (;;)
  {
    if (offset >= fend)
      break;

    ch = *offset;

    offset++;
    bytes++;

    if (ch == '\n')
      break;

    if (in_ansi)
    {
      if (!(strchr(STR_ANSICODE, ch)))
        in_ansi = 0;
    }
    else
    {
      if (ch == KEY_ESC)
        in_ansi = 1;
      else
      {
        if (isprint2(ch))
        {
          if (in_chi || IS_ZHC_HI(ch))
            in_chi ^= 1;
        }
        else
          ch = ' ';     /* å°å‡ºä¸ä¾†çš„éƒ½æ›æˆç©ºç™½ */

        len++;
      }
    }

    if (mode == 0)
      *buf++ = ch;

    /* è‹¥ä¸å«æ§åˆ¶ç¢¼çš„é•·åº¦å·²é” b_cols å­—ï¼Œæˆ–å«æ§åˆ¶ç¢¼çš„é•·åº¦å·²é” ANSILINELEN-1
       ï¼Œé‚£éº¼é›¢é–‹è¿´åœˆ */

    if ((bytes >= ANSILINELEN - 1) ||
      (no_auto_break == 0 && (len >= moreline->b_cols)))
    {
      /* itoc.031123: å¦‚æœæ˜¯æ§åˆ¶ç¢¼ï¼Œå³ä½¿ä¸å«æ§åˆ¶ç¢¼çš„é•·åº¦å·²é” b_cols äº†
         ï¼Œé‚„å¯ä»¥ç¹¼çºŒåƒ */
      if ((in_ansi || (offset < fend && *offset == KEY_ESC)) &&
        bytes < ANSILINELEN - 1)
        continue;

      /* itoc.031123: å†æª¢æŸ¥ä¸‹ä¸€å€‹å­—æ˜¯ä¸æ˜¯ '\n'ï¼Œé¿å…æ°å¥½æ˜¯ b_cols æˆ–
         ANSILINELEN-1 æ™‚ï¼Œæœƒå¤šè·³ä¸€è¡Œç©ºç™½è¡Œ */
      if (offset < fend && *offset == '\n')
      {
        offset++;
        bytes++;
      }
      /* å› æ‡‰ PTT 80 è¡Œé¡¯ç¤º (moreline->b_cols ç‚º 79, å¯åˆªé™¤æ­¤åˆ¤æ–·) */
      else if (offset < fend && (*(offset + 1) == '\n' || *(offset + 1) == KEY_ESC))
        continue;
      else
      {
        if (in_chi)
        {
          offset--;
          bytes--;
          buf--;
        }

        if (no_auto_break == 0)
        {
          moreline->auto_break_flag++;

          if (in_chi)
            moreline->auto_break_flag++;
        }
      }

      break;
    }
  }

  if (mode == 0)
  {
    *buf = '\0';
    foff = offset;
  }

  return bytes;
}

------------------------------------------------------------------------------
:src/maple/more.c - outs_line()

/* ä¿®æ”¹å¹…åº¦å¤§, è«‹æ•´å€‹å‡½å¼æ›æ‰ */

static int
outs_line(moreline)     /* å°å‡ºä¸€èˆ¬å…§å®¹ */
  MORELINE *moreline;
{
  int ch1, ch2, ch3, ansi, curr_offset, in_ansi, in_chi;
  char *str, *ptr, last_ansi_code[40], num_ch_space;
  char buf[ANSILINELEN];
  off_t ret;

  /* â€»è™•ç†å¼•ç”¨è€… & å¼•è¨€ */

  ptr = str = moreline->data;

  ch1 = str[0];
  ch2 = str[1];
  ch3 = str[2];
  last_ansi_code[0] = '\0';

  if ((ch1 == '\241' && ch2 == '\260') ||   /* â€» ==> å¼•è¨€è€… */
    (ch1 == QUOTE_CHAR3 && ch2 == QUOTE_CHAR3 && ch3 == QUOTE_CHAR1))
  {
    ansi = 1;
    strcpy(last_ansi_code, COLOR_MORE_QUOTE);
    outs(last_ansi_code);
  }
  /* å¼•è¨€ */
  else if ((ch2 == ' ') && (ch1 == QUOTE_CHAR1 || ch1 == QUOTE_CHAR2))
  {
    ansi = 1;
    strcpy(last_ansi_code, (ch3 == QUOTE_CHAR1 || ch3 == QUOTE_CHAR2) ?
      COLOR_MORE_QUOTE2 : COLOR_MORE_QUOTE3);
    outs(last_ansi_code);   /* å¼•ç”¨ä¸€å±¤/äºŒå±¤ä¸åŒé¡è‰² */
  }
  else
    ansi = 0;

  /* è¨ˆç®—åç§»åŠå–å¾—æœ€å¾Œ ANSI Code*/

  if (moreline->more_offset)
  {
    curr_offset = in_ansi = in_chi = ch2 = 0;

    prints(COLOR_MORE_OFFSET "%c%s%s", QUOTE_CHAR4, str_ransi,
     (ansi) ? last_ansi_code : "");

    while (ch1 = *ptr)
    {
      if (ch1 == KEY_ESC)
      {
        last_ansi_code[ch2++] = ch1;
        ansi = in_ansi = 1;
      }
      else if (in_ansi)
      {
        if (!strchr(STR_ANSICODE, ch1))
          in_ansi = 0;

        last_ansi_code[ch2++] = ch1;
        last_ansi_code[ch2] = '\0';

        if (in_ansi == 0)
        {
          outs(last_ansi_code);
          ch2 = 0;
        }
      }
      else
      {
        if (moreline->more_offset == curr_offset)
          break;

        if (in_chi || IS_ZHC_HI(ch1))
          in_chi ^= 1;

        curr_offset++;
      }
      ptr++;
    }

    if (in_chi)
      ptr++;
  }

  ret = ptr - str;

  /* å°å‡ºå…§å®¹ */

  if (hunt[0])
  {
    int len;
    char *ptr1, *ptr2;

    len = strlen(hunt);
    ptr2 = buf;

    while (1)
    {
      if (!(ptr1 = (char *) str_sub(ptr, hunt)))
      {
        strcpy(ptr2, ptr);
         break;
      }

      /* buf ç©ºé–“ä¸å¤  */
      if (buf + ANSILINELEN - 1 <= ptr2 + (ptr1 - ptr) + (len + 7))
        break;

      str_ncpy(ptr2, ptr, ptr1 - ptr + 1);
      ptr2 += ptr1 - ptr;
      sprintf(ptr2, COLOR_MORE_MASK "%.*s%s", len, ptr1, str_ransi);
      ptr2 += len + 7;
      ptr = ptr1 + len;
    }

    ptr = buf;
  }

  ch1 = moreline->b_cols;

  if (moreline->more_offset)
  {
    if (moreline->more_offset > 1);
      ch1--;

    if (in_chi)
    {
      outc(' ');
      ch1--;
    }
  }

#ifdef SHOW_USER_IN_TEXT
  num_ch_space = outax(ptr, ch1);
#else
  num_ch_space = outa(ptr, ch1, 1);
#endif

  if (moreline->auto_break_flag--)
  {
    if (moreline->auto_break_flag)
      outc(' ');

    prints(COLOR_MORE_OFFSET "%c", QUOTE_CHAR5);
    ansi = 1;
  }
  else if (moreline->more_offset && num_ch_space--)
  {
    if (num_ch_space)
      outc(' ');

    prints(COLOR_MORE_OFFSET "%c", QUOTE_CHAR1);
    ansi = 1;
  }

  if (ansi)
    outs(str_ransi);

  return ret;
}

------------------------------------------------------------------------------
:src/maple/more.c - outs_header()

/* ä¿®æ”¹å¹…åº¦å¤§, è«‹æ•´å€‹å‡½å¼æ›æ‰ */

static char header1[LINE_HEADER][LEN_AUTHOR1] = STR_HEADER;
static char header2[LINE_HEADER][LEN_AUTHOR2] = STR_HEADER2;

static void
outs_header(moreline, header_len)       /* å°å‡ºæª”é ­ */
  MORELINE *moreline;
  int header_len;
{
  int i;
  char *buf, *ptr, *word;

  buf = moreline->data;

  /* è™•ç†æª”é ­ */

  for (i = 0; i < LINE_HEADER; i++)
  {
    if ((header_len == LEN_AUTHOR1 &&
      !memcmp(buf, header1[i], LEN_AUTHOR1 - 1)) ||
      (header_len == LEN_AUTHOR2 &&
      !memcmp(buf, header2[i], LEN_AUTHOR2 - 1)))
    {
      word = buf + header_len;

      /* ä½œè€…/çœ‹æ¿ æª”é ­æœ‰äºŒæ¬„ï¼Œç‰¹åˆ¥è™•ç† */
      if (i == 0 &&
        ((ptr = strstr(word, str_post1)) || (ptr = strstr(word, str_post2))))
      {
        if (ptr > word)
          ptr[-1] = '\0';

        ptr[4] = '\0';

        prints(COLOR5 " %s " COLOR6 "%-*.*s" COLOR5 " %s " COLOR6
          "%-13s\033[m", header1[0], d_cols + 53, d_cols + 53, word
          , ptr, ptr + 5, str_ransi);
      }
      else
      {
        /* å…¶ä»–æª”é ­éƒ½åªæœ‰ä¸€æ¬„ */
        prints(COLOR5 " %s " COLOR6 "%-*.*s\033[m",
          header1[i], d_cols + 72, d_cols + 72, word, str_ransi);
      }

      return;
    }
  }

  /* å¦‚æœä¸æ˜¯æª”é ­ï¼Œå°±ç•¶ä¸€èˆ¬æ–‡å­—å°å‡º */
  outs_line(buf);
}

------------------------------------------------------------------------------
:src/maple/more.c - outs_footer()

/* ä¿®æ”¹å¹…åº¦å¤§, è«‹æ•´å€‹å‡½å¼æ›æ‰ */

static void
outs_footer(moreline, lino, fsize)
  MORELINE *moreline;
  int lino;
  int fsize;
{
  int i, j;

  j = moreline->b_cols + moreline->more_offset;

  sprintf(moreline->data, FOOTER_MORE, (lino - 2) / PAGE_SCROLL + 1,
    ((foff - fimage) * 100) / fsize, 0, "", (lino > PAGE_SCROLL) ?
    lino - PAGE_SCROLL : 1, lino, moreline->more_offset + 1, j);

  i = b_cols + strlen(COLOR1) + (strlen(COLOR2) * 3) + (strlen(FCOLOR) * 3)
      - strlen(moreline->data) - 1;

  sprintf(moreline->data, FOOTER_MORE, (lino - 2) / PAGE_SCROLL + 1,
    ((foff - fimage) * 100) / fsize, i, "", (lino > PAGE_SCROLL) ?
    lino - PAGE_SCROLL : 1, lino, moreline->more_offset + 1, j);

  outz(moreline->data);
  outs(str_ransi);
}

------------------------------------------------------------------------------
/* æ•´å€‹å‡½å¼æ›æ‰, æ›´å‹•å¹…åº¦å¤§ */
:src/maple/more.c - more()

int
more(fpath, footer)
  char *fpath;
  char *footer;
{
  MORELINE moreline;
  FILE *fp;
  struct stat st;
  char *str;
  int i;
  int shift;            /* é‚„éœ€è¦å¾€ä¸‹ç§»å‹•å¹¾åˆ— */
  int lino;             /* ç›®å‰ line number */
  int header_len;       /* æª”é ­çš„é•·åº¦ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ç«™å…§/ç«™å¤–ä¿¡çš„å€åˆ¥ */
  int key;              /* æŒ‰éµ */
  int cmd;              /* ä¸­æ–·æ™‚æ‰€æŒ‰çš„éµ */
  int fsize;            /* æª”æ¡ˆå¤§å° */
  int hunt_index;       /* æœå°‹ç´¢å¼• */
  int curr_refresh;
  /* æ¯ 32 åˆ—ç‚ºä¸€å€‹ blockï¼Œè¨˜éŒ„æ­¤ block çš„ offset */
  static off_t block[MAXBLOCK];
  off_t header_end;     /* æª”é ­çµæŸ */
  off_t header_end2;    /* æª”é ­åˆ†éš”ç·š */

  if (!(fp = fopen(fpath, "r")))
    return -1;

  if (fstat(fileno(fp), &st) || !(S_ISREG(st.st_mode)) ||
   (fsize = st.st_size) <= 0)
  {
    fclose(fp);
    return -1;
  }

  lino = strlen(BCOLOR MSG_SEPERATOR "\033[m\n");

  if (!(fimage = malloc(fsize + lino)))
    return -1;

  foff = fimage;
  fend = foff + fsize;

  memset(&moreline, 0, sizeof(MORELINE));
  moreline.b_cols = b_cols - ((currbattr & BRD_NOTRAN) ? 1 : 0);
  header_end = header_end2 = hunt_index = curr_refresh = 0;

  for (i = 0; ; i++)
  {
    if (feof(fp) || !(str = fgets(foff, MORE_BUFSIZE, fp)))
      break;

    shift = strlen(str);
    foff += shift;

    /* è®€å‡ºæª”æ¡ˆç¬¬ä¸€åˆ—ï¼Œä¾†åˆ¤æ–·ç«™å…§ä¿¡é‚„æ˜¯ç«™å¤–ä¿¡ */
    if (i == 0)
    {
      header_len =
        !memcmp(str, str_author1, LEN_AUTHOR1) ? LEN_AUTHOR1 :
        /* ã€Œä½œè€…:ã€è¡¨ç«™å…§æ–‡ç«  */
        !memcmp(str, str_author2, LEN_AUTHOR2) ? LEN_AUTHOR2 :
        /* ã€Œç™¼ä¿¡äºº:ã€è¡¨è½‰ä¿¡æ–‡ç«  */
        0;                              /* æ²’æœ‰æª”é ­ */
    }

    if (i >= (header_len - 2))
      break;

    if ((header_len == LEN_AUTHOR1 &&
          !memcmp(str, header1[i], LEN_AUTHOR1 - 1)) ||
        (header_len == LEN_AUTHOR2 &&
           !memcmp(str, header2[i], LEN_AUTHOR2 - 1)))
      header_end = moreline.header_offset = foff - fimage;
    else
    {
      if (i < (header_len - 2))
        break;
    }
  }

  if (header_len)
  {
    foff -= shift;
    memcpy(foff + lino, foff, shift);
    memcpy(foff, BCOLOR MSG_SEPERATOR "\033[m\n", lino);
    foff += lino + shift;
    fsize += lino;
    fend = fimage + fsize;
    header_end2 = moreline.header_offset = header_end + lino;
  }

  while ((foff < fend) && (feof(fp) == 0))
    foff += fread(foff, MORE_BUFSIZE, MORE_BUFSIZE, fp);

  fclose(fp);

  /* æ­¸é›¶ */
  flast = foff = fimage;

  lino = key = cmd = 0;
  memset(&block, 0, sizeof(off_t) * MAXBLOCK);

  if (hunt[0])      /* åœ¨ xxxx_browse() è«‹æ±‚æœå°‹å­—ä¸² */
  {
    str_lowest(hunt, hunt);
    shift = HUNT_MASK | HUNT_START;
  }
  else
    shift = b_lines;

  clear();

  for(;;)
  {
    if (more_line(&moreline, foff, 0))
    {
      /* ------------------------------------------------- */
      /* å°å‡ºä¸€åˆ—çš„æ–‡å­—                                    */
      /* ------------------------------------------------- */

      /* é¦–é å‰å¹¾åˆ—æ‰éœ€è¦è™•ç†æª”é ­ */
      if (foff <= fimage + header_end)
        outs_header(&moreline, header_len);
      else
      {
        if (foff <= fimage + header_end2)
#ifdef SHOW_USER_IN_TEXT
          outax(moreline.data, moreline.b_cols);
#else
          outa(ptr, moreline.b_cols, 1);
#endif
        else
          hunt_index = outs_line(&moreline);
      }

      outc('\n');

      /* ------------------------------------------------- */
      /* ä¾ shift ä¾†æ±ºå®šå‹•ä½œ                               */
      /* ------------------------------------------------- */

      /* itoc.030303.è¨»è§£: shift åœ¨æ­¤çš„æ„ç¾©
         >0: é‚„éœ€è¦å¾€ä¸‹ç§»å¹¾è¡Œ
         <0: é‚„éœ€è¦å¾€ä¸Šç§»å¹¾è¡Œ
         =0: çµæŸé€™é ï¼Œç­‰å¾…ä½¿ç”¨è€…æŒ‰éµ */

      if (curr_refresh)
        shift--;
      else if (shift > 0)       /* é‚„è¦ä¸‹ç§» shift åˆ— */
      {
        /* åªæœ‰åœ¨å‰›é€² moreï¼Œç¬¬ä¸€æ¬¡å°ç¬¬ä¸€é æ™‚æ‰å¯èƒ½ lino <= b_lines */
        if (lino >= b_lines)
          scroll();

        lino++;

        if ((lino % 32 == 0) && ((i = lino >> 5) < MAXBLOCK))
          block[i] = foff - fimage;

        if (shift & END_MASK)       /* æŒ‰ End éµ */
        {
          if (!(shift & END_MORE_MASK))
            flast += more_line(&moreline, flast, 1);
        }
        else if (shift & HUNT_MASK)     /* å­—ä¸²æœå°‹ */
        {
          if (shift & HUNT_NEXT)    /* æŒ‰ n æœå°‹ä¸‹ä¸€ç­† */
          {
            flast += more_line(&moreline, flast, 1);
            /* ä¸€æ‰¾åˆ°å°±åœæ–¼è©²åˆ— */
            if (str_sub(&moreline.data[hunt_index], hunt))
              shift = 0;
          }
          else          /* æŒ‰ / é–‹å§‹æœå°‹ */
          {
            /* è‹¥åœ¨ç¬¬äºŒé ä»¥å¾Œæ‰¾åˆ°ï¼Œä¸€æ‰¾åˆ°å°±åœæ–¼è©²åˆ—ï¼›
               è‹¥åœ¨ç¬¬ä¸€é æ‰¾åˆ°ï¼Œå¿…é ˆç­‰åˆ°è®€å®Œç¬¬ä¸€é æ‰èƒ½åœæ­¢ */
            if (shift & HUNT_START)
            {
              if (lino > b_lines)
                flast += more_line(&moreline, flast, 1);

              /* æ‹¿æ‰ HUNT_START ä¸¦åŠ ä¸Š HUNT_FOUND */
              if (str_sub(&moreline.data[hunt_index], hunt))
                shift ^= HUNT_START | HUNT_FOUND;
            }

            if (shift & HUNT_FOUND && lino >= b_lines)
              shift = 0;
          }
          hunt_index = 0;
        }
        else
        {
          if (lino > b_lines)
            flast += more_line(&moreline, flast, 1);
          shift--;
        }
      }
      else if (shift < 0)       /* é‚„è¦ä¸Šç§» -shift åˆ— */
      {
        shift++;

        if (!(shift))
        {
          move(b_lines, 0);
          clrtoeol();

          /* å‰©ä¸‹ b_lines+shift åˆ—æ˜¯ rscrollï¼Œoffsect å»æ­£ç¢ºä½ç½®ï¼›
             é€™è£¡çš„ i æ˜¯ç¸½å…±è¦ shift çš„åˆ—æ•¸ */

          for (i += b_lines; i > 0; i--)
            more_line(&moreline, foff, 0);
        }
      }
    }

    if (foff >= fend)   /* å·²ç¶“è®€å®Œå…¨éƒ¨çš„æª”æ¡ˆ */
    {
      /* å€˜è‹¥æ˜¯æŒ‰ End ç§»åˆ°æœ€å¾Œä¸€é ï¼Œé‚£éº¼åœç•™åœ¨ 100% è€Œä¸çµæŸï¼›å¦å‰‡ä¸€å¾‹çµæŸ */
      //if (!(shift & END_MASK))
      //  break;
      if (!(footer))
        break;

      shift = 0;
    }

    if (shift)          /* é‚„éœ€è¦ç¹¼çºŒè®€è³‡æ–™ */
      continue;

    if (curr_refresh)
      curr_refresh = 0;

    /* ------------------------------------------------- */
    /* åˆ°æ­¤å°å®Œæ‰€éœ€çš„ shift åˆ—ï¼Œæ¥ä¸‹ä¾†å°å‡º footer ä¸¦ç­‰å¾… */
    /* ä½¿ç”¨è€…æŒ‰éµ                                        */
    /* ------------------------------------------------- */

re_key:

    outs_footer(&moreline, lino, fsize);

#ifdef SLIDE_SHOW
    key = more_slideshow(&moreline);
#else
    key = vkey();
#endif

    if (key == ' ' || key == KEY_PGDN || key == KEY_RIGHT || key == Ctrl('F'))
    {
      if (foff >= fend)
      {
        cmd = 'j';
        break;
      }
      shift = PAGE_SCROLL;
    }

    else if (key == KEY_DOWN || key == '\n')
    {
      if (foff >= fend)
      {
        cmd = 'j';
        break;
      }
      shift = 1;
    }

    else if (key == KEY_PGUP || key == Ctrl('B') || key == KEY_DEL)
    {
      /* itoc.010324: åˆ°äº†æœ€é–‹å§‹å†ä¸Šæ²è¡¨ç¤ºé›¢é–‹ï¼Œ
         ä¸¦å›å‚³ 'k' (keymap[] å®šç¾©ä¸Šä¸€ç¯‡) */

      if (lino <= b_lines)
      {
    cmd = 'k';
    break;
      }
      /* æœ€å¤šåªèƒ½ä¸Šæ²åˆ°ä¸€é–‹å§‹ */
      i = PAGE_SCROLL + 1 - lino;
      shift = BMAX(-PAGE_SCROLL, i);
    }

    else if (key == KEY_UP)
    {
      /* itoc.010324: åˆ°äº†æœ€é–‹å§‹å†ä¸Šæ²è¡¨ç¤ºé›¢é–‹ï¼Œ
         ä¸¦å›å‚³ 'k' (keymap[] å®šç¾©ä¸Šä¸€ç¯‡) */
      if (lino <= b_lines)
      {
        cmd = 'k';
        break;
      }
      shift = -1;
    }

    else if (key == KEY_END || key == '$')
    {
      shift = END_MASK;
    }

    else if (key == KEY_HOME || key == '0')
    {
      if (lino <= b_lines)  /* å·²ç¶“åœ¨æœ€é–‹å§‹äº† */
    shift = 0;
      else
    shift = -b_lines;
    }

    else if (key == '/' || key == 'n')
    {
      /* å¦‚æœæŒ‰ n å»æœªè¼¸å…¥éæœå°‹å­—ä¸²ï¼Œé‚£éº¼è¦–åŒæŒ‰ / */
      if (key == 'n' && hunt[0])
      {
        shift = HUNT_MASK | HUNT_NEXT;
      }
      else
      {
        if (vget(b_lines, 0, "æœå°‹(é—œéµå­—)ï¼š", hunt, sizeof(hunt), DOECHO))
        {
          str_lowest(hunt, hunt);
          shift = HUNT_MASK | HUNT_START;
        }
        else                /* å–æ¶ˆæœå°‹ */
        {
          hunt[0] = '\0';
          foff = flast;
          curr_refresh = 1;
          shift = b_lines;
          clear();
          continue;
        }
      }
    }

    else if (key == 'C')    /* Thor.980405: more æ™‚å¯å­˜å…¥æš«å­˜æª” */
    {
      FILE *fp;
      if (fp = tbf_open())
      {
        f_suck(fp, fpath);
        fclose(fp);
      }
      shift = 0;      /* é‡ç¹ª footer */
    }
    else if (key == KEY_TAB)
    {
      moreline.more_offset += TAB_STOP;

      if (moreline.more_offset >= ANSILINELEN)
        moreline.more_offset = ANSILINELEN;;

      foff = flast;
      curr_refresh = 1;
      shift = b_lines;
      clear();
      continue;
    }

    else if (key == KEY_STAB || key == 'z')
    {
      moreline.more_offset -= TAB_STOP;

      if (moreline.more_offset < 0)
        moreline.more_offset = 0;

      foff = flast;
      curr_refresh = 1;
      shift = b_lines;
      clear();
      continue;
    }

    else if (key == '>' || key == '.')
    {
      if (moreline.more_offset)
        moreline.more_offset++;
      else
        moreline.more_offset += 2;

      if (moreline.more_offset >= MORE_BUFSIZE)
        moreline.more_offset = MORE_BUFSIZE;

      foff = flast;
      curr_refresh = 1;
      shift = b_lines;
      clear();
      continue;
    }

    else if (key == '<' || key == ',')
    {
      if (moreline.more_offset)
      {
        moreline.more_offset--;
        foff = flast;
        curr_refresh = 1;
        shift = b_lines;
        clear();
        continue;
      }
    }

    else if (key == 'h')
    {
      screenline slt[T_LINES];
      uschar *tmp_fimage;
      uschar *tmp_foff,  *tmp_flast;
      uschar *tmp_fend;
      off_t tmp_block[MAXBLOCK];
      int tmp_more_offset;

      tmp_fimage = fimage;
      tmp_foff = foff;
      tmp_flast = flast;
      tmp_fend = fend;
      memcpy(tmp_block, block, sizeof(off_t) * MAXBLOCK);
      tmp_more_offset = moreline.more_offset;

      vs_save(slt);
      xo_help("post");
      vs_restore(slt);

      moreline.more_offset = tmp_more_offset;
      memcpy(block, tmp_block, sizeof(off_t) * MAXBLOCK);
      fend = tmp_fend;
      flast = tmp_flast;
      foff = tmp_foff;
      fimage = tmp_fimage;

      shift = 0;
    }

    else        /* å…¶ä»–éµéƒ½æ˜¯ä½¿ç”¨è€…ä¸­æ–· */
    {
      /* itoc.041006: ä½¿ç”¨è€…ä¸­æ–·çš„æŒ‰éµè¦ > 0 (è€Œ KEY_LEFT æ˜¯ < 0) */
      cmd = (key > 0) ? key : 'q';
      break;
    }

    /* ------------------------------------------------- */
    /* ä½¿ç”¨è€…å·²æŒ‰éµï¼Œè‹¥ break å‰‡é›¢é–‹è¿´åœˆï¼›å¦å‰‡ä¾ç…§ shift */
    /* çš„ç¨®é¡ (äº¦å³æŒ‰éµçš„ç¨®é¡) è€Œåšä¸åŒçš„å‹•ä½œ            */
    /* ------------------------------------------------- */

    if (shift > 0)          /* æº–å‚™ä¸‹ç§» shift åˆ— */
    {
      if (shift < (HUNT_MASK | HUNT_START)) /* ä¸€èˆ¬ä¸‹ç§» */
      {
        /* itoc.041114.è¨»è§£:
           ç›®æ¨™æ˜¯ç§€å‡º lino-b_lines+1+shift ~ lino+shift åˆ—çš„å…§å®¹ï¼š
           å°±åªè¦æ¸… footer å³å¯ï¼Œå…¶ä»–çš„å°±äº¤çµ¦å‰é¢å¾ªåºå° shift åˆ—çš„ç¨‹å¼ */

        move(b_lines, 0);
        clrtoeol();

        /* itoc.041116:
            End çš„ä½œæ³•å…¶å¯¦å’Œä¸€èˆ¬ä¸‹ç§»å¯ä»¥æ˜¯å®Œå…¨ä¸€æ¨£çš„ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°è¶…é•·æ–‡ç« æ™‚ï¼Œ
            æœƒé€ æˆå‰é¢å¾ªåºå° shift åˆ—çš„ç¨‹å¼å°±å¾—ä¸€ç›´ç¿»ï¼Œç›´åˆ°æ‰¾åˆ°æœ€å¾Œä¸€é ï¼Œé€™æ¨£
            æœƒåšå¤ªå¤š outs_line() ç™½å·¥ï¼Œ
            æ‰€ä»¥åœ¨æ­¤ç‰¹åˆ¥æª¢æŸ¥è¶…é•·æ–‡ç« æ™‚ï¼Œå°±å…ˆå»æ‰¾æœ€å¾Œä¸€é æ‰€åœ¨ */

        /* é‚„æœ‰ä¸€å †æ²’è®€éï¼Œæ‰ç‰¹åˆ¥è™•ç† */
        if ((shift & END_MASK) && (fsize - (foff - fimage) >= MORE_BUFSIZE))
        {
          int totallino = lino;

          /* å…ˆè®€åˆ°æœ€å¾Œä¸€åˆ—çœ‹çœ‹å…¨éƒ¨æœ‰å¹¾åˆ— */
          while (more_line(&moreline, foff, 0))
          {
            totallino++;
            if ((totallino % 32 == 0) && ((i = totallino >> 5) < MAXBLOCK))
              block[i] = foff - fimage;
          }

          /* å…ˆä½ç§»åˆ°ä¸Šä¸€å€‹ block çš„å°¾ç«¯ */
          i = (totallino - b_lines) >> 5;
          if (i >= MAXBLOCK)
            i = MAXBLOCK - 1;

          flast = foff = fimage + block[i];
          i = i << 5;

          /* å†å¾ä¸Šä¸€å€‹ block çš„å°¾ç«¯ä½ç§»åˆ° totallino-b_lines+1 åˆ— */
          for (i = totallino - b_lines - i; i > 0; i--)
            more_line(&moreline, foff, 0);

          flast = foff;
          lino = totallino - b_lines;
          shift |= END_MORE_MASK;
        }
      }
      else
      {
        /* '/' å¾é ­é–‹å§‹æœå°‹ */
        lino = 0;
        flast = foff = fimage;
        clear();
      }
    }
    else if (shift < 0)         /* æº–å‚™ä¸Šç§» -shift åˆ— */
    {
      if (shift > -b_lines) /* ä¸Šæ²æ•¸åˆ— */
      {
        lino += shift;

        /* itoc.041114.è¨»è§£: ç›®æ¨™æ˜¯ç§€å‡º lino-b_lines+1 ~ lino åˆ—çš„å…§å®¹ï¼š
          1. å…ˆå¾é ­ä½ç§»åˆ° lino-b_lines+1 åˆ—
          2. å…¶ä¸­æœ‰ b_lines+shift åˆ—æ˜¯ä¸è®Šçš„å…§å®¹ï¼Œç”¨ rscroll é”æˆ
          3. åœ¨å‰é¢çš„ outs_line() çš„åœ°æ–¹å°å‡º -shift åˆ—
          4. æœ€å¾Œå†ä½ç§»å‰›æ‰ rscroll çš„åˆ—æ•¸
        */

        /* å…ˆä½ç§»åˆ°ä¸Šä¸€å€‹ block çš„å°¾ç«¯ */
        i = (lino - b_lines) >> 5;
        if (i >= MAXBLOCK)
          i = MAXBLOCK - 1;
        foff = fimage + block[i];
        i = i << 5;

        /* å†å¾ä¸Šä¸€å€‹ block çš„å°¾ç«¯ä½ç§»åˆ° lino-b_lines+1 åˆ— */
        for (i = lino - b_lines - i; i > 0; i--)
          more_line(&moreline, foff, 0);

        for (i = shift; i < 0; i++)
        {
          rscroll();
          move(0, 0);
          clrtoeol();
        }

        i = shift;
        flast = foff;
      }
      else          /* Home */
      {
        /* itoc.041226.è¨»è§£: ç›®æ¨™æ˜¯ç§€å‡º 1 ~ b_lines åˆ—çš„å…§å®¹ï¼š
           ä½œæ³•å°±æ˜¯å…¨éƒ¨éƒ½æ­¸é›¶ï¼Œå¾é ­å†å° b_lines åˆ—å³å¯ */

        clear();

        flast = foff = fimage;
        lino = 0;
        shift = b_lines;
      }
    }
    else                /* é‡ç¹ª footer ä¸¦ re-key */
    {
      move(b_lines, 0);
      clrtoeol();
      goto re_key;
    }
  } /* è¿´åœˆçš„çµæŸ */

  /* --------------------------------------------------- */
  /* æª”æ¡ˆå·²ç¶“ç§€å®Œ (cmd = 0) æˆ– ä½¿ç”¨è€…ä¸­æ–· (cmd != 0)     */
  /* --------------------------------------------------- */

  free(fimage);

  if (!cmd) /* æª”æ¡ˆæ­£å¸¸ç§€å®Œï¼Œè¦è™•ç† footer */
  {
    if (footer)     /* æœ‰ footer */
    {
      if (footer != (char *) -1)
        outf(footer);
      else
        outs(str_ransi);
    }
    else        /* æ²’æœ‰ footer è¦ vmsg() */
    {
      /* lkchu.981201: å…ˆæ¸…ä¸€æ¬¡ä»¥å…é‡ç–Šé¡¯ç¤º */
      move(b_lines, 0);
      clrtoeol();

      if (vmsg(NULL) == 'C') /* Thor.990204: ç‰¹åˆ¥æ³¨æ„è‹¥å›å‚³ 'C' è¡¨ç¤ºæš«å­˜æª” */
      {
        FILE *fp;

        if (fp = tbf_open())
        {
          f_suck(fp, fpath);
          fclose(fp);
        }
      }
    }
  }
  else      /* ä½¿ç”¨è€…ä¸­æ–·ï¼Œç›´æ¥é›¢é–‹ */
    outs(str_ransi);

  hunt[0] = '\0';

  /* Thor.990204: è®“keyå¯å›å‚³è‡³moreå¤– */
  return cmd;
}
------------------------------------------------------------------------------

--
[1;36m=[37m[[36mï¹[37m:[33m?[37mæ‘ƒ?[mâ—£?[1;33m?[37m:[36mï¹ [31mOrigin[37m ]|[[m  [0;31m?[1m?[1m?[0;31mO[0;31m?[1m?[1m?[0;31m?[1mcpu.tfcis.org  [37m]|[?[33mæŸèªª[m?[1;36mï¹[37m:][36m=[m
[1;36m=[0m[[1;36mï¹Š[37m:[33m?[30mæ‘ƒ?[mâ•±?[1;33m?[37m:[36mï¹Š [31mAuthor[m ]|[[1m     cszone.twbbs.org     [m]|[?[1;33m?[30m?[37mæ’[30m?[36mï¹Š[37m:[m][1;36m=[m
