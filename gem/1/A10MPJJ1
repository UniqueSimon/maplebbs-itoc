ç™¼ä¿¡äºº: tandrian.bbs@ntcb.twbbs.org.tw (å¹»åŸŸé­”åŸ), çœ‹æ¿: plan
æ¨™  é¡Œ: [åŠŸèƒ½] é™åˆ¶guestå¸³è™Ÿ
ç™¼ä¿¡ç«™: å¹»å¾¡é­”åŸ (Sat Aug 17 20:36:32 2002)               Updated: 2004/06/24

â€» guest ç¸½äººæ•¸é™åˆ¶

: config.h

+ #define MAXGUEST        (3)             /* æœ€å¤šåƒè§€è€…  */

: bbsd.c:login_user()

    else
    {                           /* guest */
      if (acct_load(&cuser, uid) < 0)
      {
        vmsg(err_uid);
        continue;
      }
+     if (utmp_count(cuser.userno, 0) >= MAXGUEST)
+       login_abort("\n" STR_GUEST " å¸³è™Ÿå·²ç¶“çˆ†æ»¿äº†....å†è¦‹ ...");
      logattempt(' ', content);
      cuser.userlevel = 0;
      cuser.ufo = UFO_DEFAULT_GUEST;

â€» åŒ ip çš„ guest ç¸½äººæ•¸é™åˆ¶

: config.h

+ #define MAXGUEST        (3)             /* æœ€å¤šåƒè§€è€…  */

: bbsd.c:login_user()

    else
    {                           /* guest */
      if (acct_load(&cuser, uid) < 0)
      {
        vmsg(err_uid);
        continue;
      }
+     if (utmp_ipcount(cuser.userno, &tn_addr) >= MAXGUEST)
+       login_abort("\n" STR_GUEST " å¸³è™Ÿå·²ç¶“çˆ†æ»¿äº†....å†è¦‹ ...");
      logattempt(' ', content);
      cuser.userlevel = 0;
      cuser.ufo = UFO_DEFAULT_GUEST;

: maple.p

+int utmp_ipcount(int userno, u_long *address);

: cache.c æ–¼ utmp_count() ä¸‹æ–°å¢é€™å‡½å¼

int
utmp_ipcount(userno, address)
  int userno;
  u_long *address;
{
  UTMP *uentp, *uceil;
  int count;
  uschar *addr;
  u_long in_addr;

  count = 0;
  addr = (uschar *) address;
  in_addr = (addr[0] << 24) + (addr[1] << 16) + (addr[2] << 8) + addr[3];
  uentp = ushm->uslot;
  uceil = (void *) uentp + ushm->offset;
  do
  {
    if (uentp->userno == userno && uentp->in_addr == in_addr)
      count++;
  } while (++uentp <= uceil);
  return count;
}

--
  [0m  [44mâ•¦â•â•— â•¬â•â• â•”â•â• â• â•â•—[40m  [1;32mâ–¡ Origin: [33må¹»åŸŸé­”åŸ - ntcb.twbbs.org
  [0m  [46;1mâ•  â•š â•šâ•â• â•šâ•â• â•šâ•â•[0m  [31mâ–¡ From: [36m218-32-98-sparc49.pchome.com[m
