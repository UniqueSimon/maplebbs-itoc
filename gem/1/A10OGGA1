ç™¼ä¿¡äºº: itoc.bbs@processor.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: è«‹å•å¾…ç æ–‡ç« åŠŸèƒ½
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2004/06/28 Mon 00:32:54)                Updated: 2005/03/15

â€» å¼•è¿°ã€Šsbs (SBS)ã€‹ä¹‹éŠ˜è¨€ï¼š
> è«‹å•æœ‰è¾¦æ³•åŠ å…¥åƒä¸è‰¯ç‰›å¤§DåŠŸèƒ½å—?
> å…ˆæ¨™è¨˜ï¼Œç„¶å¾Œå›ºå®šå¤©æ•¸å¾Œç³»çµ±æœƒè‡ªå‹•åˆªé™¤

: hdr.h:struct HDR

typedef struct
{
  time_t chrono;                /* timestamp */
  int xmode;

  int xid;                      /* reserved */

- char xname[32];               /* æª”æ¡ˆåç¨± */
+ char xname[28];               /* æª”æ¡ˆåç¨± */
+ time_t delday;                /* å¹¾å¤©å¾Œåˆªé™¤ */
  char owner[80];               /* ä½œè€… (E-mail address) */
  char nick[49];                /* æš±ç¨± */
  char score;                   /* æ–‡ç« è©•æ¯”åˆ†æ•¸ */

  char date[9];                 /* 96/12/31 */
  /* Thor.990329:ç‰¹åˆ¥æ³¨æ„, dateåªä¾›é¡¯ç¤ºç”¨, ä¸ä½œæ¯”è¼ƒ, ä»¥é¿å… y2k å•é¡Œ,
                 å®šç¾© 2000ç‚º 00, 2001ç‚º01 */

  char title[73];               /* ä¸»é¡Œ TTLEN + 1 */
}          HDR;

: post.c:post_attr()

static int
post_attr(hdr)
  HDR *hdr;
{
  int mode, attr;

+ if (hdr->delday > 0)
+   return 'D';

  mode = hdr->xmode;

: post.c:post_delday() æ–°å¢æ­¤å‡½å¼åœ¨ post_mark() å¾Œé¢

static int
post_delday(xo)
  XO *xo;
{
  if (bbstate & STAT_BOARD)
  {
    HDR *hdr;
    int pos, cur, day;
    char ans[4];

    pos = xo->pos;
    cur = pos - xo->top;
    hdr = (HDR *) xo_pool + cur;

    if (hdr->xmode & POST_MARKED)
      return XO_NONE;

    if (vget(b_lines, 0, "å¹¾å¤©å¾Œåˆªé™¤ï¼š", ans, 3, DOECHO))
    {
      if ((day = atoi(ans)) > 0)
      {
        hdr->delday = time(NULL) + day * 86400;
        currchrono = hdr->chrono;
        rec_put(xo->dir, hdr, sizeof(HDR), pos, cmpchrono);
        move(3 + cur, 7);
        outc(post_attr(hdr));
      }
    }
  }
  return XO_NONE;
}

: post.c:post_cb[]

  'm', post_mark,
+ 'p', post_delday,             [1;44m // æŒ‰éµè‡ªå®š [m

: expire.c:expire()

    if (hdr.xmode & (POST_MARKED | POST_BOTTOM) || total <= minp)
      keep = 1;
    else if (hdr.chrono < duetime || total > maxp)
      keep = 0;
+   else if (hdr.delday && hdr.delday < synctime)
+     keep = 0;
    else
      keep = 1;

--
 [1;41mâ•­[44mâ”¼[m Or[1mig[30min[m: [43m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [35;47m processor.tfcis.org [m
 [1;42mâ”¼[45mâ”˜[m A[1mut[30mho[mr: [1;31mitoc [30må¾ [36mitoc.dorm11.nctu.edu.tw [30mç™¼è¡¨[m
