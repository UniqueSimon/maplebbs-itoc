ä½œè€…: itoc (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: itoc
æ¨™é¡Œ: Re: ä¸å¯åŠ å¯†
æ™‚é–“: 2004/06/16 Wed 08:41:11                           Updated: 2005/05/26

â€» å¼•è¿°ã€ŠUizmp (é»‘è¢æ³•å¸«)ã€‹ä¹‹éŠ˜è¨€ï¼š
> è«‹å•å¯å¦é™åˆ¶æŸçœ‹æ¿æ–‡ç« ä¸å¾—åŠ å¯†å‘€?

: battr.h

#define BRD_ANONYMOUS   0x20    /* åŒ¿åçœ‹æ¿ */
+ #define BRD_NORESTRICT   0x40    /* ä¸å¯åŠ å¯†çœ‹æ¿ */

  ...
  ...

- #define NUMBATTRS       6
+ #define NUMBATTRS       7

- #define STR_BATTR       "zTcsvA"
+ #define STR_BATTR       "zTcsvAR"

: battr.h:battr_tbl[]

  "åŒ¿åçœ‹æ¿",                   /* BRD_ANONYMOUS */
+ "ä¸å¯åŠ å¯†çœ‹æ¿",               /* BRD_NORESTRICT */

: edit.c:ve_filer()

#ifdef HAVE_REFUSEMARK
  case 'x':
-  if (ve_op < 0)               /* itoc.010301: ä¸èƒ½å„²å­˜ */
+  if (ve_op < 0 || currbattr & BRD_NORESTRICT)
     return VE_FOOTER;
   curredit |= EDIT_RESTRICT;
   curredit &= ~EDIT_OUTGO;     /* åŠ å¯†å¿…æ˜¯ local save */
   break;
#endif

: post.c:post_refuse()

  if (!cuser.userlevel) /* itoc.020114: guest ä¸èƒ½å°å…¶ä»– guest çš„æ–‡ç« åŠ å¯† */
    return XO_NONE;

+ if (currbattr & BRD_NORESTRICT)
+   return XO_NONE;

: post.c:post_cross()

#ifdef HAVE_REFUSEMARK
-    else if (rc == 'x')
+    else if (rc == 'x' && !(currbattr & BRD_NORESTRICT))
       xpost.xmode = POST_RESTRICT;
#endif

> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

  å¦‚æœå¸Œæœ›é–‹æ”¾çµ¦æ¿ä¸»è‡ªè¡Œè¨­å®š

: manage.c æŠŠä»¥ä¸‹é€™æ®µåŠ åœ¨ post_battr_noscore() å¾Œé¢

static int
post_battr_norestrict(xo)
  XO *xo;
{
  BRD *oldbrd, newbrd;

  oldbrd = bshm->bcache + currbno;
  memcpy(&newbrd, oldbrd, sizeof(BRD));

  switch (vans("1)å¯ä»¥åŠ å¯†æ–‡ç«  2)ä¸å¯åŠ å¯†æ–‡ç«  [Q] "))
  {
  case '1':
    newbrd.battr &= ~BRD_NORESTRICT;
    break;
  case '2':
    newbrd.battr |= BRD_NORESTRICT;
    break;
  default:
    return XO_FOOT;
  }

  if (memcmp(&newbrd, oldbrd, sizeof(BRD)) && vans(msg_sure_ny) == 'y')
  {
    memcpy(oldbrd, &newbrd, sizeof(BRD));
    rec_put(FN_BRD, &newbrd, sizeof(BRD), currbno, NULL);
  }

  return XO_FOOT;
}

: manage.c:post_manage()

#  ifdef HAVE_SCORE
    "Score   è¨­å®šå¯å¦è©•åˆ†",
#  endif
+   "Xrefuse åŠ å¯†æ–‡ç« è¨­å®š",

  ...
  ...

#  ifdef HAVE_SCORE
    " (S)è©•åˆ†"
#  endif
+   " (X)åŠ å¯†"

  ...
  ...

#ifdef HAVE_SCORE
  case 's':
    return post_battr_noscore(xo);
#endif

+ case 'x':
+   return post_battr_norestrict(xo);

--
 [1;41mâ•­[44mâ”¼[m Or[1mig[30min[m: [43m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [35;47m processor.tfcis.org [m
 [1;42mâ”¼[45mâ”˜[m A[1mut[30mho[mr: [1;31mitoc [30må¾ [36mitoc.Dorm11.NCTU.edu.tw [30mç™¼è¡¨[m
