ç™¼ä¿¡äºº: verit.bbs@bbs.yzu.edu.tw (.......................) çœ‹æ¿: InstallBBS
æ¨™  é¡Œ: [WindTop]æ–°æµªæ˜Ÿåº§é‹å‹¢æŸ¥è©¢
ç™¼ä¿¡ç«™: å…ƒæ™ºå¤§å­¸é¢¨ä¹‹å¡” (Fri, 18 Jul 2003 02:42:53 +0800)  Updated: 2004/09/07

é€™éš»ç¨‹å¼è¦ #define POPUP_ANSWER æ‰èƒ½ç›´æ¥ä½¿ç”¨ï½

å‡å¦‚æ²’æœ‰çš„è©± , å¾—æŠŠ main_sinastar() ä¸­çš„ pans æ”¹æˆ vans  :)

: maple/menu.c:é©ç•¶é¸é …ä¸­åŠ å…¥

+ "bin/sinastar.so:main_sinastar", 0, - M_XMODE,
+ "NStar      â™‚ æ˜Ÿåº§é‹å‹¢ â™€",


: so/Makefile

        bbsnet.so dreye.so enews.so railway.so [1;33msinastar.so[m \

: so/sinastar.c åŠ å…¥é€™éš»ç¨‹å¼

/*-------------------------------------------------------*/
/* sinastar.c   (YZU WindTopBBS Ver 3.02 )               */
/*-------------------------------------------------------*/
/* author : verit.bbs@bbs.yzu.edu.tw                     */
/* target : http://mindcity.sina.com.tw                  */
/* create : 01/07/09                                     */
/* modify : 03/07/12                                     */
/*-------------------------------------------------------*/


#include "bbs.h"

#define mouts(x,y,s)    { move(x, y); outs(s); }


#define HTTP_PORT       80
#define SERVER_sinastar "mindcity.sina.com.tw"
#define REF             "http://mindcity.sina.com.tw"

#define LINE_WORD       50


static int
http_conn(server, s, kind)
  char *server;
  char *s;
  int kind;
{
  int sockfd, start_show, chinese, state;
  int cc, tlen,word, show;
  char *xhead, *xtail, tag[128], fname[64];
  FILE *fp;
  static char pool[2048];

  char *tag_s[5] =
  {
    "!--START:HORO_TODAY--", "!--START:HORO_TOMORROW--", "!--START:WEEKLY--",
    "!--START:WEEKLY--", "!--START:YEARLY--"
  };
  char *tag_e[5] =
  {
    "!--END:HORO_TODAY--", "!--END:HORO_TOMORROW--", "!--END:WEEKLY--",
    "!--END:WEEKLY--", "!--END:YEARLY--"
  };


  mouts(b_lines - 1, 0, "é€£æ¥ä¼ºæœå™¨ä¸­ï¼Œè«‹ç¨å€™.............");
  refresh();

  if ((sockfd = dns_open(server, HTTP_PORT)) < 0)
  {
    vmsg("ç„¡æ³•èˆ‡ä¼ºæœå™¨å–å¾—é€£çµï¼ŒæŸ¥è©¢å¤±æ•—");
    return -1;
  }

  write(sockfd, s, strlen(s));
  shutdown(sockfd, 1);

  /* parser return message from web server */
  xhead = pool;
  xtail = pool;
  word = 0;
  show = 0;
  chinese = 0;
  state = 0;
  tlen = 0;
  start_show = 0;

  sprintf(fname, "tmp/%s.star", cuser.userid);
  fp = fopen(fname, "w");

  for (;;)
  {
    if (xhead >= xtail)
    {
      xhead = pool;
      cc = read(sockfd, xhead, sizeof(pool));
      if (cc <= 0)
        break;
      xtail = xhead + cc;
    }
    cc = *xhead++;

    if ((tlen == strlen(tag_s[kind]) + 1) &&
      (!str_ncmp(tag, tag_s[kind], strlen(tag_s[kind]))))
    {
      start_show = 1;
    }
    else if ((tlen == strlen(tag_e[kind]) + 1) &&
      (!str_ncmp(tag, tag_e[kind], strlen(tag_e[kind]))))
    {
      break;
    }

    if (cc == '<' || cc == '&')
    {
      tlen = 1;
      continue;
    }
    if (tlen)
    {
      if (cc == '>' || cc == ';')
      {
        if ((tlen == 3) && (!str_ncmp(tag, "br", 2)) &&
          start_show && !state)
        {
          fputs("\n    ", fp);
          state = 1;
        }
        else if ((tlen == 3) && (!str_ncmp(tag, "tr", 2)) &&
          start_show && kind > 1 && !state)
        {
          fputs("\n    ", fp);
          state = 1;
        }
        tlen = 0;
        word = 0;
        continue;
      }
      if (tlen <= 128)
        tag[tlen - 1] = cc;
      tlen++;
      continue;
    }
    if (start_show)
    {
      if (word > LINE_WORD && cc < 0 && !chinese && !state)
      {
        fputs("\n    ", fp);
        state = 1;
        word = 0 ;
      }
      if (cc == ' ')
        chinese = 0;
      else if (cc != '\r' && cc != '\n')
      {
        word++;
        fputc(cc, fp);
        state = 0;
        chinese = (cc < 0) ? (chinese ? 0 : 1) : 0;
      }
      else
      {
        word = 0;
      }
    }
  }
  close(sockfd);
  fputs("\n\n    è³‡æ–™ä¾†æºç‚ºæ–°æµªæ˜Ÿåº§ç®—å‘½ç¶² http://mindcity.sina.com.tw/\n\n.", fp);
  fclose(fp);

  if (more(fname, (char *) -1) >= 0)
  {
    if (vans("æ‚¨è¦å°‡æŸ¥è©¢çµæœå¯„å›ä¿¡ç®±å—ï¼Ÿ[N] ") == 'y')
      mail_self(fname, cuser.userid, "[å‚™ å¿˜ éŒ„] æ–°æµªæ˜Ÿåº§æŸ¥è©¢çµæœ", MAIL_READ);
  }

  unlink(fname);
  return 0;
}

/* èµ·å§‹é» */
int
main_sinastar()
{
  char sendform[256], c1, c2;

  char *star[12] =
  {
    "aries",     "taurus",   "gemini",
    "cancer",    "leo",      "virgo",
    "libra",     "scorpio",  "sagittarius",
    "capricorn", "aquarius", "pisces"
  };

  char *strades[14] =
  {
    "A0",
    "AAries        ç‰¡ç¾Šåº§",  "BTaurus       é‡‘ç‰›åº§",  "CGemini       é›™å­åº§",
    "DCancer       å·¨èŸ¹åº§",  "ELeo          ç…å­åº§",  "FVirgo        è™•å¥³åº§",
    "GLibra        å¤©ç§¤åº§",  "HScorpio      å¤©è åº§",  "ISagittarius  å°„æ‰‹åº§",
    "JCapricorn    é­”ç¾¯åº§",  "KAquarius     æ°´ç“¶åº§",  "LPisces       é›™é­šåº§",
    NULL
  };

  char *_kind[7] =
  {
    "A0",
    "AToday      ä»Šæ—¥é‹å‹¢", "BTomorrow   æ˜æ—¥é‹å‹¢", "CWeek       ä¸€é€±é‹å‹¢",
    "DMonth      æœ¬æœˆé‹å‹¢", "EYear       å¹´åº¦é‹å‹¢",
    NULL
  };

  clear();
  if ((c1 = pans(3, 18, "é¸æ“‡æ˜Ÿåº§", strades)) >= 'a')
  {
    clear();
    if ((c2 = pans(6, 18, "é¸æ“‡é¡å‹", _kind)) >= 'a')
    {
      c1 -= 'a';
      c2 -= 'a';
      sprintf(sendform, "GET /west/MC-12stars/%s%d.%shtml HTTP/1.0\n\n",
        star[c1], c2 + 1, c2 == 4 ? "s" : "");
      http_conn(SERVER_sinastar, sendform, c2);
    }
  }
  return 0;
}

--
[1;32mâ€» Origin: [33må…ƒæ™ºå¤§å­¸ é¢¨ä¹‹å¡” [37m<bbs.yzu.edu.tw>[m
[1;32mâ€» From  : [36mbbs.yzu.edu.tw[m
