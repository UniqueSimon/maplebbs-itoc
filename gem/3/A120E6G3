ç™¼ä¿¡äºº: gaod.bbs@cpu.tfcis.org (å˜å™¢å¤§å¤§......|||) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [å•é¡Œ] èº«åˆ†è­‰èªè­‰æ©Ÿåˆ¶æ’°å¯« (æœªå®Œæˆ)
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2006/03/02 Thu 23:09:43)                Updated: 2006/03/02

â€» å¼•è¿°ã€Šguessi.bbs@bbs.wretch.cc (æ²’)ã€‹ä¹‹éŠ˜è¨€ï¼š
> ç«™ä¸Šå¸Œæœ›æœ‰èº«ä»½è­‰èªè­‰ å³ä½¿ç”¨è€…æä¾›èº«åˆ†è­‰è³‡æ–™
> å†ç”±ç«™é•·åšèº«åˆ†è­‰å­—è™Ÿçš„ç¢ºèª è‹¥æ­£ç¢ºå‰‡çµ¦äºˆæ¬Šé™
> ä»¥ä¸‹æ˜¯æˆ‘å¯«çš„éƒ¨ä»½.... åƒ…å®Œæˆèº«åˆ†è­‰ç·¨ç¢¼çš„ç¢ºèª
> å¸Œæœ›èƒ½åœ¨ç¢ºèªèº«åˆ†è­‰ç·¨ç¢¼æ­£ç¢ºå¾Œçµ¦æ–¼PERM_VALIDæ¬Šé™(åŸºæœ¬æ¬Šé™)
> ä½†ç”±æ–¼å°æ–¼acctçš„æ“ä½œä¸ç†Ÿæ é€™éƒ¨ä»½ä¸çŸ¥è©²å¦‚ä½•ä¸‹æ‰‹ è«‹æ•™å„ä½
> ä»¥ä¸‹ç‚ºç¨‹å¼ç¢¼æ“·å–éƒ¨ä»½

: src/menu.c:menu_admin[]  æ”¾ç½®æ–¼Adminé¸å–® åƒ…SYSOPå¯ä½¿ç”¨

  "bin/admutil.so:a_check_idnum", PERM_SYSOP, - M_SYSTEM,
  "CheckID     èº«åˆ†è­‰èªè­‰ ",

: src/so/admutil.c æ–°å¢å‡½å¼æ–¼ a_register()ä¹‹å‰

/*********************************/
/* 060301.guessi èº«åˆ†è­‰èªè­‰æ©Ÿåˆ¶  */
/*********************************/

#if 0

A=10 å°åŒ—å¸‚ J=18 æ–°ç«¹ç¸£ S=26 é«˜é›„ç¸£
B=11 å°ä¸­å¸‚ K=19 è‹—æ —ç¸£ T=27 å±æ±ç¸£
C=12 åŸºéš†å¸‚ L=20 å°ä¸­ç¸£ U=28 èŠ±è“®ç¸£
D=13 å°å—å¸‚ M=21 å—æŠ•ç¸£ V=29 å°æ±ç¸£
E=14 é«˜é›„å¸‚ N=22 å½°åŒ–ç¸£ W=32 é‡‘é–€ç¸£
F=15 å°åŒ—ç¸£ O=35 æ–°ç«¹å¸‚ X=30 æ¾æ¹–ç¸£
G=16 å®œè˜­ç¸£ P=23 é›²æ—ç¸£ Y=31 é™½æ˜å±±
H=17 æ¡ƒåœ’ç¸£ Q=24 å˜‰ç¾©ç¸£ Z=33 é€£æ±Ÿç¸£
I=34 å˜‰ç¾©å¸‚ R=25 å°å—ç¸£

X123456789 å°‡ç¬¬ä¸€å€‹è‹±æ–‡å­—è½‰æ›æˆç‚ºæ•¸å­—
abcdefghjklmnpqrstuvxywzio åˆ†åˆ¥å°æ‡‰ 10 ~ 35
å°‡è½‰æ›å¾Œæ•¸å€¼ åä½æ•¸ = X1 å€‹ä½æ•¸ = X2
å…¶é¤˜æœ«ä¹ç¢¼åˆ†åˆ¥å°æ‡‰ D1 ~ D9 å¥—å…¥ä»¥ä¸‹å…¬å¼å¾—Y

Y = X1 + 9*X2
  + 8*D1 + 7*D2 + 6*D3 + 5*D4
  + 4*D5 + 3*D6 + 2*D7 + 1*D8 + D9

è‹¥Yå¯è¢«10æ•´é™¤ => æ­£ç¢º

#endif

static int
CheckID(s)
  char *s;
{
   char *p, *LEAD="ABCDEFGHJKLMNPQRSTUVXYWZIO";
   int x, i;

  if (strlen(s) != 10 || !(p = strchr(LEAD, toupper(*s))))
    return 0;

   x = p - LEAD;
   x = x / 10 + x % 10 * 9;
   p = s + 1;

   if (*p != '1' && *p != '2')
     return 0;

   for (i = 1; i < 9; i++)
   {
     if (isdigit(*p))
       x += (*p++ - '0') * (9 - i);
     else
       return 0;
   }

   x = 9 - x % 10;
   return  (x == *p - '0');
}


int
a_check_idnum()
{
  char idnum[11], buf[80];
  ACCT acct;
  HDR hdr;

  if (acct_get(msg_uid, &acct) > 0 &&
    vget(b_lines, 0, "è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿï¼š", idnum, 11, DOECHO) &&
    CheckID(idnum))
  {
    time(&acct.tvalid);
    /* itoc.041025: é€™å€‹ acct_setperm() ä¸¦æ²’æœ‰ç·Šè·Ÿåœ¨ acct_get() å¾Œé¢ï¼Œä¸­é–“
       éš”äº†ä¸€å€‹ vgets()ï¼Œé€™å¯èƒ½é€ æˆæ‹¿èˆŠ acct å»è¦†è“‹æ–° .ACCT çš„å•é¡Œã€‚ä¸éå› 
       ç‚ºæ˜¯ç«™é•·æ‰æœ‰çš„æ¬Šé™ï¼Œæ‰€ä»¥å°±ä¸æ”¹äº† */
    acct_setperm(&acct, PERM_VALID, 0);

    /* å¯„ä¿¡çµ¦ä½¿ç”¨è€… */
    usr_fpath(buf, acct.userid, fn_dir);
    hdr_stamp(buf, HDR_LINK, &fhdr, FN_ETC_JUSTIFIED);
    strcpy(hdr.title, msg_reg_valid);
    strcpy(hdr.owner, str_sysop);
    rec_add(buf, &hdr, sizeof(HDR));
    m_biff(acct.userno);

    sprintf(buf, "IDnum: %s by %s", idnum, cuser.userid);
    justify_log(acct.userid, buf);
  }

  return 0;
}

--
 å¥½æƒ³è¦å’Œä½ ä¸€èµ·çœ‹æœˆäº®
         é åœ¨ä½ è‚©ä¸Š  æƒ…è©±æ…¢æ…¢è¬›...

                                 [1;37m â–â–‚â–„â–…â–ƒâ–‚â–[m   [5;36m ?[;1;33m â—[m
                      ï¹‹   [1;32m â–²[5m?[;31m .[37m    [1;5;33m ?[mï¹Š[1;34m?[32mï¹Š[m    [1;32mï¹Šï¹Š[m
                   ï¹‹ ï¹‹  [32m â—¢â—£[37m   [1;36m .[m       â—â—ËŠ     [m

--
[1;36m=[37m[[36mï¹[37m:[33m?[37mæ‘ƒ?[mâ—£?[1;33m?[37m:[36mï¹ [31mOrigin[37m ]|[[m  [0;31m?[1m?[1m?[0;31mO[0;31m?[1m?[1m?[0;31m?[1mcpu.tfcis.org  [37m]|[?[33mæŸèªª[m?[1;36mï¹[37m:][36m=[m
[1;36m=[0m[[1;36mï¹Š[37m:[33m?[30mæ‘ƒ?[mâ•±?[1;33m?[37m:[36mï¹Š [31mAuthor[m ]|[[1m      140.138.237.77      [m]|[?[1;33m?[30m?[37mæ’[30m?[36mï¹Š[37m:[m][1;36m=[m
