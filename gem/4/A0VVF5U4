ç™¼ä¿¡äºº: itoc.bbs@processor.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: è«‹å•è‡ªå‹•æ³¢æ–‡ç« 
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2003/12/23 Tue 20:20:38)                Updated: 2004/05/08

â€» å¼•è¿°ã€Šmaya (ç‘ªé›…)ã€‹ä¹‹éŠ˜è¨€ï¼š
>     æˆ‘å°‡é‚£ç¯‡çš„å…§å®¹æ‘³åˆ°ä¸€å€‹ .c æª”è£¡é¢

: src/util/Makefile åŠ å…¥ addpost

EXE =   account acl-sort [1;33maddpost[m bbsmail ...

: src/util/addpost.c æ–°å¢žç¨‹å¼å¦‚ä¸‹

/*-------------------------------------------------------*/
/* util/addpost.c   ( NTHU CS MapleBBS Ver 3.00 )        */
/*-------------------------------------------------------*/
/* target : ç³»çµ±è‡ªå‹•ç™¼æ–‡åˆ°çœ‹æ¿                           */
/* create : 03/12/23                                     */
/* update :   /  /                                       */
/* author : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/


#include "bbs.h"

static char *userid;
static char *username;

static void
out_post(hdr, board)
  HDR *hdr;
  char *board;
{
  bntp_t bntp;

  memset(&bntp, 0, sizeof(bntp_t));
  strcpy(bntp.board, board);
  strcpy(bntp.xname, hdr->xname);
  strcpy(bntp.owner, hdr->owner);
  strcpy(bntp.nick, hdr->nick);
  strcpy(bntp.title, hdr->title);
  rec_add("innd/out.bntp", &bntp, sizeof(bntp_t));
}


static void
add_post(brdname, fpath, title)           /* ç™¼æ–‡åˆ°çœ‹æ¿ */
  char *brdname;        /* æ¬² post çš„çœ‹æ¿ */
  char *fpath;          /* æª”æ¡ˆè·¯å¾‘ */
  char *title;          /* æ–‡ç« æ¨™é¡Œ */
{
  HDR hdr;
  char folder[64];

  brd_fpath(folder, brdname, FN_DIR);
  hdr_stamp(folder, HDR_LINK | 'A', &hdr, fpath);
  strcpy(hdr.owner, userid);
  strcpy(hdr.nick, username);
  strcpy(hdr.title, title);
  hdr.xmode = POST_OUTGO;
  rec_add(folder, &hdr, sizeof(HDR));

  out_post(&hdr, brdname);
}


int
main(argc, argv)
  int argc;
  char *argv[];
{
  char *fpath, *brdname, *title, *fname;
  FILE *fp;

  if (argc != 6)
  {
    printf("Usage: %s brdname userid username title filepath\n", argv[0]);
    return -1;
  }

  chdir(BBSHOME);

  fpath = "tmp/addpost.tmp";    /* æš«å­˜æª” */
  brdname = argv[1];
  userid = argv[2];
  username = argv[3];
  title = argv[4];
  fname = argv[5];

  if (fp = fopen(fpath, "w"))
  {
    fprintf(fp, "%s %s (%s) %s %s\n",
      STR_AUTHOR1, userid, username, STR_POST2, brdname);
    fprintf(fp, "æ¨™é¡Œ: %s\næ™‚é–“: %s\n\n", title, Now());

    f_suck(fp, fname);
    fprintf(fp, "\n--\nâ€» æœ¬æ–‡ç”±è‡ªå‹•ç™¼æ–‡ç³»çµ±æ‰€ç™¼è¡¨\n");

    fclose(fp);

    add_post(brdname, fpath, title);
    unlink(fpath);
  }

  return 0;
}

> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

: tmp/apple æ–°å¢žé€™æª”æ¡ˆ
: æª”åè·¯å¾‘æ˜¯éš¨ä¾¿çš„ï¼Œbbs èº«åˆ†å¯è®€å–ï¼Œå…§å®¹æ˜¯ä½ è¦ç™¼è¡¨çš„æ–‡ç« 

  å¤§å®¶å¥½ï¼Œæœ¬é€±å››å®šæœŸçš„ç·´ç¿’æ´»å‹•ç…§å¸¸èˆ‰è¡Œ
  è«‹å¤§å®¶è¦è¨˜å¾—ä¾†åƒåŠ å–”

: crontab -e
: addpost çœ‹æ¿ ä½œè€… æš±ç¨± æ¨™é¡Œ æª”åè·¯å¾‘
: æœ€å¾Œæ”¹ crontabï¼Œçœ‹ä½ å¤šä¹…è¦å…¬å‘Šä¸€æ¬¡

# æ¯æ˜ŸæœŸä¸‰ä¸‹åˆç™¼ä¸€æ¬¡å…¬å‘Š
50 15 * * 3 bin/addpost test "éšŠé•·" "éšŠé•·" "ç·´ç¿’ï¼" tmp/apple > /dev/null 2>&1

--
 [1;43mâ”Œ[44mâ”¼[m Or[1mig[30min[m: [44m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [31;47m processor.tfcis.org [m
 [1;41mâ””[42mâ”˜[m A[1mut[30mho[mr: [1;36mitoc [30må¾ž [35mitoc.Dorm11.NCTU.edu.tw [30mç™¼è¡¨[m
