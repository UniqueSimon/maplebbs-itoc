ç™¼ä¿¡äºº: itoc.bbs@processor.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: newä¸€å€‹æ–°å¸³è™Ÿæ™‚ï¼Œå‡ºç¾ä½¿ç”¨è€…æ¢æ¬¾(ç«™è¦)
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2003/12/25 Thu 02:10:39)                Updated: 2005/03/23

â€» å¼•è¿°ã€Šcyanofox.bbs@bbs.cs.nchu.edu.tw (æˆ‘æ˜¯å¥½äººä¸€æ—çš„:()ã€‹ä¹‹éŠ˜è¨€ï¼š
> å¦‚ä½•åœ¨ç”³è«‹ä¸€å€‹æ–°idæ™‚ï¼Œå…ˆå‡ºç¾ç«™è¦ï¼Œä½¿ç”¨è€…åŒæ„å¾Œå†ç¹¼çºŒä¸‹é¢çš„æ­¥é©Ÿ
> (åƒptté‚£æ¨£)
> è€Œé‚£å€‹ç«™è¦æª”æ”¾åœ¨~/etc/åº•ä¸‹(æˆ–ä»–è™•ï¼Œæœ€å¥½å¯ç”±ç«™ä¸Šæ”¹)
> è‹¥ç„¡ç«™è¦æª”å‰‡é—œé–‰æ­¤åŠŸèƒ½

: bbsd.c:acct_apply()

  SCHEMA slot;
  char buf[80];
  char *userid;
  int try, fd;

+ if (startgame(IQFILE) != FULLSCORE)
+   login_abort("\nå¾ˆæŠ±æ­‰ï¼Œæ‚¨è€ƒè©¦ä¸é€šéï¼Œç„¡æ³•è¨»å†Š");

  film_out(FILM_APPLY, 0);

: etc/iqdata.aq  æŠŠé¡Œåº«æª”(iqdata.aq)æ”¾åœ¨etcä¸‹ï¼Œæ ¼å¼æ–¼ä¸‹
: é¡Œç›®+æ­£ç¢ºç­”æ¡ˆ
: æ­£ç¢ºç­”æ¡ˆåªèƒ½æ˜¯ä¸€å€‹ char

ç«™é•·æ˜¯å¸¥å“¥(Y/N)ï¼Ÿ y
èª°æ˜¯ä¸–ç•Œä¸Šæœ€å¸¥çš„äºº (1)ç¸½çµ± (2)ç«™é•· (3)è¶…äººï¼Ÿ 2
æ–°æ‰‹ä¸Šç«™è¦å¹¾å¤©(1-9)ï¼Ÿ 3

: bbsd.c: æ–°å¢ä»¥ä¸‹å‡½å¼æ–¼ acct_apply() å‰é¢

/*-------------------------------------------------------*/
/* target : æ•¸å­¸å¤§å¯Œç¿                                   */
/* author : codeman.bbs@amtigers.adsldns.org             */
/*          hxw.bbs@bbs.sayya.org                        */
/*-------------------------------------------------------*/


/* é¡Œç›®æ•¸(Q_MAX)è¦å¤§æ–¼å‡ºé¡Œæ•¸(Q_MUCH) */

#define Q_LENTH     160         /* é¡Œç›®é•·åº¦ */
#define Q_MAX       1024        /* æœ€å¤šèƒ½æœ‰å¹¾é¡Œ */
#define Q_MUCH      10          /* å‡ºå¤šå°‘é¡Œ */
#define Q_TOTAL     total       /* æª”æ¡ˆä¸­å…±æœ‰å¤šå°‘é¡Œç›® */
#define FULLSCORE   100         /* å®šç¾©æ»¿åˆ†æ˜¯ 100 åˆ† */

#undef  SHOWRANSER              /* show the right anser ç§€å‡ºè§£ç­” */
                                /* å»ºè­°ä¸è¦ï¼Œå› ç‚ºé€™æ¨£å°±ä¸å¥½ç©äº† */

/*-------------------------------------------------------*/
/* é¡Œåº«æ ¼å¼                                              */
/* é¡Œç›®é•·ä»¥ä¸€å€‹è¢å¹•å¯è¼¸å‡ºç‚ºé™                            */
/* ç¯„ä¾‹:                                                 */
/* 1+1=2? y                                              */
/* 2+3=4? n                                              */
/* ^^é¡Œç›® ^ç­”æ¡ˆ                                          */
/* è¨»:ç­”æ¡ˆæ˜¯è©²å­—ä¸²æ‰£æ‰æ›è¡Œçš„æœ€å¾Œä¸€å€‹å­—å…ƒ                 */
/*-------------------------------------------------------*/


#define IQFILE  "etc/iqdata.aq"             /* å®šç¾©é¡Œåº«æª”çš„æª”å */


static int
logo()              /* æ¨™é¡Œ */
{
  vs_bar("ç«™è¦è€ƒè©¦");
  move(1,0);
  outs("\033[1;33;41m");
  outs("*****************************************************************\n");
  outs("*                         ç«™è¦è€ƒè©¦                              *\n");
  outs("*****************************************************************");
  outs("\033[m");
}


static int
showans(anser)              /* æŠŠä½¿ç”¨è€…è¼¸å…¥çš„ç­”æ¡ˆç§€å‡ºä¾† */
  char anser[Q_MAX];
{
  int i;

  move(Q_MUCH + 1, 0);
  outs("æ‚¨çš„ç­”æ¡ˆæ˜¯:\n");
  for (i = 0; i < Q_MUCH; i++)
    prints("%d:%c  ", i + 1, anser[i]);
}


#ifdef SHOWRANSER
static int
showrans(ranser, aqnum, question)   /* ç§€å‡ºæ­£è§£çš„å‡½å¼ */
  char ranser[Q_MAX];
  int aqnum[Q_MUCH];
  char *question[Q_LENTH];
{
  int i;

  vs_bar("ç«™è¦è€ƒè©¦");
  for (i = 0; i < Q_MUCH; i++)
    prints("%d.%s :%c\n", i+1, question[aqnum[i]], ranser[aqnum[i]]);
}
#endif


static int          /* å›å‚³å°äº†å¹¾é¡Œ */
anscompare(anser, ranser, aqnum)   /* æ¯”å°ç­”æ¡ˆçš„å‡½å¼ */
  char anser[Q_MAX];
  char ranser[Q_MAX];
  int aqnum[Q_MUCH];
{
  int i, rmuch;

  rmuch = 0;
  for (i = 0; i < Q_MUCH; i++)
  {
    if (ranser[aqnum[i]] == anser[i])
      rmuch++;
  }
  return rmuch;
}


static int          /* å›å‚³åˆ†æ•¸ */
countscore(rmuch)               /* è¨ˆç®—åˆ†æ•¸çš„å‡½å¼ */
  int rmuch;
{
  return rmuch * FULLSCORE / Q_MUCH;
}


static int
startgame(fpath)
  char *fpath;           /* é¡Œåº«çš„æª”å */
{
  FILE *fp;
  char *question[Q_MAX];
  char anser[Q_MAX], ranser[Q_MAX]; /* anseræ˜¯ä½¿ç”¨è€…çš„ç­”æ¡ˆ,ranseræ˜¯æ­£è§£ */
  int qnum, total;                  /* totalæ˜¯æª”æ¡ˆä¸­çš„ç¸½é¡Œç›®æ•¸,qnumæ˜¯é¡Œè™Ÿ */
  int aqnum[Q_MUCH] = {0};          /* aqnumæ˜¯å·±å‡ºç¾éçš„é¡Œè™Ÿ */
  int alnum[Q_MAX] = {0};           /* already exists num å·±å‡ºç¾éçš„é¡Œè™Ÿ */
  int i;
  int score;
  char buf[3];

  if (!(fp = fopen(fpath, "r")))
    return FULLSCORE;

  logo();

  /* å°‡ question çš„è¨˜æ†¶é«”æº–å‚™å¥½ */
  for (i = 0; i < Q_MAX; i++)
    question[i] = (char *) malloc(Q_LENTH);

  /* æŠŠé¡Œç›®è®€åˆ° question é™£åˆ—ä¸­ */
  total = 0;
  while (fgets(question[total], Q_LENTH, fp))
  {
    i = strlen(question[total]) - 2;
    ranser[total] = (char) *(question[total] + i);
                                        /* æŠŠå€’æ•¸ç¬¬äºŒå€‹å­—å…ƒè®€å…¥ranseré™£åˆ— */
    *(question[total] + i) = '\0';
    total++;
  }

  fclose(fp);

  /* äº‚æ•¸å–é¡Œ,åˆ—å°åˆ°è¢å¹•ä¸Š,ä¸¦å°‡ç­”æ¡ˆå­˜åˆ°anseré™£åˆ— */
  srand(time(NULL) + cuser.userno);
  for (i = 0; i < Q_MUCH; i++)
  {
    /* åˆ¤æ–·äº‚æ•¸æ˜¯å¦å‡ºç¾é,è‹¥æœ‰å°±é‡å– */
    do
    {
      qnum = rnd(total);
    } while (alnum[qnum] == 1);

    alnum[qnum] = 1;
    move(9, 0);
    clrtobot();
    prints("\033[1m%s\033[m", question[qnum]);
    anser[i] = vget(10, 0, "è«‹è¼¸å…¥ç­”æ¡ˆ : ", buf, 3, LCECHO);
    aqnum[i] = qnum;
  }

  /* æ¯”å°ranserå’Œanserç­”æ¡ˆ */
  i = anscompare(anser, ranser, aqnum);

  /* è¨ˆåˆ† */
  score = countscore(rmuch);
  move(9, 0);
  clrtobot();
  move(9, 18);
  prints("æ‚¨ç­”å°äº† %d é¡Œï¼", i);
  move(10, 18);
  prints("æ‚¨å¾—äº† %d åˆ†ï¼Œæ»¿åˆ†æ˜¯ %d åˆ†ã€‚", score, FULLSCORE);
  vmsg(NULL);

#ifdef SHOWRANSER  /* ç§€å‡ºè§£ç­” */
  showrans(ranser, aqnum, question);
  showans(anser);
  vmsg(NULL);
#endif

  for (i = 0; i < Q_MAX; i++)
    free(question[i]);

  return score;
}

--
 [1;43mâ”Œ[44mâ”¼[m Or[1mig[30min[m: [44m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [31;47m processor.tfcis.org [m
 [1;41mâ””[42mâ”˜[m A[1mut[30mho[mr: [1;36mitoc [30må¾ [35mitoc.dorm11.nctu.edu.tw [30mç™¼è¡¨[m
