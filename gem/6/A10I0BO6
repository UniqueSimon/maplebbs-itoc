ä½œè€…: itoc (å¥‡æ€ªçš„æš±ç¨±) çœ‹æ¿: plan
æ¨™é¡Œ: [åŠŸèƒ½] é€²åˆ†é¡ç•«é¢
æ™‚é–“: 2004/08/16 Mon 11:27:14                           Updated: 2004/08/16

â€» å¼•è¿°ã€Šchwaian.bbs@processor.tfcis.org (ç„¡è¨€)ã€‹ä¹‹éŠ˜è¨€ï¼š
> é€²å…¥åˆ†é¡æ™‚è‡ªå‹•showå‡ºé¡ä¼¼é€²æ¿ç•«é¢çš„åŠŸèƒ½

  é–‹ä¸€å€‹ç›®éŒ„å« gem/brdnote

  é€²å…¥è©²åˆ†é¡å¾Œï¼Œç«™é•·æŒ‰ B å³å¯ç·¨è¼¯è©²åˆ†é¡çš„ã€Œé€²åˆ†é¡ç•«é¢ã€

: board.c:XoClass()

  xo.key = chn;
  xo.xyz = NULL;
  if (!class_load(&xo))
  {
    if (xo.xyz)
      free(xo.xyz);
    return 0;
  }

+ /* é€²åˆ†é¡ç•«é¢ */
+ if (!(class_bits[-chn] & BRD_V_BIT) || (cuser.ufo & UFO_BRDNOTE))
+ {
+   short *chx;
+   char *img, *str, *ptr, fpath[64];

+   img = class_img;
+   chx = (short *) img + (CH_END - chn);
+   str = img + *chx;

+   if (ptr = strchr(str, '/'))
+   {
+     sprintf(fpath, "gem/brdnote/%.*s.note", ptr - str, str);
+     more(fpath, NULL);
+   }
+   class_bits[-chn] ^= BRD_V_BIT;
+ }

  xt = xz[XZ_CLASS - XO_ZONE].xo;
  xz[XZ_CLASS - XO_ZONE].xo = &xo;

: board.c:class_memo_edit() åŠ åœ¨ class_help() å‰é¢

static int
class_memo_edit(xo)
  XO *xo;
{
  int mode;
  short *chx;
  char *img, *str, *ptr, fpath[64];

  if (xo->key >= CH_END || !HAS_PERM(PERM_ALLBOARD))
    return XO_NONE;

  img = class_img;
  chx = (short *) img + (CH_END - xo->key);
  str = img + *chx;

  if (!(ptr = strchr(str, '/')))
    return XO_NONE;

  mode = vans("é€²æ¿ç•«é¢ (D)åˆªé™¤ (E)ä¿®æ”¹ (Q)å–æ¶ˆï¼Ÿ[E] ");

  if (mode != 'q')
  {
    sprintf(fpath, "gem/brdnote/%.*s.note", ptr - str, str);

    if (mode == 'd')
    {
      unlink(fpath);
      return XO_FOOT;
    }

    if (vedit(fpath, 0))       /* Thor.981020: æ³¨æ„è¢«talkçš„å•é¡Œ */
      vmsg(msg_cancel);
    return class_head(xo);
  }
  return XO_FOOT;
}

: board.c:class_cb[]

+ 'B', class_memo_edit,

  'h', class_help

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ [32mpc512-2.EE.NCTU.edu.tw[37m ç™¼è¡¨[m
