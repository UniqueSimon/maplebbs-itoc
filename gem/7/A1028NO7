ä½œè€…: itoc (SS è¦å®Œè›‹äº†) ç«™å…§: plan
æ¨™é¡Œ: [å•é¡Œ] å®šæœŸæ¸…æ‰éé«˜çš„ process
æ™‚é–“: Sun Jan 12 00:24:10 2003

â€» å¼•è¿°ã€ŠYangwenli.bbs@bbs.sa.ncyu.edu.tw (æ¥Šå¨åˆ©)ã€‹ä¹‹éŠ˜è¨€ï¼š
>     æœ€å¾Œåªå¥½è‡ªå·±å¯«å€‹å°shell scriptï¼Œå®šæ™‚å°‡æ’åå‰ä¸‰åçš„ bbsd killæ‰ã€‚

  æŠŠé€™ç¨‹å¼ gcc ä¸€ä¸‹
  ç„¶å¾Œæ”¾é€² crontab å®šæ™‚è·‘
  å¯ä»¥ kill æ‰è¶…é 5% çš„ bbsd

#include <stdio.h>

#define THRESHOLD       5       /* top >= 5% å°±ç  */

int
main()
{
  int line;
  FILE *fp;
  char a[20], b[20], c[20], d[20], e[20], f[20];
  char g[20], h[20], i[20], j[20], k[20];
  char cmd[128], *str1, *str2;
  char *tmpfile = "/tmp/killtop";

  sprintf(cmd, "top | grep -w bbsd | sed -n '9,11p' > %s", tmpfile);
  system(cmd);

  if (!(fp = fopen(tmpfile, "r")))
    return -1;

  for (line = 9; line <= 11; line++)
  {
    if (fscanf(fp, "%s %s %s %s %s %s %s %s %s %s %s",
      a, b, c, d, e, f, g, h, i, j, k) == 11)
    {
      if (((str1 = (char *) strchr(i, '.')) ||
        (str1 = (char *) strchr(i, '%'))) &&
        ((str2 = (char *) strchr(i, '.')) ||
        (str2 = (char *) strchr(j, '%'))))
      {
        /* å»æ‰ usage çš„ . å’Œ % */
        *str1 = '\0';
        *str2 = '\0';

        /* è‹¥é€™ process è² è¼‰éé«˜ï¼Œå°± kill æ‰ */
        if (atoi(i) >= THRESHOLD || atoi(j) >= THRESHOLD)
        {
          /* ç”¨ kill -9 ä»¥å…æ­»ç•¶äº†ç ä¸æ‰ */
          sprintf(cmd, "kill -9 %s", a);
          system(cmd);
        }
      }
    }
  }

  fclose(fp);
  unlink(tmpfile);
  return 0;
}

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ [32mitoc.Dorm-GD2.NCTU.edu.tw[37m ç™¼è¡¨[m
