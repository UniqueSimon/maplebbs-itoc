ä½œè€…: itoc (å“¼å“¼ ä¸è·Ÿæˆ‘åŽ»åƒé£¯) çœ‹æ¿: plan
æ¨™é¡Œ: [åŠŸèƒ½] struct.h acct.c talk.c å¿ƒæƒ…
æ™‚é–“: Wed Aug  7 12:02:37 2002                          Updated: 2004/07/14

  æ”¹ struct ACCTï¼Œè¦è½‰æ› .ACCT
  æ”¹ struct UTMPï¼Œè¦æ¸… shm

â€» å¼•è¿°ã€Štandrian.bbs@ntcb.twbbs.org.tw (å¹»åŸŸé­”åŸŽå¾Œç¥–)ã€‹ä¹‹éŠ˜è¨€ï¼š
>         è«‹å•å¦‚ä½•å¢žåŠ   å¿ƒæƒ…~~ ??   ^^
> No.  P  ä»£è™Ÿ         æš±ç¨±               æ•…é„‰           å‹•æ…‹  å¿ƒæƒ…  ç™¼å‘†

: struct.h

  #define UNLEN   23            /* Length of user name */
+ #define FLLEN   4             /* Length if feeling */

: struct.h:strcut ACCT

  char username[UNLEN + 1];     /* æš±ç¨± */
+ char feeling[FLLEN + 1];      /* å¿ƒæƒ… */

: struct.h:struct UTMP

  char username[UNLEN + 1];     /* user's nickname */
+ char feeling[FLLEN + 1];      /* user's feeling */

: acct.c acct_show()

  prints("  \033[32mæˆ‘çš„æš±ç¨±ï¼š\033[37m%-35s\033[32mæ“æœ‰éŠ€å¹£ï¼š\033[37m%d\n",
    u->username, u->money);

+ prints("  \033[32mæˆ‘çš„å¿ƒæƒ…ï¼š\033[37m%-35s\n", u->feeling);

  prints("  \033[32mçœŸå¯¦å§“åï¼š\033[37m%-35s\033[32mæ“æœ‰é‡‘å¹£ï¼š\033[37m%d\n",
    u->realname, u->gold);

: acct.c acct_setup()

  i++;
  str = x.username;
  while (1)
  {
    if (vget(i, 0, "æš±    ç¨±ï¼š", str, UNLEN + 1, GCARRY))
      break;
  };

+ i++;
+ str = x.feeling;
+ while (1)
+ {
+   if (vget(i, 0, "å¿ƒ    æƒ…ï¼š", str, FLLEN + 1, GCARRY))
+     break;
+ };

: bbsd.c utmp_setup()

  strcpy(utmp.userid, cuser.userid);
+ strcpy(utmp.feeling, cuser.feeling);

: talk.c ulist_item() ç‰ˆé¢è‡ªå®š

- prints("%6d%c%c%s%-13s%-*.*s%s%-*.*s%-11.10s%s\n",
+ prints("%6d%c%c%s%-13s%-*.*s%s%-*.*s%-11.10s[1;33m%-5.4s[m%s\n",
    num, ufo & UFO_CLOAK ? ')' : ' ', pager,
    wcolor[fcolor], up->userid,
-   (d_cols >> 1) + 21, (d_cols >> 1) + 20, up->username,
+   (d_cols >> 1) + [1;32m19[m, (d_cols >> 1) + [1;32m18[m, up->username,
      fcolor > 0 ? "\033[m" : "",
-   d_cols - (d_cols >> 1) + 19, d_cols - (d_cols >> 1) + 18,
+   d_cols - (d_cols >> 1) + [1;32m17[m, d_cols - (d_cols >> 1) + [1;32m16[m,
      pickup_ship ? pal_ship(fcolor, up->userno) :
    ...
    ...
-   bmode(up, 0), buf);
+   bmode(up, 0), up->feeling, buf);
}

: theme.h ç‰ˆé¢è‡ªå®š

  æ”¹ NECKER_ULIST

: config.h

#define HAVE_CHANGE_NICK        /* ä½¿ç”¨è€…åå–® ^N æ°¸ä¹…æ›´æ”¹æš±ç¨± */

+ #define HAVE_CHANGE_FEEL        /* ä½¿ç”¨è€…åå–® M æ°¸ä¹…æ›´æ”¹å¿ƒæƒ… */

#define HAVE_CHANGE_FROM        /* ä½¿ç”¨è€…åå–® ^F æš«æ™‚æ›´æ”¹æ•…é„‰ */

#define HAVE_CHANGE_ID          /* ä½¿ç”¨è€…åå–® ^D æš«æ™‚æ›´æ”¹ ID */

: talk.c æ–°å¢ž ulist_feelchange() æ–¼ ulist_nickchange() ä¸‹é¢

#ifdef HAVE_CHANGE_FEEL
static int
ulist_feelchange(xo)
  XO *xo;
{
  char *str, buf[FLLEN + 1];

  if (!cuser.userlevel)
    return XO_NONE;

  strcpy(buf, str = cutmp->feeling);
  if (vget(b_lines, 0, "è«‹è¼¸å…¥æ–°çš„å¿ƒæƒ…ï¼š", buf, FLLEN + 1, GCARRY))
  {
    if (strcmp(buf, str))
    {
      strcpy(str, buf);
      strcpy(cuser.feeling, buf);       /* å¿ƒæƒ…ä¹Ÿä¸€ä½µæ›´æ› cuser. */
      return ulist_body(xo);
    }
  }
  return XO_FOOT;
}
#endif

: talk.c talk_cb[]

#ifdef HAVE_CHANGE_NICK
  Ctrl('N'), ulist_nickchange,
#endif
+#ifdef HAVE_CHANGE_FEEL
+ 'M', ulist_feelchange,
+#endif
#ifdef HAVE_CHANGE_FROM
  Ctrl('F'), ulist_fromchange,
#endif

: acct.c u_info()

int
u_info()
{
  char *str, username[UNLEN + 1];
+ char *ptr, feeling[FLLEN + 1];

  move(MENU_XNOTE, 0);
  strcpy(username, str = cuser.username);
+ strcpy(feeling, ptr = cuser.feeling);
  acct_setup(&cuser, 0);
  if (strcmp(username, str))
    memcpy(cutmp->username, str, UNLEN + 1);
+ if (strcmp(feeling, ptr))
+   memcpy(cutmp->feeling, ptr, FLLEN + 1);
  return 0;
}

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ž [32m140.113.128.62[37m ç™¼è¡¨[m
