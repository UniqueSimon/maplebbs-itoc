ç™¼ä¿¡äºº: itoc.bbs@cpu.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: ç½®åº•åŠŸèƒ½å¦‚ä½•é™åˆ¶ç¯‡æ•¸ ?
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2006/04/13 Thu 09:46:22)                Updated: 2006/04/17

â€» å¼•è¿°ã€Šguessi.bbs@bbs.wretch.ccã€‹ä¹‹éŠ˜è¨€ï¼š
> æƒ³å°‡ç½®åº•æ•¸é‡é™åˆ¶åœ¨äº”ç¯‡ è©²å¦‚ä½•åšå‘¢ ?

: post.c:post_bottom()

  if (bbstate & STAT_BOARD)
  {
    HDR *hdr, post;
    char fpath[64];
+   int fd, fsize;
+   struct stat st;

+   if ((fd = open(xo->dir, O_RDONLY)) >= 0)
+   {
+     if (!fstat(fd, &st))
+     {
+       fsize = st.st_size;
+       while ((fsize -= sizeof(HDR)) >= 0)
+       {
+         lseek(fd, fsize, SEEK_SET);
+         read(fd, &post, sizeof(HDR));
+         if (!(post.xmode & POST_BOTTOM))
+           break;
+       }
+     }
+     close(fd);
+     if ((st.st_size - fsize) / sizeof(HDR) > 5)
+     {
+       vmsg("ç½®åº•æ–‡ä¸èƒ½è¶…éäº”ç¯‡");
+       return XO_FOOT;
+     }
+   }

    hdr = (HDR *) xo_pool + (xo->pos - xo->top);

    hdr_fpath(fpath, xo->dir, hdr);
    hdr_stamp(xo->dir, HDR_LINK | 'A', &post, fpath);

--
[1;36m=[37m[[36mï¹[37m:[33m?[37mæ‘ƒ?[mâ—£?[1;33m?[37m:[36mï¹ [31mOrigin[37m ]|[[m  [0;31m?[1m?[1m?[0;31mO[0;31m?[1m?[1m?[0;31m?[1mcpu.tfcis.org  [37m]|[?[33mæŸèªª[m?[1;36mï¹[37m:][36m=[m
[1;36m=[0m[[1;36mï¹Š[37m:[33m?[30mæ‘ƒ?[mâ•±?[1;33m?[37m:[36mï¹Š [31mAuthor[m ]|[[1m itoc.Dorm11.NCTU.edu.tw  [m]|[?[1;33m?[30m?[37mæ’[30m?[36mï¹Š[37m:[m][1;36m=[m
