ä½œè€…: itoc (å¥‡æ€ªçš„æš±ç¨±) çœ‹æ¿: plan
æ¨™é¡Œ: [åŠŸèƒ½] é¡¯ç¤ºä¿¡ç®±ä½¿ç”¨ç©ºé–“
æ™‚é–“: 2004/09/10 Fri 10:32:16                           Updated: 2005/04/20

â€» å¼•è¿°ã€Šallean.bbs@micro.bio.ncue.edu.tw (allean)ã€‹ä¹‹éŠ˜è¨€ï¼š
>      å¯å¦åœ¨ä¸Šé¢çš„æ¨™é¡Œ,æ–°å¢žä½¿ç”¨è€…ä¿¡ç®±ä½¿ç”¨é‡çš„è³‡è¨Šå‘¢ ?

: theme.h åˆªé™¤ [s]ã€[x]ã€[X] ä¸¦å¢žåŠ  %s

- #define NECKER_MBOX "[â†]é›¢é–‹ ... [s]å¯„ä¿¡ [x]è½‰éŒ„ [X]è½‰é” [h]èªªæ˜Ž\n" \
+ #define NECKER_MBOX "[â†]é›¢é–‹ ... [h]èªªæ˜Ž (%d ç¯‡ã€%d KB)\n" \

: mail.c:mbox_head()

+ static int MboxKB;       /* ä½¿ç”¨å®¹é‡ */

static int
mbox_head(xo)
  XO *xo;
{
  if (HAS_STATUS(STATUS_BIFF))  /* ä¸€é€²å…¥ä¿¡ç®±å°±æ‹¿æŽ‰ STATUS_BIFF */
    cutmp->status ^= STATUS_BIFF;

  vs_head("éƒµä»¶é¸å–®", str_site);
- prints(NECKER_MBOX, d_cols, "");
+ prints(NECKER_MBOX, xo->max, MboxKB, d_cols, "");
  return mbox_body(xo);
}

: mail.c:mbox_init()

static int
mbox_init(xo)
  XO *xo;
{
  xo_load(xo, sizeof(HDR));
+ MboxKB = mbox_totalsize(xo->dir) >> 10;       /* æ›æˆ KB */
  return mbox_head(xo);
}

: mail.c:mbox_totalsize() æ–°å¢žæ–¼ mbox_init() ä¹‹å‰

static int
mbox_totalsize(folder)
  char *folder;
{
  int total_k;
  char *ptr, *str, fpath[64];
  struct stat st;
  struct dirent *de;
  DIR *dirp;

  strcpy(fpath, folder);
  ptr = (char *) strchr(fpath, '.');
  *ptr = '@';
  *(ptr + 1) = '\0';

  total_k = 0;
  if (dirp = opendir(fpath))
  {
    *(ptr + 1) = '/';
    while (de = readdir(dirp))
    {
      str = de->d_name;

      if (*str <= ' ' || *str == '.')
        continue;

      strcpy(ptr + 2, str);

      if (!stat(fpath, &st))
        total_k += st.st_size;
    }
    closedir(dirp);
  }

  return total_k;
}


------------------------------------

  å¦‚æžœæœ‰åš [åŠŸèƒ½] mail.c é™åˆ¶å€‹äººä¿¡ç®±å®¹é‡
  é‚£éº¼æŽ¥è‘—é‚„å¯ä»¥é€™æ¨£æ”¹ï¼ŒæŠŠä¸Šé™é¡¯ç¤ºå‡ºä¾†

: theme.h åˆªé™¤æŒ‡ä»¤èªªæ˜Ž

- #define NECKER_MBOX "[â†]é›¢é–‹ ... [h]èªªæ˜Ž (%d ç¯‡ã€%d KB)\n" \
+ #define NECKER_MBOX "[h]èªªæ˜Ž (%d/%d ç¯‡ã€%d/%d KB)\n" \

: mail.c:mbox_head()

- prints(NECKER_MBOX, xo->max, MboxKB, d_cols, "");
+ prints(NECKER_MBOX,
+   xo->max,
+   HAS_PERM(PERM_ALLADMIN | PERM_MBOX) ? MAX_BBSMAIL :
+   HAS_PERM(PERM_VALID) ? MAX_VALIDMAIL : MAX_NOVALIDMAIL,
+   MboxKB,
+   HAS_PERM(PERM_ALLADMIN | PERM_MBOX) ? MAX_BBSMAILSIZE >> 10:
+   HAS_PERM(PERM_VALID) ? MAX_VALIDMAILSIZE >> 10 :
+   MAX_NOVALIDMAILSIZE >> 10,
+   d_cols, "");

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ž [32mpc512-2.EE.NCTU.edu.tw[37m ç™¼è¡¨[m
