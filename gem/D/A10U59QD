ç™¼ä¿¡äºº: chwaian.bbs@cpu.tfcis.org (ç„¡è¨€) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: é‡æ•´è¨»å†Šå–®
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2005/01/10 Mon 20:52:58)                Updated: 2005/01/10

æ‡‰è©²å¯ä»¥ç”¨äº† ä¸éå¾ˆè€—è³‡æº ä¹…ä¹…åŸ·è¡Œä¸€æ¬¡å³å¯

æœ‰åš [åŠŸèƒ½] ç§€å‡ºä½¿ç”¨è€…è¨»å†Šå–®æ‰€å¡«ä¹‹é›»è©±/ä½å€

ä¸”è¨»å†Šå–®ç´€éŒ„æª”æ¡ˆå¤§å° å·²ç¶“è »å¤§çš„æ™‚å€™ å¯ä½¿ç”¨

: src/util/Makefile åŠ å…¥ fixrform

EXE =   ... [1;33mfixrform[m

: src/util/fixrform.c æ–°å¢ç¨‹å¼å¦‚ä¸‹

/*-------------------------------------------------------*/
/* util/fixrform.c        ( NTHU CS MapleBBS Ver 3.00 )  */
/*-------------------------------------------------------*/
/* target : é‡æ•´è¨»å†Šå–®                                   */
/* create : 05/01/10                                     */
/* update :   /  /                                       */
/* author : chwaian.bbs@cpu.tfcis.org                    */
/*-------------------------------------------------------*/


#include "bbs.h"


static int
find_rform(rform2, fp)
  RFORM *rform2;
  FILE *fp;
{
  RFORM rform;
  int rc;

  rc = 0;

  fseek(fp, sizeof(RFORM), 0);  /* reset fread */

  while (fread(&rform, sizeof(RFORM), 1, fp) == 1)
  {
    if (rform2->userno == rform.userno)
    {
      rform2->rtime = rform.rtime;

      strcpy(rform2->userid, rform.userid);
      strcpy(rform2->agent, rform.agent);
      strcpy(rform2->realname, rform.realname);
      strcpy(rform2->career, rform.career);
      strcpy(rform2->address, rform.address);
      strcpy(rform2->phone, rform.phone);
      strcpy(rform2->reply, rform.reply);
      rc = 1;
    }
  }

  return rc;
}


/*-------------------------------------------------------*/
/* ä¸»ç¨‹å¼                                                */
/*-------------------------------------------------------*/


int
main()
{
  int numuser;          /* ç¸½å…±æœ‰å¹¾å€‹è¨»å†Šå¸³è™Ÿ */
  int point;
  RFORM rform2;
  FILE *fp;

  chdir(BBSHOME);

  unlink("run/rform.log.bak");
  numuser = rec_num(FN_SCHEMA, sizeof(SCHEMA));

  if (!(fp = fopen(FN_RUN_RFORM_LOG, "r")))
    return 0;

  for (point = 1; point < numuser; point++)
  {
    rform2.userno = point;
    if (find_rform(&rform2, fp))
    rec_add("run/rform.log.bak", &rform2, sizeof(RFORM));
  }

  fclose(fp);

  /* f_mv("run/rform.log.bak","run/rform.log"); */
  /* testéï¼Œè¦ºå¾—éƒ½æ²’å•é¡Œçš„è©±ï¼Œæ‰ç”¨é€™è¡Œ */

  return 0;
}


--
 [1;43mâ—¤[46mâ—¥[m Or[1mig[30min[m: [41m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [36;47m cpu.tfcis.org [m
 [1;44mâ—£[41mâ—¢[m A[1mut[30mho[mr: [1;33mchwaian [30må¾ [31m218-165-121-144.dynamic.hinet.net [30mç™¼è¡¨[m
