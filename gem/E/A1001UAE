ä½œè€…: itoc (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: itoc
æ¨™é¡Œ: Re: [å•é¡Œ] ç”Ÿæ—¥
æ™‚é–“: 2004/01/11 Sun 15:14:23                           Updated: 2005/11/02

â€» å¼•è¿°ã€Švinnie (å¿ƒæƒ…)ã€‹ä¹‹éŠ˜è¨€ï¼š
> è·Ÿå¯©æ ¸è¨»å†Šå–®çš„æ™‚å¾Œä¹Ÿè¦å¯©æ ¸ç”Ÿæ—¥
> é€™å€‹è¦æ€éº¼å¯«?

: struct.h:RFORM

typedef struct  /* è¨»å†Šè¡¨å–® (Register From) 256 bytes */
{
  int userno;
  time_t rtime;
  char userid[IDLEN + 1];
  char agent[IDLEN + 1];
- char nouse[20];
+ char year[3];
+ char month[3];
+ char day[3];
+ char sex[3];
+ char nouse[8];
  char career[50];
  char address[60];
  char phone[20];
  char reply[72];
}      RFORM;

: user.c:u_register()

-   getfield(5, 50, rform.career, "æœå‹™å–®ä½ï¼š", "å­¸æ ¡ç³»ç´šæˆ–å–®ä½è·ç¨±");
-   getfield(8, 60, rform.address, "ç›®å‰ä½å€ï¼š", "åŒ…æ‹¬å¯¢å®¤æˆ–é–€ç‰Œè™Ÿç¢¼");
-   getfield(11, 20, rform.phone, "é€£çµ¡é›»è©±ï¼š", "åŒ…æ‹¬é•·é€”æ’¥è™Ÿå€åŸŸç¢¼");
+   getfield(5, 50, rform.career, "æœå‹™å–®ä½ï¼š", "å­¸æ ¡ç³»ç´šæˆ–å–®ä½è·ç¨±");
+   getfield(7, 60, rform.address, "ç›®å‰ä½å€ï¼š", "åŒ…æ‹¬å¯¢å®¤æˆ–é–€ç‰Œè™Ÿç¢¼");
+   getfield(9, 20, rform.phone, "é€£çµ¡é›»è©±ï¼š", "åŒ…æ‹¬é•·é€”æ’¥è™Ÿå€åŸŸç¢¼");
+   getfield(11, 3, rform.year, "ç”Ÿæ—¥ï¼š", "æ°‘åœ‹å¹´");
+   getfield(13, 3, rform.month, "ç”Ÿæ—¥ï¼š", "æœˆ");
+   getfield(15, 3, rform.day, "ç”Ÿæ—¥ï¼š", "æ—¥");
+   getfield(17, 3, rform.sex, "å§“åˆ¥ï¼š", "ç”·/å¥³");

: admutil.c:scan_register_form()

    prints("ç”³è«‹ä»£è™Ÿ: %s (ç”³è«‹æ™‚é–“ï¼š%s)\n", userid, Btime(&rform.rtime));
+   prints("ç”Ÿæ—¥ï¼š%-2s/%-2s/%-2s  æ€§åˆ¥ï¼š%s\n",
+     rform.year, rform.month, rform.day, rform.sex);
    prints("æœå‹™å–®ä½: %s\n", rform.career);
    prints("ç›®å‰ä½å€: %s\n", rform.address);
    prints("é€£çµ¡é›»è©±: %s\n%s\n", rform.phone, msg_seperator);

  ...
  ...

    case 'y':

      /* æå‡æ¬Šé™ */
      sprintf(msg, "REG: %s:%s:%s:by %s",
        rform.phone, rform.career, rform.address, agent);
      justify_log(acct.userid, msg);
+     acct.year = atoi(rform.year);
+     acct.month = atoi(rform.month);
+     acct.day = atoi(rform.day);
+     acct.sex = strcmp(rform.sex, "ç”·") ?
+       (strcmp(rform.sex, "å¥³") ? 0 : 2) : 1;
      time(&(acct.tvalid));
      acct_setperm(&acct, PERM_VALID, 0);
+     utmp_admset(acct.userno, STATUS_DATALOCK);    /* ç«™é•·è“‹è³‡æ–™ */

: run/rform åŠ run/rform.log

  æ”¹äº† struct RFORM ä»¥å¾Œ
  èˆŠçš„ run/rform åŠ run/rform.log å°±ä¸èƒ½ç”¨äº†ï¼Œè¦åˆªé™¤

--
 [1;43mâ•­[46mâ”¼[m Or[1mig[30min[m: [41m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [32;47m processor.tfcis.org [m
 [1;44mâ”¼[41mâ•¯[m A[1mut[30mho[mr: [1;33mitoc [30må¾ [35mitoc.dorm11.nctu.edu.tw [30mç™¼è¡¨[m
