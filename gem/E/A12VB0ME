ç™¼ä¿¡äºº: itoc.bbs@cpu.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: é—œæ–¼"é€£ç½²ç³»çµ±"
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2007/03/12 Mon 21:58:18)                Updated: 2007/03/13

â€» å¼•è¿°ã€Šguessi (æ²’)ã€‹ä¹‹éŠ˜è¨€ï¼š
> åšäº†  â—‡ [åŠŸèƒ½] xover.c é€²å…¥ newboard æ¿å°±é€²é€£ç½²æ©Ÿ
> å¸Œæœ› newboard çœ‹æ¿æœªè®€ç‡ˆè™Ÿä¾æ“šé€£ç½²å…§å®¹é¡¯ç¤º
> æƒ³æ³•: åˆ¤æ–·é€£ç½²æ©Ÿåˆ¶å…§ æœ‰"ä»»ä¸€"é€£ç½²ä¸ç‚º"NBRD_FINISH"å‰‡é¡¯ç¤º"ICON_UNREAD_BRD"

: board.c:nbrd_unread() æ–°å¢å‡½å¼åœ¨ btime_refresh() å‰é¢

static int
nbrd_unread(folder)
  char *folder;
{
  NBRD nbrd;
  int fd;
  int rc = 0;

  if ((fd = open(folder, O_RDONLY)) >= 0)
  {
    while (read(fd, &nbrd, sizeof(NBRD)) == sizeof(NBRD))
    {
      if (!(nbrd.mode & NBRD_FINISH))
      {
        rc = 1;
        break;
      }
    }
    close(fd);
  }

  return rc;
}

: board.c:btime_refresh()

  if (brd->btime < 0)
  {
    int fd, fsize;
    char folder[64];
    struct stat st;

    brd->btime = 1;

+   if (!strcmp(brd->brdname, "newboard"))
+   {
+     sprintf(folder, "run/newbrd/%s", fn_dir);
+     brd->bpost = rec_num(folder, sizeof(NBRD));
+     brd->blast = nbrd_unread(folder) ? time(NULL) : 0;
+     return;
+   }

    brd_fpath(folder, brd->brdname, fn_dir);

: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ :

  ç„¶å¾Œåœ¨ newbrd.c è£¡é¢æ‰€æœ‰æœƒæ›´å‹• NBRD_FINISH æ——æ¨™çš„åœ°æ–¹
  éƒ½åŠ ä¸Š btime_update()

: newbrd.c:nbrd_add()

  rec_add(dir, &nbrd, sizeof(NBRD));
+ btime_update(brd_bno("newboard"));

: newbrd.c:nbrd_reply()

      if (!(nbrd->mode & NBRD_FINISH))
      {
        nbrd->mode ^= NBRD_FINISH;
        currchrono = nbrd->btime;
        rec_put(xo->dir, nbrd, sizeof(NBRD), xo->pos, cmpbtime);
+       btime_update(brd_bno("newboard"));
      }

  ...
  ...

    currchrono = nbrd->btime;
    rec_ref(xo->dir, nbrd, sizeof(NBRD), xo->pos, cmpbtime, addreply);
+   btime_update(brd_bno("newboard"));

: newbrd.c:nbrd_finish()

  nbrd->mode ^= NBRD_FINISH;
  currchrono = nbrd->btime;
  rec_put(xo->dir, nbrd, sizeof(NBRD), xo->pos, cmpbtime);
+ btime_update(brd_bno("newboard"));

: newbrd.c:nbrd_open()

      nbrd->mode ^= NBRD_FINISH;
      currchrono = nbrd->btime;
      rec_put(xo->dir, nbrd, sizeof(NBRD), xo->pos, cmpbtime);
+     btime_update(brd_bno("newboard"));

: newbrd.c:nbrd_delete()

  rec_del(xo->dir, sizeof(NBRD), xo->pos, cmpbtime);
+ btime_update(brd_bno("newboard"));

--
[1;36m=[37m[[36mï¹[37m:[33m?[37mæ‘ƒ?[mâ—£?[1;33m?[37m:[36mï¹ [31mOrigin[37m ]|[[m  [0;31m?[1m?[1m?[0;31mO[0;31m?[1m?[1m?[0;31m?[1mcpu.tfcis.org  [37m]|[?[33mæŸèªª[m?[1;36mï¹[37m:][36m=[m
[1;36m=[0m[[1;36mï¹Š[37m:[33m?[30mæ‘ƒ?[mâ•±?[1;33m?[37m:[36mï¹Š [31mAuthor[m ]|[[1m218-168-194-169.dynamic.hi[m]|[?[1;33m?[30m?[37mæ’[30m?[36mï¹Š[37m:[m][1;36m=[m
