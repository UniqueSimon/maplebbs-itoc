ç™¼ä¿¡äºº: itoc.bbs@cpu.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [åŠŸèƒ½] æ–‡ç« ç½®åº•
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2004/12/17 Fri 01:37:37)                Updated: 2004/12/17

â€» å¼•è¿°ã€Šitoc (æ ¸å¿ƒå‹•åŠ›)ã€‹ä¹‹éŠ˜è¨€ï¼š
>   ç„¡è«–æ–¹æ³•ä¸€é‚„æ˜¯æ–¹æ³•äºŒï¼Œè©•åˆ†éƒ½æ˜¯å¯ä»¥é€£å‹•ï¼Œåªæ˜¯æ–¹æ³•äºŒæ²’å¯«è€Œå·²

  æ–¹æ³•äºŒçš„æŽ¨æ–‡åˆ†æ•¸é€£å‹•

: hdr.h:struct HDR

- char xname[32];               /* æª”æ¡ˆåç¨± */
+ char xname[28];               /* æª”æ¡ˆåç¨± */
+ time_t parent_chrono;         /* ç½®åº•æ–‡çš„æ­£æœ¬æ˜¯å“ªç¯‡ */

: post.c:post_bottom()

    hdr_stamp(xo->dir, HDR_LINK | 'A', &post, fpath);
+   post.parent_chrono = hdr->chrono;
    post.xmode = POST_BOTTOM;

: post:post_score()

  if (curraddscore)
  {
    currchrono = hdr->chrono;
    rec_ref(dir, hdr, sizeof(HDR), xo->key == XZ_XPOST ?
      hdr->xid : pos, cmpchrono, addscore);

+   if (hdr->xmode & POST_BOTTOM)  /* è‹¥æ˜¯è©•åˆ†ç½®åº•æ–‡ç« ï¼ŒåŽ»æ‰¾æ­£æœ¬ä¾†é€£å‹•åˆ†æ•¸ */
+   {
+     currchrono = hdr->parent_chrono;
+     rec_ref(dir, hdr, sizeof(HDR), 0, cmpchrono, addscore);
+   }
+   else                           /* è‹¥æ˜¯è©•åˆ†ä¸€èˆ¬æ–‡ç« ï¼ŒåŽ»æ‰¾è¬„æœ¬ä¾†é€£å‹•åˆ†æ•¸ */
+   {
+     /* currchrono = hdr->chrono; */ /* å‰é¢æœ‰äº† */
+     rec_ref(dir, hdr, sizeof(HDR), 0, cmpparent, addscore);
+   }

    return XO_LOAD;
  }

: post.c:cmpparent() åŠ åœ¨ cmpchrono() å¾Œé¢

static int
cmpparent(hdr)
  HDR *hdr;
{
  /* å¯ä»¥ä¸ç”¨æª¢æŸ¥ POST_BOTTOMï¼Œå› ç‚ºä¸€èˆ¬æ–‡ç« çš„ parent_chrono = 0 */
  return /* (hdr->xmode & POST_BOTTOM) && */
    (hdr->parent_chrono == currchrono);
}


--
 [1;43mâ—¤[46mâ—¥[m Or[1mig[30min[m: [41m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [36;47m cpu.tfcis.org [m
 [1;44mâ—£[41mâ—¢[m A[1mut[30mho[mr: [1;33mitoc [30må¾ž [31mitoc.Dorm11.NCTU.edu.tw [30mç™¼è¡¨[m
