ä½œè€…: itoc (:MM:) çœ‹æ¿: itoc
æ¨™é¡Œ: Re: [å•é¡Œ]WindTopçš„FirewallåŠŸèƒ½
æ™‚é–“: Sat Jan  4 14:18:29 2003                          Updated: 2006/11/10

â€» å¼•è¿°ã€Šdundung.bbs@no.bbs.ee.nchu.edu.tw.spam (æ˜Ÿæµ·ä¸­çš„ç™¼å‘†ç¾Š)ã€‹ä¹‹éŠ˜è¨€ï¼š
> æƒ³è¦è‡ªè¨‚æ¢ä»¶æ¿¾ä¿¡çš„è©±é€™åŠŸèƒ½çœŸçš„ä¸éŒ¯ç”¨

  åœ¨ rec_article.c çš„ bbspost_add()

  board    æ˜¯ è¦è½‰é€²çš„çœ‹æ¿
  userid   æ˜¯ ä½œè€…çš„ email
  usernick æ˜¯ ä½œè€…çš„æš±ç¨±
  SUBJECT  æ˜¯ æ–‡ç« æ¨™é¡Œ
  SITE     æ˜¯ Organization:
  MSGID    æ˜¯ MessageID:
  BODY     æ˜¯ å…§å®¹

  æ‰€ä»¥ä½ åªè¦åœ¨é€™è£¡å‹•æ‰‹è…³å³å¯

: rec_article.c:bbspost_add()

+ brd_fpath(fpath, board, "spam");                  /* æ¯å€‹æ¿è‡ªå·±çš„ spam */
+ if (belong_spam(fpath, addr, nick))
+ {
+   board = "apple";   [1;44m// æŠŠæœ‰æ¿¾æŽ‰çš„ä¿¡é€åŽ» apple æ¿ï¼Œæ¿åè‡ªå®š [m
+ }

  /* å¯«å…¥æ–‡ç« å…§å®¹ */

  brd_fpath(folder, board, FN_DIR);

: è€Œ belong_spam() å¯ä»¥é€™æ¨£å¯«
: rec_article.c åœ¨ bbspost_add() å‰é¢æ–°å¢žä»¥ä¸‹å‡½å¼

static int
belong_spam(filelist, addr, nick)
  char *filelist, *addr, *nick;
{
  FILE *fp;
  char buf[80];
  char user[80], *host;
  char *type, *spam;
  int rc, checknum;

  rc = 0;
  if (fp = fopen(filelist, "r"))
  {
    str_ncpy(user, addr, sizeof(user));  /* é˜²æ­¢å­—ä¸²å¤ªé•·è“‹éŽé ­ */
    if (host = (char *) strchr(user, '@'))
    {
      *host = '\0';
      host++;
    }

    checknum = 0;
    while (fgets(buf, 80, fp))
    {
      if (buf[0] == '#')    /* åŠ  # æ˜¯è¨»è§£ */
        continue;

      if (++checknum >= 100)    /* é™ 100 æ¢ rule */
        break;

      type = (char *) strtok(buf, " \t\r\n");
      if (type && *type)
      {
        spam = (char *) strtok(NULL, " \t\r\n");
        if (spam && *spam)
        {
          /* nickã€host å¯ä»¥æ˜¯ NULLï¼Œæ•…è¦æª¢æŸ¥ */
          str_lowest(spam, spam);
          if ((!strcmp(type, "user") && str_sub(user, spam)) ||
            (!strcmp(type, "host") && host && str_sub(host, spam)) ||
            (!strcmp(type, "nick") && nick && str_sub(nick, spam)) ||
            (!strcmp(type, "subj") && str_sub(SUBJECT, spam)) ||
            (!strcmp(type, "site") && str_sub(SITE, spam)) ||
            (!strcmp(type, "from") && str_sub(FROM, spam)) ||
            (!strcmp(type, "msgi") && str_str(MSGID, spam)))
          {
            rc = 1;
            break;
          }
        }
      }
    }
    fclose(fp);
  }
  return rc;
}

: æŽ¥ä¸‹ä¾†ä½ è¦åœ¨çœ‹æ¿è®“æ¿ä¸»å¯ä»¥ç·¨ spam é€™å€‹æª”æ¡ˆ
: src/so/manage.c:post_spam_edit() æ–°å¢žæ–¼ post_memo_edit() å¾Œé¢

static int
post_spam_edit(xo)
  XO *xo;
{
  int mode;
  char fpath[64];

  mode = vans("æ“‹ä¿¡åˆ—è¡¨ (D)åˆªé™¤ (E)ä¿®æ”¹ (Q)å–æ¶ˆï¼Ÿ[E] ");

  if (mode != 'q')
  {
    brd_fpath(fpath, currboard, "spam");

    if (mode == 'd')
    {
      unlink(fpath);
      return XO_FOOT;
    }
    else
    {
      if (vedit(fpath, 0))      /* Thor.981020: æ³¨æ„è¢«talkçš„å•é¡Œ */
        vmsg(msg_cancel);
    }

    return XO_HEAD;
  }
  return XO_FOOT;
}

: manage.c:post_manage()

    "WMemo   ç·¨è¼¯é€²æ¿ç•«é¢",
+   "Spam    çœ‹æ¿æ“‹ä¿¡åˆ—è¡¨",
    "Manager å¢žæ¸›å‰¯æ¿ä¸»",

  ...
  ...

- char *menu = "â—Ž æ¿ä¸»é¸å–® (B)ä¸»é¡Œ (W)é€²æ¿ (M)å‰¯æ¿"
+ char *menu = "â—Ž æ¿ä¸»é¸å–® (B)ä¸»é¡Œ (W)é€²æ¿ (S)æ“‹ä¿¡ (M)å‰¯æ¿"

  ...
  ...

  case 'w':
    ret = post_memo_edit(xo);
    break;

+ case 's':
+   ret = post_spam_edit(xo);
+   break;

> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

  spam é€™æª”æ¡ˆçš„æ ¼å¼ç‚º

# é€™æ˜¯è¨»è§£ï¼Œè¦æ“‹äºŒå€‹å°±å¯«äºŒæ¬¡
# è¦æ³¨æ„è‹±æ–‡è¦å…¨ç‚ºå°å¯«
user    fuck
user    shit
host    hinet.net
nick    å¹¹
subj    ä¸è¦çš„æ¨™é¡Œ
site    hinet
from    someone@some.domain
msgi    netnews.seed.net.tw
msgi    netnews.hinet.net
#
# å¦‚æžœå¾Œé¢ spam çš„å…§å®¹æœ‰ç©ºæ ¼ï¼ŒåªæœƒæŠ“åˆ°ç¬¬ä¸€å€‹å­—ä¸²
# ä¹Ÿå°±æ˜¯èªªä¸‹é¢é€™äºŒè¡Œçš„æ•ˆæžœæ˜¯ä¸€æ¨£çš„
site    giga news service
site    giga

> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

  spam æ¯”è¼ƒçš„å…§å®¹æ˜¯

ç™¼ä¿¡äºº: itoc.bbs@processor.tfcis.org (ä»Šå¤©ä¸‹é›¨), çœ‹æ¿: itoc
æ¨™  é¡Œ: Re: çœ‹æ¿çš„é–±è®€æ¬Šé™
ç™¼ä¿¡ç«™: XEON (Sun Jan  5 01:04:28 2003)
è½‰ä¿¡ç«™: kulu!TomatoNEWS!news.tfcis.org!PROCESSOR
Origin: zhouer.mcl.math.ncu.edu.tw

  user æ¯”å° itoc.bbs
  host æ¯”å° processor.tfcis.org
  nick æ¯”å° ä»Šå¤©ä¸‹é›¨
  subj æ¯”å° Re: çœ‹æ¿çš„é–±è®€æ¬Šé™
  site æ¯”å° XEON
  from æ¯”å° itoc.bbs@processor.tfcis.org

--
    [1;32mâ•­â”€â”€ Origin â•® [33;45m å‹•åŠ›æ ¸å¿ƒ [37m processor.tfcis.org [32;40m ï½ž Î´ÎµÎ¶ â”€â”€â”¼[m
    [1;32mâ”¼     Author â•¯ [36mitoc.Dorm-GD2.NCTU.edu.tw[m
