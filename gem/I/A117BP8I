ä½œè€…: itoc (æ ¸å¿ƒå‹•åŠ›) ç«™å…§: itoc
æ¨™é¡Œ: Re: æ˜¯å¦å¯ä»¥è€ƒæ…®å¢åŠ æ¸…é™¤æ¨æ–‡å…§å®¹çš„åŠŸèƒ½(ä¸é›…çš„ä¸€è¡Œæ–‡)???
æ™‚é–“: 2004/10/15 Fri 22:26:48                           Updated: 2004/10/24

â€» å¼•è¿°ã€Šcomfan (é›£é  å‚·å¿ƒ)ã€‹ä¹‹éŠ˜è¨€ï¼š
> æœ‰äº›äººæ¿«ç”¨æ¨è–¦æ–‡ç« åŠŸèƒ½çš„å›ä¸€è¡Œæ–‡ åœ¨å›æ‡‰åˆ¥äººçš„æ–‡ç« ä¹‹ä¸­å‡ºç¾äº†
> ä¸é›…æˆ–ç½µäºº  äººèº«æ”»æ“Š....ç­‰çš„å­—çœ¼
> æ˜¯å¦å¯ä»¥å¢åŠ ä¸€å€‹åŠŸèƒ½è®“ç‰ˆä¸»åœ¨ä»–è² è²¬ç®¡ç†çš„çœ‹æ¿è£¡é¢æŒ‰æŸå€‹æŒ‰éµ(æŒ‡ä»¤)
> æ¸…é™¤ä¸€è¡Œæ–‡çš„å…§å®¹

: post.c:post_delscore() æ–°å¢åœ¨ post_help() å‰é¢

#ifdef HAVE_SCORE
static int
post_delscore(xo)
  XO *xo;
{
  int start_quote, len;
  HDR *hdr;
  char fpath[64], fnew[64], userid[32], reason[50], buf[ANSILINELEN];
  FILE *fpr, *fpw;
  struct tm *ptime;
  time_t now;

  if (!cuser.userlevel || !(bbstate & STAT_POST))       /* è©•åˆ†è¦–åŒç™¼è¡¨æ–‡ç«  */
    return XO_NONE;

  if (!vget(b_lines, 0, "è¦åˆªé™¤çš„è©•åˆ†(é—œéµå­—)ï¼š", reason, 50, DOECHO))
    return XO_FOOT;

  if (!(bbstate & STAT_BOARD))
  {
    sprintf(userid, "â†’ \033[36m%s \033[3", cuser.userid);
    len = strlen(userid);
  }

  hdr = (HDR *) xo_pool + (xo->pos - xo->top);
  hdr_fpath(fpath, xo->dir, hdr);

  if (!(fpr = fopen(fpath, "r")))
    return XO_FOOT;

  time(&now);
  ptime = localtime(&now);

  sprintf(fnew, "%s.new", fpath);
  fpw = fopen(fnew, "w");

  start_quote = 0;
  while (fgets(buf, sizeof(buf), fpr))
  {
    if (!start_quote)
    {
      if (!strcmp(buf, "--\n"))
        start_quote = 1;
    }
    else
    {
      if ((bbstate & STAT_BOARD || !strncmp(buf, userid, len)) &&
        strstr(buf, reason))
      {
        [1;44m// è‹¥åŠ å…¥ä¸‹ä¸€è¡Œ continue; é‚£éº¼åœ¨æ–‡ç« å…§å°±ä¸æœƒé¡¯ç¤ºæ¨æ–‡è¢«åˆªé™¤çš„è¨Šæ¯ [m
        /* continue; */

        sprintf(buf, "â†’ \033[36m%s \033[35måˆª\033[mï¼š"
          "\033[1;33m%-*s\033[m%02d/%02d/%02d\n",
          cuser.userid, 62 - strlen(cuser.userid), "æ­¤æ„è¦‹è¢«åˆªé™¤",
          ptime->tm_year % 100, ptime->tm_mon + 1, ptime->tm_mday);
      }
    }
    fputs(buf, fpw);
  }

  fclose(fpw);
  fclose(fpr);

  unlink(fpath);
  rename(fnew, fpath);

  return post_head(xo);
}
#endif

: post.c:post_cb[]

#ifdef HAVE_SCORE
  '%', post_score,
+ 'K', post_delscore,           [1;44m // æŒ‰éµè‡ªå®š [m
#endif


--
 [1;41mâ•­[44mâ”¼[m Or[1mig[30min[m: [43m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [35;47m processor.tfcis.org [m
 [1;43mâ•°[46mâ•–[m [1mMo[30mdi[mfy: [1;35m2004/10/15 Fri 22:27:14[m
