ç™¼ä¿¡äºº: kevinblue.bbs@nightless.twbbs.org (å‡±æ–‡è—) çœ‹æ¿: plan
æ¨™  é¡Œ: [åŠŸèƒ½] ä¸­æ–‡ç‰ˆBBCæ–°è
ç™¼ä¿¡ç«™: åŸå€å¤œæœªçœ  (2006/08/28 Mon 21:57:03)              Updated: 2006/08/28

ä»Šå¤©ç¨å¾®èŠ±äº†é»æ™‚é–“å˜—è©¦parseçœ‹çœ‹å…¶ä»–æœ‰æä¾›æ–°èç«™å°çš„ç¶²ç«™

é¸BBCæœ‰å¹¾å€‹åŸå› 
1. ä¸åƒyahooæœ‰cookieé‚„æœ‰ä¸€å †å¥‡å¥‡æ€ªæ€ªçš„è¦å‰‡
2. æœ‰æä¾›ç´”æ–‡å­—ç‰ˆæ–°è(æ–¹ä¾¿parse)

ä»¥ä¸‹æ˜¯æˆ‘æ”¹çš„code(å¾å¥‡æ‘©æ–°èä¿®æ”¹ï¼Œparse RSSæŠ“æ–°è)
http://opensvn.csie.org/nightlessbbs/freebsd/trunk/src/util/bbc-enews-open.c
ç‚ºäº†é…åˆBBCæ–°èæˆ‘ä¿®æ”¹äº†ENEWSçš„struct

typedef struct
{
  time_t chrono;                /* ç·¨è™Ÿ */
  char kind;                    /* ç¨®é¡ */
  char xname[50];               /* æª”æ¡ˆåç¨± */

  char link[128];               /* é€£çµè·¯å¾‘ */
[1;33m+ char description[512];        /* æ–°èå¤§è¦ */[m
  char title[TTLEN + 1];        /* æ–‡ç« æ¨™é¡Œ */
} ENEWS;

æ–°èå¤§è¦å¯ä»¥æ”¾åœ¨cnaä¸Š

å¦å¤–ç”±æ–¼BBCçš„æ–°èé€£çµéƒ½å¾ˆé•·ï¼Œæ‰€ä»¥æˆ‘ç”¨libcurlçš„APIå¯«äº†bbsè‡ªå‹•ç¸®ç¶²å€çš„function
è«‹é…åˆshorten_url.cçœ‹
http://opensvn.csie.org/nightlessbbs/freebsd/trunk/src/lib/mk0rz.c

é‚„æœ‰ä¾›å¤–éƒ¨å‘¼å«çš„åŸ·è¡Œæª”
http://opensvn.csie.org/nightlessbbs/freebsd/trunk/src/util/shorten_url.c

æ–°èparseçš„éƒ¨ä»½ä¸æ•¢èªªéƒ½æ²’æœ‰å•é¡Œï¼Œå› ç‚ºBBCçš„ç¶²é å…§å®¹é‚„è »å¤šæ ¼å¼çš„
æˆ‘åªæ˜¯å¸Œæœ›ç›¡é‡å¯ä»¥æŠŠæ–°èæŠ“é€²ä¾†ï¼Œä¸è¶³çš„éƒ¨ä»½å¸Œæœ›æœ‰äººå¯ä»¥ä¸€èµ·è£œè¶³ :)

libcurléƒ¨ä»½è«‹åƒè€ƒ http://curl.haxx.se/libcurl/c/allfuncs.html

ps.æœ‰æ²’æœ‰äººæƒ³å˜—è©¦çœ‹çœ‹è˜‹æœæ—¥å ±ï¼Ÿ
   å¦‚æœä½ è¦ç”¨æˆ‘çš„mk0rzè«‹å®‰è£curl
   é—œæ–¼å¦‚ä½•å’Œlibcurl linkingè«‹åŸ·è¡Œcurl-config
   æˆ–è€…åœ¨Makefileä¸ŠåŠ ä¸Š -lcurl è©¦è©¦(æˆ‘é€™æ¨£æ˜¯å¯è¡Œçš„)

: src/util/bbc-enews-open.c æ–°å¢æ­¤ç¨‹å¼ï¼ŒMakefile è¦åŒæ­¥æ”¹

/*-------------------------------------------------------*/
/* util/enews-open.c    ( NTHU CS MapleBBS Ver 3.10 )    */
/*-------------------------------------------------------*/
/* target : BBCæ–°èæ›´æ–°                                 */
/* create : 02/01/29                                     */
/* update :   /  /                                       */
/* author : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/


#if 0

æœ¬BBCæ–°èæ›´æ–°ç¨‹å¼éœ€è¦é…åˆ contab å»æŠ“è³‡æ–™ï¼Œcrontab å¦‚ä¸‹ï¼š

# æ¯å¤© 10:30AM 4:30PM æŠ“å¥‡æ‘©æ–°è
   30 10,16 * * * bin/enews-open
      è¦ä½¿ç”¨ enews-open.c å¿…é ˆè£æœ‰ lynxï¼Œæ³¨æ„ lynx çš„è·¯å¾‘è¦å’Œç¨‹å¼å»åˆã€‚
         å¦‚æœä¸»æ©Ÿéœ€é€é proxy æ‰èƒ½é€£å¤–çš„è©±ï¼Œé‚£éº¼è¦ä¿®æ”¹ lynx.cfg çš„ http_proxy
è¨­å®šå€¼ã€‚
            æ–‡ç« æª”æ¡ˆæ”¾åœ¨ run/kimo/

            bbc rss
            http://news.bbc.co.uk/chinese/trad/hi/institutional/rss/default.st
m#userss?
            XML RSS feedä¸­æ–‡ç¶²ä¸»é 
            http://newsrss.bbc.co.uk/rss/chinese/trad/news/rss.xml

            XML RSS feedåœ‹éš›æ–°è
            http://newsrss.bbc.co.uk/rss/chinese/trad/world/rss.xml

            XML RSS feedä¸­åœ‹å ±å°
            http://newsrss.bbc.co.uk/rss/chinese/trad/china_news/rss.xml

            XML RSS feedæ¸¯å°æ¶ˆæ¯
            http://newsrss.bbc.co.uk/rss/chinese/trad/taiwan_hk/rss.xml

            XML RSS feedè‹±åœ‹å‹•æ…‹
            http://newsrss.bbc.co.uk/rss/chinese/trad/uk/rss.xml

            XML RSS feedè‹±èªæ•™å­¸
            http://newsrss.bbc.co.uk/rss/chinese/trad/learn_english/rss.xml

            XML RSS feedé‡‘èè²¡ç¶“
            http://newsrss.bbc.co.uk/rss/chinese/trad/business/rss.xml

            XML RSS feedç§‘æŠ€å¥åº·
            http://newsrss.bbc.co.uk/rss/chinese/trad/sci/tech/rss.xml

            XML RSS feedè‹±åœ‹å ±æ‘˜
            http://newsrss.bbc.co.uk/rss/chinese/trad/press/rss.xml

            note. rssè£¡é¢çš„linkéƒ½æ˜¯ä»¥åœ–æ–‡ç‰ˆç‚ºä¸»ï¼Œä¸éparseæ¯”è¼ƒå®¹æ˜“çš„æ˜¯ç´”æ–‡å­—ç‰ˆ
            linkçš„å·®åˆ¥åªåœ¨lowè·Ÿhi
            ex.
            åœ–æ–‡ç‰ˆ
            http://news8.thdo.bbc.co.uk/chinese/trad/hi/newsid_5290000/newsid_
5290200/5290212.stm
            ç´”æ–‡å­—ç‰ˆ
            http://news8.thdo.bbc.co.uk/chinese/trad/low/newsid_5290000/newsid
_5290200/5290212.stm

#endif

#include "bbs.h"

#define LYNX_PATH   "/usr/local/bin/lynx --source"  /* lynx çš„çµ•å°è·¯å¾‘ */
#define POSTBOARD   "bbc_news"      //æ¬²postæ–°èçš„ç‰ˆå
#define INDEX_FILE  "tmp/bbc_index"
#define NEWS_FILE   "tmp/bbc_news"
#define RSS         "http://newsrss.bbc.co.uk/rss/chinese/trad/"
#define BBC_NEWS    "http://news8.thdo.bbc.co.uk/chinese/trad/low/"
#define BBC_NEWS_HI "http://news8.thdo.bbc.co.uk/chinese/trad/hi/"

            /*-------------------------------------------------------*/
            /* æ–‡ç« è½‰åˆ°çœ‹æ¿                                          */
            /*-------------------------------------------------------*/

            static BCACHE *bshm;
         static void
            init_bshm()
            {
               /* itoc.030727: åœ¨é–‹å•Ÿ bbsd ä¹‹å‰ï¼Œæ‡‰è©²å°±è¦åŸ·è¡Œé accountï¼Œæ‰€ä»¥
bshm æ‡‰è©²å·²è¨­å®šå¥½ */
         bshm = shm_new(BRDSHM_KEY, sizeof(BCACHE));

         if (bshm->uptime <= 0)        /* bshm æœªè¨­å®šå®Œæˆ */
            exit(0);
      }

   static void
      update_btime(brdname)
      char *brdname;
   {
      BRD *bhdr, *tail;

      bhdr = bshm->bcache;
      tail = bhdr + bshm->number;
      do
      {
         if (!str_cmp(brdname, bhdr->brdname))
         {
            bhdr->btime = -1;
            break;
         }
      } while (++bhdr < tail);
   }

   static bool                      /* return true: ä»¥å‰å°±æŠ“éçš„é€£çµ */
      old_link(fold, link)
      char *fold;
   char *link;
   {
      bool rc = false;
      ENEWS enews;
      FILE *fp;

      if (fp = fopen(fold, "r"))
      {
         while (fread(&enews, sizeof(ENEWS), 1, fp) == 1)
         {
            if (!strcmp(enews.link, link))
            {
               rc = true;
               break;
            }
         }

         fclose(fp);
      }

      /*if(rc)
         printf("linké‡è¤‡\n");
      else
         printf("æ–°link\n");*/

      return rc;
   }

   static char* Userid = "æ–°èå ±é¦¬ä»”";
   static char* Usernick="CTRL+Oå¯ä»¥å®Œæ•´é–±\è®€!";

   static void
      post_board(fpath, title, kind)
      char *fpath;
   char *title;
   int kind;
   {
      char folder[64];
      HDR hdr;
      char *class[] =
      {
         "åœ‹éš›æ–°è", "ä¸­åœ‹å ±å°", "æ¸¯å°æ¶ˆæ¯", "è‹±åœ‹å‹•æ…‹",
         "é‡‘èè²¡ç¶“", "ç§‘æŠ€å¥åº·"
      };

      char *board = POSTBOARD;    // è½‰å» KimoNews æ¿ï¼Œè‡ªå®š

      brd_fpath(folder, board, FN_DIR);
      hdr_stamp(folder, HDR_COPY | 'A', &hdr, fpath);
      strcpy(hdr.nick, Usernick);
      strcpy(hdr.owner, Userid);
      sprintf(hdr.title, "[%s] %.64s", class[kind], title);
      rec_add(folder, &hdr, sizeof(HDR));

      update_btime(board);
   }


   /*-------------------------------------------------------*/
   /* åˆ†æ html                                             */
   /*-------------------------------------------------------*/


   static int wlen;    /* æœ¬è¡Œæœ‰å¤šå°‘å­— */
   static int slen;    /* æœ¬è¡Œæœ‰å¤šå°‘åŠå½¢å­— */

   static void
      foutc(ch, fp)
      int ch;
   FILE *fp;
   {
      static int in_tag = 0;    /* 1: åœ¨ <tag> ä¸­ */
      static int in_chi = 0;    /* 1: å‰ä¸€ç¢¼æ˜¯ä¸­æ–‡å­— */

      if (ch == '<')
      {
         in_tag = 1;
         return;
      }

      if (!in_tag)
      {
         if (in_chi || ch & 0x80)    /* å‰ä¸€å€‹charæˆ–é€™charæ˜¯ä¸­æ–‡å­—çš„ç¬¬ä¸€ç¢¼ */
            in_chi ^= 1;
         else                        /* å¦‚æœéƒ½ä¸æ˜¯ï¼Œè¡¨ç¤ºé€™charæ˜¯åŠå½¢å­— */
            slen++;

         if (wlen >= 60 - slen % 2)  /* ä¸€è¡Œæœ€å¤š 60 å­—ï¼Œè‹¥æœ‰å¥‡æ•¸å€‹åŠå½¢å­—ï¼Œ
                                        è©²è¡Œåªå° 59 å­— */
         {
            fputs("\n  ", fp);      /* æ¯è¡Œå‰é¢éƒ½ç©ºå››æ ¼ */
            wlen = 0;
            /* slen = 0; */
            slen = !in_chi;           /* è‹¥æ–°çš„é€™è¡Œç¬¬ä¸€å€‹charæ˜¯åŠå½¢å­—ï¼Œslen=1
*/
         }

         fputc(ch, fp);
         wlen++;
      }
      else
      {
         if (ch == '>')
            in_tag = 0;
      }
   }


   static void
      fouts(str, fp)
      uschar *str;
   FILE *fp;
   {
      int ch;

      wlen = 0;
      slen = 0;
      fputs("\n  ", fp);      /* æ¯è¡Œå‰é¢éƒ½ç©ºå››æ ¼ */

      while (ch = *str)
      {
         foutc(ch, fp);
         str++;
      }
   }


   static void
      html_download(enews, kind)        /* ä¸‹è¼‰æ–‡ç« ä¸¦è½‰æ›ç‚ºæ–‡å­—æª” */
      ENEWS *enews;
   int kind;
   {
      char *strS, *strE;
      char buf[2048];   /* å‡è¨­æ–‡ç« æ¯æ®µä¸æœƒè¶…é 2048 å­— */
      char fpath[64];
      FILE *fpr, *fpw;
      bool skip = false;

      /* ä¸‹è¼‰æ–‡ç«  */
      if(enews->link)
         sprintf(buf, LYNX_PATH " " BBC_NEWS "%s  > " NEWS_FILE, enews->link);

      system(buf);

      /* è½‰æ›ç‚ºæ–‡å­—æª” */
      if (fpr = fopen(NEWS_FILE, "r"))
      {
         sprintf(fpath, "run/bbc/%d/%s", kind, enews->xname);
         //printf("å¯«å…¥ï¼š %s\n", fpath);

         if (fpw = fopen(fpath, "w"))
         {
            /* é–‹é ­åŠ ä¸Šæ¨™é¡Œ */
         fprintf(fpw, "%s %s (%s) %s %s\n",STR_AUTHOR1, Userid, Usernick, STR_
POST2, "BBCNews");
         fprintf(fpw, "æ¨™é¡Œ: %s\næ™‚é–“: %s\n", enews->title, Now());

         /* html -> text */
         fgets(buf, sizeof(buf), fpr);

         while(!strstr(buf, "<!-- E IIMA -->"))
            fgets(buf, sizeof(buf), fpr);

         fgets(buf, sizeof(buf), fpr);

         while(!strstr(buf, "<!-- E BO --><!-- E BO -->") &&
               !strstr(buf, "<!-- E BO --><br>")&&
               !strstr(buf, "ç¶²å‹æ„è¦‹é¸ç™»ï¼š"))
         {
            if(strstr(buf, "<p>") || strstr(buf, "<P>") || strstr(buf, "<!-- S
 SF -->") ||
                  strstr(buf, "<!-- E SF -->") ||
                  strstr(buf, "<ul class") || strstr(buf, "</ul>"))
               skip=true;
            else if((strS = strstr(buf, "<li>")))
            {
               strE = strstr(buf, "</li>");

               if(strE)
                  *(strE) = '\0';

               str_ncpy(buf, buf+4, sizeof(buf)); //æŠŠ<li>å»æ‰;
            }
            else if((strS = strstr(buf, "<b>")))
            {
               strE = strstr(buf, "</b>");

               if(strE)
                  *(strE)= '\0';

               str_ncpy(buf, buf+3, sizeof(buf));//æŠŠ<b>å»æ‰

               //printf("%s\n", buf);
            }
            else if((strS = strstr(buf, "</B>")))
            {
               strE = strstr(buf, "</B>");

               if(strE)//æœ‰</B>
                  *(strE)= '\0';

               str_ncpy(buf, buf+3, sizeof(buf));//æŠŠ<b>å»æ‰

               //printf("%s\n", buf);
            }
            else if((strS = strstr(buf, "<br />")))
            {
               //*(strS) = "\n"; //æŠŠ<br />æ›æˆ\n
            }
            else if(strstr(buf, "<!-- S IIMA -->"))
            {
               while(!strstr(buf, "<!-- E IIMA -->"))
                  fgets(buf, sizeof(buf), fpr);
            }

            if(!skip && buf[0] !='\n')
            {
               //printf("%s", buf);
               fouts(&buf[0], fpw);
            }

            skip=false;
            fgets(buf, sizeof(buf), fpr);
         }

         /* çµå°¾åŠ ä¸Šé€£çµ */
         sprintf(buf, BBC_NEWS_HI"%s", enews->link);
         fprintf(fpw, "\n--\nè‹±åœ‹BBCæ–°è %s\n\n", mk0rz(buf));
         fclose(fpw);

         post_board(fpath, enews->title, kind);
      }
      fclose(fpr);
      unlink(NEWS_FILE);  /* æ¸…é™¤æš«å­˜æª” */
   }
}//end

void
xml_fetch(fpath, kind)  /* å°‡é€™æª”æ¡ˆä¸­æœ‰æ•ˆçš„é€£çµæ‰¾å‡ºä¾† */
char *fpath;
int kind;        /* ç¨®é¡ */
{
   static int chrono = 0;
   FILE *fp;
   char folder[64], fold[64], buf[1024];
   char *strA, *strB;
   ENEWS enews;
   int space=0;
   bool skip = false;

   if (!(fp = fopen(fpath, "r")))
      return;

   sprintf(folder, "run/bbc/%d/.ENEWS", kind);
   sprintf(fold, "%s.o", folder);
   f_mv(folder, fold);

#if 0
   è™•ç† XML æ ¼å¼å¦‚ä¸‹ï¼š
      <item>
      <title>ç¾åœ‹é£›æ©Ÿå¤±äº‹â€œè·‘é“äº‹æ•…å¼•èµ·â€</title>
      <description>ç¾åœ‹Comairè¡¨ç¤ºï¼Œç­æ©Ÿ5191è™Ÿå› â€œè·‘é“äº‹æ•…â€å¤±äº‹ï¼Œ50åä¹˜å®¢å’Œæ©Ÿ
çµ„äººå“¡ä¸­ä¸€äººç”Ÿé‚„ã€‚</description>
      <link>http://news.bbc.co.uk/go/rss/-/chinese/trad/hi/newsid_5290000/news
id_5290800/5290846.stm</link>
      <guid isPermaLink="false">http://news.bbc.co.uk/chinese/simp/hi/newsid_5
290000/newsid_5290800/5290846.stm</guid>
      <pubDate>Sun, 27 Aug 2006 14:43:31 GMT</pubDate>
      <category>ä¸­æ–‡ç¶²ä¸»é </category>
      </item>

#endif

      //while (fgets(buf, sizeof(buf), fp) && article_num <= 30)//æ¯æ¬¡æŠ“30å‰‡æ–°
è
      while (fgets(buf, sizeof(buf), fp))
      {
         if (strstr(buf, "<item>"))
         {
            /* åŠ å…¥ record */
            memset(&enews, 0, sizeof(ENEWS));
            enews.chrono = ++chrono;      /* æ¯ç¯‡æ–‡ç« ä¸€å€‹ç·¨è™Ÿ */
            enews.kind = kind;
            sprintf(enews.xname, "A%06d%d", chrono, kind); //æª”å
            //printf("filename: %s\n", enews.xname); //æª”å

            fgets(buf, sizeof(buf), fp); /* å¦‚æœæ‰¾åˆ°itemå‰‡ä¸‹ä¸€å€‹å¿…æ˜¯<title> */
            strA = strstr(buf, "</title>");//æŠ“åˆ°</title>ç‚ºæ­¢

            if(!strA)//å¦‚æœ<title>è·Ÿ</title>ä¸å†åŒä¸€è¡Œ
               skip = true; //æé†’è¦å¤šskipæ‰ä¸æ˜¯åŒä¸€è¡Œçš„</title>
            else
               *strA = '\0';

            strB = &buf[0];
            while(*strB == ' ')
            {
               space++;
               strB++;
            }
            str_ncpy(enews.title, buf + space + 7, sizeof(enews.title));//buf+
7: <title>ä¸è¦
            //printf("title: %s\n", enews.title);
            space=0;
            if(skip)
               fgets(buf, sizeof(buf), fp); /* skip </title> */
            skip = false;


            fgets(buf, sizeof(buf), fp);/* æ‰¾description*/
            strA = strstr(buf, "</description>");//æŠ“åˆ°</description>ç‚ºæ­¢

            if(!strA)
               skip = true;
            else
               *strA = '\0';

            strB = &buf[0];
            while(*strB == ' ')
            {
               space++;
               strB++;
            }
            str_ncpy(enews.description, buf + space + 13, sizeof(enews.title))
;//buf+13: <description>ä¸è¦
            //printf("description: %s\n", enews.description);
            space=0;
            if(skip)
               fgets(buf, sizeof(buf), fp); /* skip </description> */
            skip = false;


            fgets(buf, sizeof(buf), fp); /* ä¸‹ä¸€å€‹å¿…æ˜¯<link> */
            strA = strstr(buf, "newsid");//hiä¸è¦(æ–¹ä¾¿parse)

            if(strA)//æœ‰newsid linkçš„æ‰parse url
            {
               strB = strstr(strA, "</link>");

               if(!strB)
                  fgets(buf, sizeof(buf), fp); /* ä¸‹ä¸€å€‹å¿…æ˜¯<link> */
               else
                  *strB = '\0';

               sprintf(enews.link, strA);//åªæŠ“ç¶²å€æœ‰newidçš„
               //printf("link: %s\n", enews.link);
         }

         if (!rec_add(folder, &enews, sizeof(ENEWS)) && !old_link(fold, enews.
link))
            html_download(&enews, kind, fold);

         //article_num++;
      }
}

fclose(fp);
}


/*-------------------------------------------------------*/
/* ä¸»ç¨‹å¼                                                */
/*-------------------------------------------------------*/


int main(void)
{
   int kind;
   char cmd[256];
   char *class[] =
   {
      "world", "china_news", "taiwan_hk", "uk", "business", "sci/tech"
   };

   chdir(BBSHOME);

   init_bshm();

   /* æŠ“è³‡æ–™ä¸¦åˆ†æä¹‹ */
   for (kind = 0 ; kind <= 5 ; kind++)
   {
      sprintf(cmd, LYNX_PATH " " RSS "%s/rss.xml > " INDEX_FILE, class[kind]);
      //printf("%s\n",cmd);
      system(cmd);
      xml_fetch(INDEX_FILE, kind);
   }

   unlink(INDEX_FILE);     /* æ¸…é™¤æš«å­˜æª” */
   return 0;
}

: src/lib/mk0rz.c æ–°å¢æ­¤ç¨‹å¼ï¼ŒMakefile è¦åŒæ­¥æ”¹

#include "bbs.h"

#define tmp_url "tmp/tmp_url"
#define thiny_url "<input type=hidden name=xxurl value="
#define tail_url  "\">"

char* mk0rz(char* post_url)
{
   FILE *fpr;
   char buf[512];
   char *strE;

   chdir(BBSHOME);

   sprintf(buf, "bin/shorten_url %s > %s ", post_url, tmp_url);
   system(buf);

   if(!(fpr = fopen(tmp_url, "r")))
   {
      //printf("CAN NOT OPEN %s !!!\n", tmp_url);
      return NULL;
   }

   fgets(buf, sizeof(buf), fpr);

   while(!strstr(buf, thiny_url))
      fgets(buf, sizeof(buf), fpr);

   str_ncpy(buf, buf+strlen(thiny_url)+1, sizeof(buf));
   *(strE = strstr(buf, tail_url)) = '\0';

   unlink(tmp_url);
   return buf;
}

: src/util/shorten_url.c æ–°å¢æ­¤ç¨‹å¼ï¼ŒMakefile è¦åŒæ­¥æ”¹

/*-------------------------------------------------------*/
/* shorten_url.c ( NTHU CS MapleBBS Ver 3.10 )           */
/*-------------------------------------------------------*/
/* target : åˆ©ç”¨libcurlå›å‚³0rz.netçŸ­url                  */
/* create : 06/08/28                                     */
/* update :   /  /                                       */
/* author : kevinblue.bbs@nightless.twbbs.org            */
/*-------------------------------------------------------*/

/*
   0rz.netæœ‰2å€‹æ¬„ä½éœ€è¦å¡«ä¸Šæ‰å¯ä»¥ä½¿ç”¨http post
   åˆ†åˆ¥ç‚º
   1. <input type="text" name="url" size="30" length=505>
   2. <input type="Submit" value="Make Shorter" style="border:1px solid gray;"
>

   <form action="http://0rz.net/create.php" method="post" target="_blank">
   Give me the long URL:<input type="text" name="url" size="30" length=505>
   <input type="Submit" value="Make Shorter" style="border:1px solid gray;">
   </td></tr>
   </textarea>
   </form>

   ç”¨æ³•ï¼š./shorten_url ä½ çš„ç¶²å€
   ç¯„ä¾‹ï¼š./shorten_url http://www.google.com.tw

 */

#include <stdio.h>
#include <string.h>

#include <curl/curl.h>
#include <curl/types.h>
#include <curl/easy.h>

#define POSTURL "http://0rz.net/create.php" //modify this if 0rz.net change it
s thiny-url create page

int main(int argc, char *argv[])
{
   CURL *curl;
   CURLcode res;

   struct curl_httppost *formpost=NULL;
   struct curl_httppost *lastptr=NULL;

   curl_global_init(CURL_GLOBAL_ALL);

   /*å¡«ä¸Šurl*/
   curl_formadd(&formpost,
         &lastptr,
         CURLFORM_COPYNAME, "url",
         CURLFORM_COPYCONTENTS, argv[1],
         CURLFORM_END);

   /*å¡«ä¸ŠSubmit*/
   curl_formadd(&formpost,
         &lastptr,
         CURLFORM_COPYNAME, "Submit",
         CURLFORM_COPYCONTENTS, "Make Shorter",
         CURLFORM_END);

   curl = curl_easy_init();

   if(curl)
   {
      /* what URL that receives this POST */
      curl_easy_setopt(curl, CURLOPT_URL, POSTURL);
      curl_easy_setopt(curl, CURLOPT_HTTPPOST, formpost);

      res = curl_easy_perform(curl);

      /* always cleanup */
      curl_easy_cleanup(curl);

      /* then cleanup the formpost chain */
      curl_formfree(formpost);
   }
   return 0;
}

--
   [m                                                      [1;47;34mâ—¤â—¤â—¤[40mâ—£             [;40;37m
   [1mæ¥µç«¯æ€•éº»ç…©çš„å‚¢ä¼™ç‚ºäº†è¼•é¬†è§£æ±ºå•é¡Œæ‰€æƒ³å‡ºä¾†çš„å‰µæ„èˆ‡å·§æ€  [;47;30mË™[40;37mâ–ˆ[47;30mË™[40;37mâ–ˆ
   [33mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  [37mâ–ˆâ–ˆâ–ˆâ–ˆ
                 [1må¸¶å‹•äº†äººé¡çš„ç™¼æ˜å’Œé€²æ­¥                  [;40;37mâ—¥â–ˆâ–ˆâ—¤
                                                          [1;34mï¼­â–ˆ  ÏˆKidult73 [;40;37m[m

--
[1;36;42m   Origin:æ±å³è³‡ç§‘åŸå€å¤œæœªçœ (nightless.twbbs.org)[;32;40mâ–Šâ–‹â– [33m[FROM:61.216.2.244][m
