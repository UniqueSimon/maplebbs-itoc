ä½œè€…: itoc (http://cpu.twbbs.org) çœ‹æ¿: itoc
æ¨™é¡Œ: Re: å•ä¸€äº›å°å•é¡Œ..
æ™‚é–“: Fri Jun 20 21:40:46 2003                          Updated: 2005/10/30

â€» å¼•è¿°ã€Šalexabc.bbs@aurora.twbbs.org (é™Œç”Ÿäºº)ã€‹ä¹‹éŠ˜è¨€ï¼š
> è«‹å•æœ‰è¾¦æ³•åƒWDä¸€æ¨£åšä¸€å€‹all_postæ¿å—Ž?

: post.c:do_allpost() æ–°å¢žåœ¨ do_post() å‰é¢

static void
do_allpost(fpath, owner, nick, mode)
  char *fpath;
  char *owner;
  char *nick;
  int mode;
{
  HDR hdr;
  char folder[64];
  char *brdname = "All_Post";       [1;44m// æ¿åè‡ªå®š [m

  brd_fpath(folder, brdname, fn_dir);
  hdr_stamp(folder, HDR_LINK | 'A', &hdr, fpath);

  hdr.xmode = mode & ~POST_OUTGO;  /* æ‹¿æŽ‰ POST_OUTGO */
  strcpy(hdr.owner, owner);
  strcpy(hdr.nick, nick);
  strcpy(hdr.title, ve_title);

  rec_bot(folder, &hdr, sizeof(HDR));

  btime_update(brd_bno(brdname));
}

: post.c:do_post()

static int
do_post(title)
  char *title;
{
  /* Thor.981105: é€²å…¥å‰éœ€è¨­å¥½ curredit */
  HDR hdr, buf;
  char fpath[64], *folder, *nick, *rcpt;
  int mode;
  time_t spendtime, prev, chrono;
+ BRD *brd;

  .....
  .....

  title = ve_title;
  mode = (curredit & EDIT_OUTGO) ? POST_OUTGO : 0;

#ifdef HAVE_REFUSEMARK
  if (curredit & EDIT_RESTRICT)
    mode |= POST_RESTRICT;
#endif

+ /* qazq.031025: å…¬é–‹æ¿æ‰åš all_post */
+ brd = bshm->bcache + currbno;
+ if ((brd->readlevel | brd->postlevel) < (PERM_VALID << 1))
+   do_allpost(fpath, rcpt, nick, mode);

--
[1;36m=[37m[[36mï¹Ž[37m:[33m?[37mæ‘ƒ?[mâ—£?[1;33m?[37m:[36mï¹Ž [31mOrigin[37m ]|[[m     [31m?[1må¨[0;31mO?[1mç—[0;31m?[1mprocessor.tfcis.org    [37m]|[?[33mæŸèªª[m?[1;36mï¹Ž[37m:][36m=[m
[1;36m=[m[[1;36mï¹Š[37m:[33m?[30mæ‘ƒ?[mâ•±?[1;33m?[37m:[36mï¹Š [31mAuthor[m ]|[ [1m     itoc.Dorm-GD2.NCTU.edu.tw      [m]|[?[1;33m?[30m?[37mæ’[30m?[36mï¹Š[37m:[m][1;36m=[m
