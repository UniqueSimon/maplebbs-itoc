ç™¼ä¿¡äºº: itoc.bbs@cpu.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [å•é¡Œ] å¦‚ä½•åšå®šæ™‚é‡ç½®äººæ°£
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2007/01/11 Thu 23:04:38)                Updated: 2007/01/11

â€» å¼•è¿°ã€Šguessi (æ²’)ã€‹ä¹‹éŠ˜è¨€ï¼š
> æƒ³æ³•: crontabæ¯ä¸€å°æ™‚ æŽƒboard list å†æŽƒulist æ›´æ–°mantime

: crontab -e åŠ å…¥é€™äºŒè¡Œæ–¼æœ€å¾Œ

# æ¯å°æ™‚ä½œä¸‰æ¬¡é‡ç½®çœ‹æ¿äººæ°£
6,26,46 * * * * bin/resetbh > /dev/null 2>&1

: src/util/Makefile

EXE =   ... [1;33mresetbh[m

: src/util/resetbh.c æ–°å¢žæ­¤ç¨‹å¼

/*-------------------------------------------------------*/
/* util/resetbh.c   ( NTHU MapleBBS Ver 3.10 )           */
/*-------------------------------------------------------*/
/* target : é‡ç½®çœ‹æ¿äººæ°£                                 */
/* create : 07/01/11                                     */
/* update :   /  /                                       */
/* author : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/


#include "bbs.h"

static BCACHE *bshm;

static void
init_bshm()
{
  bshm = shm_new(BRDSHM_KEY, sizeof(BCACHE));

  if (bshm->uptime <= 0)        /* bshm æœªè¨­å®šå®Œæˆ */
    exit(0);
}


static UCACHE *ushm;

static void
init_ushm()
{
  ushm = shm_new(UTMPSHM_KEY, sizeof(UCACHE));
}

int
main()
{
  int bno, bmate;
  char *bname;
  BRD *head, *tail;
  UTMP *uentp, *uceil, *up;

  chdir(BBSHOME);

  init_bshm();
  init_ushm();

  bno = -1;
  head = bshm->bcache;
  tail = head + bshm->number;

  uentp = ushm->uslot;
  uceil = (void *) uentp + ushm->offset;

  do
  {
    bno++;
    bname = head->brdname;

    if (!*bname)
      continue;

    bmate = 0;
    up = uentp;
    do
    {
      if ((up->mode == M_READA) && !strcmp(up->reading, bname))
        bmate++;
    } while (++up <= uceil);

    bshm->mantime[bno] = bmate;

  } while (++head < tail);

  return 0;
}


--
[1;36m=[37m[[36mï¹Ž[37m:[33m?[37mæ‘ƒ?[mâ—£?[1;33m?[37m:[36mï¹Ž [31mOrigin[37m ]|[[m  [0;31m?[1m?[1m?[0;31mO[0;31m?[1m?[1m?[0;31m?[1mcpu.tfcis.org  [37m]|[?[33mæŸèªª[m?[1;36mï¹Ž[37m:][36m=[m
[1;36m=[0m[[1;36mï¹Š[37m:[33m?[30mæ‘ƒ?[mâ•±?[1;33m?[37m:[36mï¹Š [31mAuthor[m ]|[[1m218-168-179-31.dynamic.hin[m]|[?[1;33m?[30m?[37mæ’[30m?[36mï¹Š[37m:[m][1;36m=[m
