ç™¼ä¿¡äºº: weiyu.bbs@weiyu.twbbs.org (Andy) çœ‹æ¿: itoc
æ¨™  é¡Œ: Re: è«‹å•ä¸€ä¸‹é—œæ–¼åœ‹åº«ç³»çµ±
ç™¼ä¿¡ç«™: ç‹è€…ä¹‹å®¶ (2005/03/31 Thu 08:00:00)                Updated: 2005/03/31

â€» å¼•è¿°ã€Šjal.bbs@bbs.jal.idv.tw (å°ç“œå‘†ï½)ã€‹ä¹‹éŠ˜è¨€ï¼š
> æŠŠä½¿ç”¨è€…çˆ†æ‰å¤šå‡ºä¾†çš„éŒ¢ï¼Œè·Ÿé»æ­Œ or ç©éŠæˆ²ä¹‹é¡æ‰€æ‰£çš„éŒ¢
> æƒ³å€‹è¾¦æ³•å­˜åˆ°ä¸€å€‹åœ°æ–¹å»ã€‚
> ç„¶å¾Œå°±æœƒæœ‰å€‹åœ‹åº«å‡ºç¾äº†...
> æœ€å¾Œç•¶åœ‹åº« = é›¶ çš„æ™‚å€™..ç©éŠæˆ²è´äº†ä¹Ÿæœƒæ²’éŒ¢çµ¦...:p

: acct.c:addmoney() å’Œ addgold() æ›æˆä»¥ä¸‹

/*
    ç¨‹å¼å‡è¨­ï¼š
        record 0 å­˜æ”¾éŠ€å¹£
        record 1 å­˜æ”¾é‡‘å¹£
    å…±ç”¨æª”æ¡ˆï¼šrun/treasury
    å‰›é–‹å§‹åœ‹åº«çš„éŒ¢è¨­ç‚º
    INITIAL_MONEY
    åœ‹åº«çš„é‡‘å¹£ä¸€é–‹å§‹æœ‰
    INITIAL_GOLD

    æŠŠaddmoneyå’Œaddgoldå…©å€‹æ›æˆä¸‹é¢é‚£æ¨£
    ä¸éå‰ææ˜¯ æ‰£éŒ¢ä¹Ÿè¦ç”¨åˆ°addmoneyæ‰æœ‰æ•ˆ:p
    ä¸åªæ˜¯æº¢ä½ å¦‚æœæ‰£éŒ¢ä¹Ÿç”¨é€™å€‹å‡½æ•¸çš„è©±
    ä¹Ÿæœƒå­˜åˆ°åœ‹åº«å§:p (æ²’è©¦é)
 */


#define FN_TREASURY     "run/treasury"
#define INITIAL_MONEY   1000000
#define INITIAL_GOLD    1000


void
addmoney(addend)
  int addend;
{
  int treasury;
  int overflow;

  if (rec_get(FN_TREASURY, &treasury, sizeof(int), 0))
    treasury = INITIAL_MONEY;

  if (addend < 0)
  {
    treasury -= addend;
    cuser.money += addend;
    rec_put(FN_TREASURY, &treasury, sizeof(int), 0, NULL);
  }
  else if (addend < (INT_MAX - cuser.money))      /* é¿å…æº¢ä½ */
  {
    if (treasury < addend)
    {
      vmsg("åœ‹åº«æ²’éŠ€å¹£äº†ï¼Œæ²’è¾¦æ³•æ”¯ä»˜æ‚¨");
      return;
    }
    cuser.money += addend;
  }
  else
  {
    /* å°‡æº¢å‡ºçš„éƒ¨åˆ†å­˜å…¥åœ‹åº« */
    overflow = INT_MAX - cuser.money;
    overflow = addend - overflow;
    treasury += overflow;
    rec_put(FN_TREASURY, &treasury, sizeof(int), 0, NULL);
    cuser.money = INT_MAX;
  }
}


void
addgold(addend)
  int addend;
{
  int treasury;
  int overflow;

  if (rec_get(FN_TREASURY, &treasury, sizeof(int), 1))
    treasury = INITIAL_GOLD;

  if (addend < 0)
  {
    treasury -= addend;
    cuser.money += addend;
    rec_put(FN_TREASURY, &treasury, sizeof(int), 1, NULL);
  }
  else if (addend < (INT_MAX - cuser.gold))       /* é¿å…æº¢ä½ */
  {
    if (treasury < addend)
    {
      vmsg("åœ‹åº«æ²’é‡‘å¹£äº†ï¼Œæ²’è¾¦æ³•æ”¯ä»˜æ‚¨");
      return;
    }
    cuser.gold += addend;
  }
  else
  {
    /* å°‡æº¢å‡ºçš„éƒ¨åˆ†å­˜å…¥åœ‹åº« */
    overflow = INT_MAX - cuser.gold;
    overflow = addend - overflow;
    treasury += overflow;
    rec_put(FN_TREASURY, &treasury, sizeof(int), 1, NULL);
    cuser.gold = INT_MAX;
  }
}

: bank.c:x_bank() åœ¨éŠ€è¡Œçš„åœ°æ–¹é¡¯ç¤ºåœ‹åº«é‚„æœ‰å¤šå°‘éŒ¢

int
x_bank()
{
  char ans[3];
+ int treasury;

  ...

    "  â•°â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¯\033[m");

+ outs("\nåœ‹åº«é‚„æœ‰");
+ if (rec_get("run/treasury_money", &treasury, sizeof(int), 0))
+   prints(" %d éŠ€", treasury);
+ if (rec_get("run/treasury_gold", &treasury, sizeof(int), 0))
+   prints(" %d é‡‘", treasury);

  vget(11, 0, "è«‹è¼¸å…¥æ‚¨éœ€è¦çš„æœå‹™ï¼š", ans, 3, DOECHO);


--
                        [1mç”Ÿâ–‚?[mR[1mâ–ƒæœ‰â–äº†â–ƒè‹¦â–†ç—›[m
                        [30;43mä½•ä¸æŠŠçœ¼ç›çš„é¤˜å…‰ç•™çµ¦åˆ¥äºº[m
                            [1;34mä½ æœƒçœ‹[32måˆ°æ›´å¤š[m

--
[1;34mâ•­â”€â”€â”€â”€â•® â•¬ [35mweiyu.twbbs.org [34mâ•¬ [30mâ˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†[m
[1;34mâ”‚[31mç‹[32mè€…[33mä¹‹[34må®¶â”‚ â•¬[36m weiyu  [33mâ˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†[m
[1;34mâ•°â”€â”€â”€â”€â•¯ â•¬ [37mç™¼è¡¨æ–¼ [36mweiyu.mshome.net  [30mâ˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†[m
