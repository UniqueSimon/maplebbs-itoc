ä½œè€…: itoc (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: itoc
æ¨™é¡Œ: Re: [å•é¡Œ]menuè¼‰å…¥çš„æ¬Šé™
æ™‚é–“: 2004/05/18 Tue 02:11:40                           Updated: 2005/04/05

â€» å¼•è¿°ã€Šchwaian (ç„¡è¨€)ã€‹ä¹‹éŠ˜è¨€ï¼š
> #ifdef HAVE_REGKEY_CHECK
>   u_verify, PERM_BASIC, M_UFILES,
>   "Verify     ã€Š å¡«èªè­‰ç¢¼ ã€‹",
> #endif
> åƒé€™ä¸€ç¨®çš„
> å¦‚æœè¦æ”¹æˆ !(PERM_POST) æ‰æœƒå‡ºç¾é¸å–®
> è®“ !(PERM_XXXX) å¯ä»¥ work
> menu()è¦æ€éº¼ä¿®æ­£æ¯”è¼ƒå¥½?

: menu.c

#define PERM_MENU       PERM_PURGE
+ #define PERM_INVERSE    PERM_DENYLOGIN

: menu.c:menu()

+       if (cc & PERM_INVERSE)
+       {
+         if (cc & level || !level)  /* æ²’æœ‰è©²æ¬Šé™æ‰ç§€å‡ºï¼Œguest ä¸ç§€å‡º */
+           continue;
+       }
+       else
+       {
          if (cc && !(cc & level))   /* æœ‰è©²æ¬Šé™æ‰ç§€å‡º */
            continue;
+       }

: menu.c:menu_user[]
: å·²æœ‰ PERM_XXXX æ¬Šé™å°±ä¸è¼‰å…¥çš„é¸é …ï¼Œå…¶æ¬Šé™æ”¹ç‚º PERM_INVERSE | PERM_XXXX

#ifdef HAVE_REGISTER_FORM
- u_register, PERM_BASIC, M_UFILES,
+ u_register, PERM_INVERSE | PERM_VALID, M_UFILES,
  "Register   ã€Š å¡«è¨»å†Šå–® ã€‹",
#endif

#ifdef HAVE_REGKEY_CHECK
- u_verify, PERM_BASIC, M_UFILES,
+ u_verify, PERM_INVERSE | PERM_VALID, M_UFILES,
  "Verify     ã€Š å¡«èªè­‰ç¢¼ ã€‹",
#endif

- u_deny, PERM_BASIC, M_XMODE,
+ u_deny, PERM_BASIC | PERM_VALID, M_XMODE,
  "Perm       ã€Š æ¢å¾©æ¬Šé™ ã€‹",

: user.c:u_register()  é€™å€‹å‡½å¼å°±ä¸éœ€è¦æª¢æŸ¥æ¬Šé™

-#ifdef JUSTIFY_PERIODICAL
- if (HAS_PERM(PERM_VALID) &&
-   cuser.tvalid + VALID_PERIOD - 10 * 86400 >= ap_start)
-#else
- if (HAS_PERM(PERM_VALID))
-#endif
- {
-   zmsg("æ‚¨çš„èº«åˆ†ç¢ºèªå·²ç¶“å®Œæˆï¼Œä¸éœ€å¡«å¯«ç”³è«‹è¡¨");
-   return XEASY;
- }

: user.c:u_verify()  é€™å€‹å‡½å¼å°±ä¸éœ€è¦æª¢æŸ¥æ¬Šé™

- if (HAS_PERM(PERM_VALID))
- {
-   zmsg("æ‚¨çš„èº«åˆ†ç¢ºèªå·²ç¶“å®Œæˆï¼Œä¸éœ€å¡«å¯«èªè­‰ç¢¼");
- }
- else
- {
    ...
- }

  return XEASY;

: user.c:u_deny()  é€™å€‹å‡½å¼å°±ä¸éœ€è¦æª¢æŸ¥æ¬Šé™

- if (!HAS_PERM(PERM_ALLDENY))
- {
-   zmsg("æ‚¨æ²’è¢«åœæ¬Šï¼Œä¸éœ€å¾©æ¬Š");
- }
- else
- {
    ...
- }

  return XEASY;

--
 [1;43mâ•­[46mâ”¼[m Or[1mig[30min[m: [41m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [32;47m processor.tfcis.org [m
 [1;45mâ•°[42mâ•®[m [1mMo[30mdi[mfy: [1;36m2004/05/18 Tue 02:17:15[m
