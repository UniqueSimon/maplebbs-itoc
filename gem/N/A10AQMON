ä½œè€…: itoc (cygreadline4.dll) ç«™å…§: plan
æ¨™é¡Œ: [åŠŸèƒ½] è¯è€ƒæ¦œå–®æŸ¥è©¢
æ™‚é–“: 2004/05/21 Fri 09:16:41                           Updated: 2005/08/09

: etc/jcee

  æŠ“ http://cpu.twbbs.org/~itoc/download/jcee/jcee.tgz è§£å£“ç¸®åœ¨ etc/ ä¸‹
  ä¹Ÿå°±æ˜¯è¦æœ‰ etc/jcee/##.txtï¼Œ## æ˜¯æ°‘åœ‹å¹´

: menu.c åœ¨é©ç•¶çš„é¸å–®åŠ ä¸Š

+ "bin/jcee.so:main_jcee", 0, - M_XMODE,
+ "JCEE       â™‚ è¯è€ƒæŸ¥æ¦œ â™€",

: game/Makefile

SO =    ... [1;33mjcee.so[m

: game/jcee.c æ–°å¢æ­¤ç¨‹å¼

/*-------------------------------------------------------*/
/* jcee.c       ( NTU FPG BBS Ver 2.00 )                 */
/*-------------------------------------------------------*/
/* target : è¯è€ƒæ¦œå–®æŸ¥è©¢                                 */
/* create : 98/08/08                                     */
/* update : 01/08/21                                     */
/* author : å³ç´¹è¡                                       */
/* modify : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/


#if 0

 è³‡æ–™ä¾†æº
 http://www.csie.nctu.edu.tw/service/jcee/æ­·å¹´

#endif


#include "bbs.h"


#define END_YEAR   94      /* æœ€å¾Œä¸€å¹´çš„æ¦œå–®æ˜¯æ°‘åœ‹ 94 å¹´ */


static int
ueequery_item(count, i, examnum, ptr, now)
  int count, i, examnum;
  char *now, *ptr;
{
  char buf[32];

  if (count > XO_TALL && (count % XO_TALL) == 1)
  {
    move(1, 0);
    clrtoeol();
    outs("\033[1;33mæœ¬é æŸ¥è©¢å·²æ»¿ï¼Œæ›é æŸ¥è©¢è«‹æŒ‰ä»»æ„éµï¼ŒçµæŸæŸ¥è©¢è«‹æŒ‰ Q\033[m");

    if (vkey() == 'q')
      return 0;

    i = 0;
    vs_bar("è¯è€ƒæ¦œå–®æŸ¥è©¢");
    move(2, 0);
    outs(COLOR2 " å‡†è€ƒè­‰   å§“  å    éŒ„ å– å¤§ å­¸         "
      "éŒ„ å– ç§‘ ç³»                           \033[m");
  }

  move(3 + i, 0);

  sprintf(buf, " %%-%d.%ds%%%ds   %%-8s  %%s", examnum, examnum, 9 - examnum);
  prints(buf, ptr, "", ptr + examnum, now);

#if 0
  if (examnum == 6)
    prints(" %-6.6s   %-8s  %s", ptr, ptr + examnum, now);
  else if (examnum == 7)
    prints(" %-7.7s  %-8s  %s", ptr, ptr + examnum, now);
  else if (examnum == 8)
    prints(" %-8.8s %-8s  %s", ptr, ptr + examnum, now);
#endif

  move(b_lines, 0);
  clrtoeol();
  prints(COLOR1 " æ¦œå–®æŸ¥è©¢ " COLOR2 " ç›®å‰å…±æŸ¥è©¢åˆ° %4d ç­†è³‡æ–™ã€‚"
    "æœ¬è³‡æ–™åƒ…ä¾›åƒè€ƒï¼ŒéŒ„å–çµæœä»¥è¯æ‹›æœƒå…¬å¸ƒç‚ºæº– \033[m", count);

  return i + 1;
}


static void
ueequery_foot(count)
  int count;
{
  if (count == 0)
  {
    move(4, 0);
    outs("æ²’æœ‰æŸ¥è©¢åˆ°ä»»ä½•è³‡æ–™");
  }
  move(b_lines, 0);
  clrtoeol();
  prints(COLOR1 " æ¦œå–®æŸ¥è©¢ " COLOR2 " ç›®å‰å…±æŸ¥è©¢åˆ° %4d ç­†è³‡æ–™ã€‚"
    "æŸ¥è©¢çµæŸï¼ŒæŒ‰ä»»æ„éµé›¢é–‹                   \033[m", count);
  vkey();
}


static int
x_ueequery()
{
  char buf[256], query[20], now[80], *ptr;
  int i, count, year, examnum;
  FILE *fp;

  vs_bar("è¯è€ƒæ¦œå–®æŸ¥è©¢");

  outs("\næ³¨æ„äº‹é …\n"
    "1. å®Œæ•´å‡†è€ƒè­‰è™Ÿç¢¼åŠéƒ¨ä»½å§“åå…©é …è‡³å°‘éœ€å¡«å¯«ä¸€é …æ‰èƒ½å¤ æŸ¥è©¢\n"
    "2. è‹¥å§“ååªæœ‰å…©å­—ï¼Œè«‹æ–¼å…©å­—ä¸­é–“åŠ å…¨å½¢ç©ºç™½\n"
    "3. 83-86 å¹´éœ€è¦å…­ä½å‡†è€ƒè­‰è™Ÿç¢¼ï¼Œ87-90 å¹´éœ€è¦ä¸ƒä½å‡†è€ƒè­‰è™Ÿç¢¼\n"
    "4. 91å¹´èµ·éœ€è¦å…«ä½å‡†è€ƒè­‰è™Ÿç¢¼\n");

  sprintf(buf, "è«‹è¼¸å…¥è¯è€ƒå¹´åº¦(83 ~ %d)ï¼Ÿ[%d] ", END_YEAR, END_YEAR);

  if (!vget(9, 0, buf, query, 3, DOECHO))
  {
    year = END_YEAR;
  }
  else
  {
    year = atoi(query);
    if (year < 83 || year > END_YEAR)
      return 0;
  }

  if (year <= 86)
    examnum = 6;
  else if (year <= 90)
    examnum = 7;
  else
    examnum = 8;

  if (vget(11, 0, "è«‹è¼¸å…¥å®Œæ•´å‡†è€ƒè­‰è™Ÿç¢¼ï¼š", query, examnum + 1, DOECHO))
  {
    if (strlen(query) != examnum)
    {
      vmsg("ä¸æ­£ç¢ºçš„å®Œæ•´å‡†è€ƒè­‰è™Ÿç¢¼");
      return 0;
    }
  }
  else if (!vget(13, 0, "è«‹è¼¸å…¥éƒ¨ä»½å§“åï¼š", query, 10, DOECHO))
  {
    vmsg("è«‹æ–¼å‡†è€ƒè­‰è™Ÿç¢¼æ–¼å§“åäºŒæ¬„ä¸­æ“‡ä¸€å¡«å¯«");
    return 0;
  }

  sprintf(buf, "etc/jcee/%d.txt", year);

  if (fp = fopen(buf, "r"))
  {
    int j;
    char *pquery;

    count = 0;  /* ç®—å…¨éƒ¨æœ‰å¹¾å€‹ */
    i = 0;      /* ç®—æœ¬é çš„ç¬¬å¹¾å€‹ */

    vs_bar("è¯è€ƒæ¦œå–®æŸ¥è©¢");
    prints("æŸ¥è©¢ã€Š%sã€‹ä¸­....\n", query);
    outs(COLOR2 " å‡†è€ƒè­‰   å§“  å    éŒ„ å– å¤§ å­¸         "
      "éŒ„ å– ç§‘ ç³»                           \033[m");

    while (fgets(buf, 256, fp))
    {
      if (buf[0] == ' ')        /* é€™æ¨£å°±æ˜¯ç§‘ç³»çš„é–‹é ­ */
      {
        ptr = strtok(buf + 5, " ");
        strcpy(now, ptr);
        ptr = strtok(NULL, " ");
        sprintf(now, "%-24s%-30s", now, ptr);
        continue;
      }

      ptr = strtok(buf, "    ");

      do
      {
        if (pquery = strstr(ptr, query))
          j = (pquery - ptr) + examnum + 1;
        else
          j = 2;               /* è¡¨ç¤ºæœªæ‰¾åˆ° */

        if (j == (pquery - ptr) + examnum + 1 || j % 2)/* è™•ç†ä¸­æ–‡å­—çš„å•é¡Œ */
        {
          count++;
          if (!(i = ueequery_item(count, i, examnum, ptr, now)))
          {
            fclose(fp);
            ueequery_foot(count);
            return 0;
          }
        }
      } while (ptr = strtok(NULL, "    "));
    }
    fclose(fp);
  }

  ueequery_foot(count);
  return 0;
}


static int
x_ueequery2()
{
  char buf[256], query[30], query2[30], now[80], *ptr;
  int i, count, year, examnum;
  int school, dept;
  FILE *fp;

  vs_bar("è¯è€ƒæ¦œå–®æŸ¥è©¢");

  outs("\næ³¨æ„äº‹é …\n"
    "1. å¤§å­¸åŠç§‘ç³»å…©é …è‡³å°‘éœ€å¡«å¯«ä¸€é …æ‰èƒ½å¤ æŸ¥è©¢\n"
    "2. è¼¸å…¥éƒ¨åˆ†å­—ä¸²å³å¯\n");

  sprintf(buf, "è«‹è¼¸å…¥è¯è€ƒå¹´åº¦(83 ~ %d)ï¼Ÿ[%d] ", END_YEAR, END_YEAR);

  if (!vget(9, 0, buf, query, 3, DOECHO))
  {
    year = END_YEAR;
  }
  else
  {
    year = atoi(query);
    if (year < 83 || year > END_YEAR)
      return 0;
  }

  if (year <= 86)
    examnum = 6;
  else if (year <= 90)
    examnum = 7;
  else
    examnum = 8;

  vget(11, 0, "è«‹è¼¸å…¥æŸ¥è©¢å¤§å­¸ï¼š", query, 20, DOECHO);
  vget(13, 0, "è«‹è¼¸å…¥æŸ¥è©¢ç§‘ç³»ï¼š", query2, 20, DOECHO);

  if (!*query && !*query2)
    return 0;

  sprintf(buf, "etc/jcee/%d.txt", year);

  if (fp = fopen(buf, "r"))
  {
    count = 0;  /* ç®—å…¨éƒ¨æœ‰å¹¾å€‹ */
    i = 0;      /* ç®—æœ¬é çš„ç¬¬å¹¾å€‹ */

    vs_bar("è¯è€ƒæ¦œå–®æŸ¥è©¢");
    prints("æŸ¥è©¢ã€Š%s%sã€‹ä¸­....\n", query, query2);
    outs(COLOR2 " å‡†è€ƒè­‰   å§“  å    éŒ„ å– å¤§ å­¸         "
      "éŒ„ å– ç§‘ ç³»                           \033[m");

    while (fgets(buf, 256, fp))
    {
      if (buf[0] == ' ')         /* é€™æ¨£å°±æ˜¯ç§‘ç³»çš„é–‹é ­ */
      {
        ptr = strtok(buf + 5, " ");
        strcpy(now, ptr);

        if (!*query || strstr(now, query))      /* æ‰¾åˆ°å­¸æ ¡ */
          school = 1;
        else
          school = 0;

        ptr = strtok(NULL, " ");
        if (!*query2 || strstr(ptr, query2))    /* æ‰¾åˆ°ç§‘ç³» */
          dept = 1;
        else
          dept = 0;

        sprintf(now, "%-24s%-30s", now, ptr);
        continue;
      }

      ptr = strtok(buf, "    ");

      do
      {
        if (school && dept && strlen(ptr) >= 6)/* è™•ç†ä¸­æ–‡å­—çš„å•é¡Œ */
        {
          count++;
          if (!(i = ueequery_item(count, i, examnum, ptr, now)))
          {
            fclose(fp);
            ueequery_foot(count);
            return 0;
          }
        }
      } while (ptr = strtok(NULL, "    "));
    }

    fclose(fp);
  }

  ueequery_foot(count);
  return 0;
}


int
main_jcee()
{
  int ch;

  ch = vans("è¯è€ƒæ¦œå–®æŸ¥è©¢ï¼Œè«‹é¸æ“‡ 1)é‡‘æ¦œæŸ¥è©¢ 2)ç§‘ç³»éŒ„å–åå–® [Q]é›¢é–‹ ");
  if (ch == '1')
    x_ueequery();
  else if (ch == '2')
    x_ueequery2();
  else
    return XEASY;

  return 0;
}

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ [32mitoc.Dorm11.NCTU.edu.tw[37m ç™¼è¡¨[m
