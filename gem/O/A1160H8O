ç™¼ä¿¡äºº: itoc.bbs@xeon.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [å•é¡Œ] é™åˆ¶å€‹äººä¿¡ç®±å®¹é‡
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (Tue, 04 Nov 2003 09:16:36 +0800 (CST))  Updated: 2005/05/17

â€» å¼•è¿°ã€Šcpd.bbs@pitch.twbbs.org (Seasons)ã€‹ä¹‹éŠ˜è¨€ï¼š
> å°±æ˜¯æˆ‘æƒ³è¦é™åˆ¶æ¯å€‹ä½¿ç”¨è€…çš„ä¿¡ç®±ä½¿ç”¨å®¹é‡(åŸæœ¬åªæœ‰é™åˆ¶ç¯‡æ•¸)...
> è¦æ˜¯ä¿¡ç®±ä½¿ç”¨è¶…éä¸Šé™ï¼Œå°±é™åˆ¶åªèƒ½åˆ°éƒµä»¶é¸å–®ï¼Œé™¤éåˆªé™¤ä¸€äº›ä¿¡æ‰èƒ½é›¢é–‹éƒµä»¶é¸å–®..

: config.h

#define MAX_BBSMAIL     500             /* PERM_MBOX æ”¶ä¿¡ä¸Šé™(å°) */
#define MAX_VALIDMAIL   300             /* èªè­‰ user æ”¶ä¿¡ä¸Šé™(å°) */
#define MAX_NOVALIDMAIL 100             /* æœªèªè­‰ user æ”¶ä¿¡ä¸Šé™(å°) */

+ #define MAX_BBSMAILSIZE     1024000       /* PERM_MBOX å®¹é‡ä¸Šé™(byte) */
+ #define MAX_VALIDMAILSIZE   512000        /* èªè­‰ user å®¹é‡ä¸Šé™(byte) */
+ #define MAX_NOVALIDMAILSIZE 204800        /* æœªèªè­‰ user å®¹é‡ä¸Šé™(byte) */

: bbsd.c:m_overflow() åŠ åœ¨ tn_motd() å‰é¢

static int          /* 1:éå¤§ */
m_overflow()
{
  int total_size, limit;
  char fpath[64], *ptr, *str;
  struct stat st;
  struct dirent *de;
  DIR *dirp;

  usr_fpath(fpath, cuser.userid, fn_dir);

  if (stat(fpath, &st))
    return 0;

  /* ä¸Šé™å¹¾ç¯‡ */
  if (HAS_PERM(PERM_MBOX))
    limit = MAX_BBSMAIL;
  else if (HAS_PERM(PERM_VALID))
    limit = MAX_VALIDMAIL;
  else
    limit = MAX_NOVALIDMAIL;
  if (st.st_size > sizeof(HDR) * limit)
    return 1;

  ptr = (char *) strchr(fpath, '.');
  *ptr++ = '@';
  *ptr = '\0';

  if (dirp = opendir(fpath))
  {
    /* å®¹é‡å¹¾ byte */
    if (HAS_PERM(PERM_MBOX))
      limit = MAX_BBSMAILSIZE;
    else if (HAS_PERM(PERM_VALID))
      limit = MAX_VALIDMAILSIZE;
    else
      limit = MAX_NOVALIDMAILSIZE;

    *ptr++ = '/';
    total_size = 0;
    while (de = readdir(dirp))
    {
      str = de->d_name;
      if (*str <= ' ' || *str == '.')
        continue;
      strcpy(ptr, str);
      if (!stat(fpath, &st))
      {
        total_size += st.st_size;
        if (total_size > limit)
        {
          closedir(dirp);
          return 1;
        }
      }
    }
    closedir(dirp);
  }

  return 0;
}

: bbsd:tn_motd()

static void
tn_motd()
{
  ...
  ...

+ while (m_overflow())
+ {
+   vmsg("æ‚¨çš„ä¿¡ä»¶éå¤šï¼Œè«‹æ‰“åŒ…å›å®¶æˆ–åˆªé™¤éƒ¨åˆ†ä¿¡ä»¶");
+   m_zip();
+   xover(XZ_MBOX);
+ }
}

--
  é€™åŠŸèƒ½å¾ˆåƒ I/O

--
 [1;43mâ”Œ[44mâ”¼[m Or[1mig[30min[m: [44m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [31;47m processor.tfcis.org [m
 [1;41mâ””[42mâ”˜[m A[1mut[30mho[mr: [1;36mitoc [30må¾ [35mitoc.dorm11.nctu.edu.tw [30mç™¼è¡¨[m
