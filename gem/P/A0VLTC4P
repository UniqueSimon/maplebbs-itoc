ç™¼ä¿¡äºº: verit.bbs@bbs.yzu.edu.tw (BBS ç«™é•·å¤§æœƒ), çœ‹æ¿: installbbs
æ¨™  é¡Œ: [WindTop]å¿ƒç†æ¸¬é©—ç¨‹å¼
ç™¼ä¿¡ç«™: å…ƒæ™ºå¤§å­¸é¢¨ä¹‹å¡” (Tue Sep  9 20:00:52 2003)         Updated: 2003/09/10

: menu.c é©ç•¶çš„é¸å–®åŠ å…¥

  "bin/mind.so:main_mind", 0, - M_XMODE,
  "Mind       â™‚ å¿ƒç†æ¸¬é©— â™€",

: run/mind

  å»ºç«‹æ­¤ç›®éŒ„

: run/mind/help æ–°å¢æ­¤æª”æ¡ˆ

å¿ƒç†æ¸¬é©—æŠ•ç¨¿æ ¼å¼æœ‰ä¸‰ç¨® :

1. ä¸€èˆ¬é¡Œç›® , æ¥ä¸‹ä¸€é¡Œ

    [Q]é¡Œç›®
    [A-1]èªªæ˜1
    [A-7]èªªæ˜2

    ä¸Šé¢ç¬¬äºŒè¡Œä»£è¡¨ , ç¬¬ä¸€å€‹ç­”æ¡ˆæ¥ç¬¬äºŒé¡Œ
    ä¸Šé¢ç¬¬ä¸‰è¡Œä»£è¡¨ , ç¬¬äºŒå€‹æª”æ¡ˆæ¥ç¬¬å…«é¡Œ

2. é¡Œç›®æ¥çµæœ

    [Q]é¡Œç›®
    [A-R-1]èªªæ˜ä¸€
    [A-0]èªªæ˜äºŒ

    ä¸Šé¢ç¬¬äºŒè¡Œä»£è¡¨ , ç¬¬ä¸€å€‹ç­”æ¡ˆæ¥ç¬¬ä¸€å€‹çµæœ
    ä¸Šé¢ç¬¬äºŒè¡Œä»£è¡¨ , ç¬¬äºŒå€‹ç­”æ¡ˆæ¥ç¬¬ä¸€é¡Œ

    ps) æ¥é¡Œç›®çš„è©± , é¡Œè™Ÿè¨˜å¾—æ¸›ä¸€
        æ¥çµæœçš„è©± , ç·¨è™Ÿä¸ç”¨æ¸›ä¸€

3. çµæœ

    [R]çµæœæ¨™é¡Œ
    çµæœå…§å®¹

    ps) çµæœå…§å®¹åªèƒ½ä¸€è¡Œ :p


å¯ä»¥åƒè€ƒä¸‹é¢çš„ç¯„ä¾‹ :)
===
[Q]ç›´æ¥äº†ç•¶çš„èªª,å¦³æ˜¯?
[A-1]æ¥µé‡è¦–å¤–è¡¨
[A-2]è¼ƒé‡è¦–å…§åœ¨

[Q]å°æ–¼å–œæ­¡çš„äººæ…‹åº¦å¾ˆç©æ¥µ
[A-3]YES
[A-5]NO

[Q]å¸¸å¸¸å¤¢è¦‹å–œæ­¡çš„äºº
[A-6]YES
[A-4]NO

[Q]åœ¨è¡—ä¸Šå·§é‡è‡ªå·±æš—æˆ€çš„äºº,å¦³æœƒ
[A-5]é‚€è«‹ä»–ä¸€å¡Šå»å–èŒ¶
[A-14]åªæ‰“æ‹›å‘¼

[Q]ä¸Šèª²(ä¸Šç­)æ™‚,å¸¸ç›¯è‘—å–œæ­¡çš„äººçœ‹ã€‚
[A-7]YES
[A-1]NO

[Q]å°æ–¼å–œæ­¡çš„äºº:
[A-8]å…ˆå¾æœ‹å‹åšèµ·
[A=16]æ¯«ä¸çŒ¶åœ°å‘ä»–å‘Šç™½,æ±ºå¿ƒä¸€å®šè¦å’Œä»–æˆç‚ºæˆ€äººã€‚

[Q]æˆ€äººæ¯”æœ‹å‹é‚„é‡è¦ã€‚
[A-10]YES
[A-4]NO

[Q]ä¸æ‡‚å¾—é©æ™‚åœ°è¡¨ç™½,å³ä½¿æ˜¯ç„¡èŠçš„ç©ç¬‘,ä¹Ÿæœƒä½¿å¦³è‡‰ç´…ã€‚
[A-11]YES
[A-5]NO

[Q]æ›¾ç¶“å»éå–œæ­¡çš„äººå®¶è£¡ã€‚
[A-12]YES
[A-9]NO

[Q]æš—æˆ€ä¹‹äººæ›¾ä¸»å‹•èˆ‡ä½ èªªè©±ã€‚
[A-18]YES
[A-16]NO

[Q]æœ‰å¾ˆå¤šç•°æ€§æœ‹å‹ã€‚
[A-7]YES
[A-11]NO

[Q]æš—æˆ€çš„äººå¦‚æœæ¬äº†å®¶:
[A-8]é¦¬ä¸Šå°‹æ‰¾åˆ¥çš„æˆ€æ„›å°è±¡
[A-12]å³ä½¿åˆ†éš”å…©åœ°é‚„æ˜¯ä¸€å¿ƒä¸€æ„å–œæ­¡ä»–

[Q]è¨å­æ•´å¤©åœ¨ä¸€èµ·çš„æˆ€æ„›,é‡è¦–æ“æœ‰å€‹äººçš„æ™‚é–“åŠç©ºé–“ã€‚
[A-20]YES
[A-9]NO

[Q]å–œæ­¡ç…§é¡§è‡ªå·±æš—æˆ€çš„äººã€‚
[A-R-3]YES
[A-R-1]NO

[Q]æƒ…äººç¯€æ™‚ä¸æ•¢è¦ªæ‰‹é€çµ¦ä»–å·§å…‹åŠ›ã€‚
[A-13]YES
[A-16]NO

[Q]ç•¶é¢å‘ä»–å‘Šç™½,æœƒæ„Ÿåˆ°ååˆ†é›£ç‚ºæƒ…ã€‚
[A-R-1]YES
[A-R-2]NO

[Q]ä¸å–œæ­¡è¬›é•·æ™‚é–“çš„é›»è©±ã€‚
[A-13]YES
[A-14]NO

[Q]è‹¥å—åˆ°å£“åŠ›,ä¾¿æœƒå‚¾å‡ºå…¨åŠ›åæŠ—ã€‚
[A-R-4]YES
[A-R-3]NO

[Q]æœ‰é(æš—æˆ€)åŠè¢«å‘Šç™½çš„ç¶“é©—ã€‚
[A-13]YES
[A-20]NO

[Q]ä½ è¦ºå¾—é‚£ä¸€ç¨®è¼ƒå¥½:
[A-R-2]è¢«å‘Šç™½
[A-R-4]å‘äººå‘Šç™½

[Q]å°±ç®—æœ‰äººå‘å¦³å‘Šç™½,å¦‚æœä¸æ˜¯è‡ªå·±å–œæ­¡çš„é¡å‹,ä¾¿ä¸æœƒèˆ‡ä»–äº¤å¾€ã€‚
[A-17]YES
[A-19]NO

[R][éƒ­é–]é¡å‹çš„äºº
å°æ–¼å–œæ­¡ç…§é¡§åˆ¥äººçš„å¥½å¤§å“¥å½¢è±¡,æŠŠé›¢å®¶è€Œè‡ªå·±é—–æ±Ÿæ¹–çš„é»ƒè“‰ç•¶åš [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
(å¯ä¿¡è³´çš„äºº)ä¸¦å’Œå¥¹å½¼æ­¤ä¾è³´ç›¸äº’ç…§é¡§,æ˜¯å€‹æº«å’Œé«”è²¼çš„å°è±¡ã€‚å¾ˆ [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
å®¹æ˜“èˆ‡äººæ¥è¿‘é€™ç¨®è¦ªåŠ›æ­£æ˜¯å¦³(ä½ )çš„é­…åŠ›æ‰€åœ¨ã€‚

[R][éƒ­èŠ™]é¡å‹çš„äºº
åœ¨å–œæ­¡çš„äººé¢å‰ç¸½æ˜¯ç„¡æ³•è¡¨é”å‡ºè‡ªå·±çš„æœ¬æ„,äº‹å¾Œæ‰è‡ªæˆ‘æŠ±æ€¨ä¸å·²,[1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
ä¸éå¾ˆæ‡‚å¾—æ’’å¬Œã€è€è³´ã€ä¹Ÿå¾ˆæ‡‚å¾—ä¸»å‹•è¨äººå–œæ­¡ã€èˆ‡äººèŠå¤©,å› æ­¤ [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
ç•°æ€§æœ‹å‹ä¸å°‘,åªè¦èƒ½å¾å¤±æ•—ä¸­ç´¯ç©ç¶“é©—,æ¥µæœ‰å¯èƒ½æˆç‚ºå¤§å—æ­¡è¿çš„[1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
äººã€‚

[R][å°é¾å¥³]é¡å‹çš„äºº
å…§ç†±å¤–å†·,æ¸…ç´”å–„è‰¯å‹çš„äºº:å…¶å¯¦æ˜¯å±¬æ–¼è¼ƒè‡ªé–‰ã€å…§å‘çš„æ€§æ ¼,ä½†å° [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
æ–¼è‡ªå·±å–œæ­¡çš„äº‹ã€ç‰©æœƒå…¨å¿ƒå»é—œæ³¨,é›–ä¸ç”¨è¨€èªç›´æ¥èªªæ˜,ä½†æœƒä»¥  [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
è¡Œå‹•ä¸ç¶“æ„åœ°æµéœ²æ„›æ„,åœ¨å…§å¿ƒçš„æ¾æ¹ƒç†±æƒ…ä¹‹ä¸­é‚„æ˜¯å¸¶é»æ²‰ç©©,å’Œ  [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
é€™é¡å‹çš„åœ¨ä¸€èµ·æ‡‰è©²æœƒæ„Ÿåˆ°å®‰å¿ƒè‡ªåœ¨ã€‚

[R][æ¥Šé]é¡å‹çš„äºº
å› ç‚ºå€‹æ€§åŸ·è‘—,å°è‡ªå·±å¿ƒå„€çš„äººæœƒåŠªåŠ›çš„å®ˆå€™åœ¨å¥¹(ä»–)èº«æ—,æœ‰æ™‚  [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
å¯èƒ½æœƒä¸æ•¢æ˜æ˜ç™½ç™½ä½œå‡ºæ„›çš„å‘Šç™½,ä½†å°ˆæƒ…çš„å¥¹(ä»–),è‹¥é‡åˆ°æˆ€äºº  [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
çš„èƒŒå›,ä»–å¿…æœƒä½¿ç›¡å…¨åŠ›å»æŒ½å›,æ˜¯å—å£“åŠ›æ„ˆå¤§åå½ˆæ„ˆå¤§,æ°¸é ä¸æœ [1;36m(ç„¡æ–·è¡ŒæŒ‰ä¸‹è¡Œ)[m
è¼¸çš„äººã€‚

: src/so/Makeifle

SO =    .... [1;33mmind.so[m

: src/so/mind.c æ–°å¢æ­¤ç¨‹å¼

/*-------------------------------------------------------*/
/* mind.c        ( YZU_CSE WindTop BBS )                 */
/*-------------------------------------------------------*/
/* author : verit.bbs@bbs.yzu.edu.tw                     */
/* target : å¿ƒç†æ¸¬é©—                                     */
/* create : 03/08/05                                     */
/* update :   /  /                                       */
/*-------------------------------------------------------*/


#include "bbs.h"


#define MAX_DESC_LENGTH      256        /* æ•˜è¿°çš„é•·åº¦ */
#define MAX_TEXT_LENGTH      512        /* å…§æ–‡çš„é•·åº¦ */

#define MAX_MIND_QUESTION    50         /* æœ€å¤šé¡Œç›®å€‹æ•¸ */
#define MAX_MIND_ANSWER      5          /* æ¯é¡Œæœ€å¤šç­”æ¡ˆæ•¸ */
#define MAX_MIND_RESULT      10         /* æœ€å¤šçµæœæ•¸ */

#define LEN                  50         /* ä¸€è¡Œæœ€å¤šé¡¯ç¤ºå¹¾å€‹å­— */
#define MIND_XPOS            5          /* é è¨­è¼¸å‡º x åº§æ¨™ */
#define MIND_YPOS            10         /* é è¨­è¼¸å‡º y åº§æ¨™ */

#define DEF_PATH        "run/mind/"

static int x, y;

typedef struct
{
  char question[MAX_DESC_LENGTH];
  char ans_desc[MAX_MIND_ANSWER][MAX_DESC_LENGTH];
  int ans_next[MAX_MIND_ANSWER];
  int ans;
}      QUESTION;

typedef struct
{
  char title[MAX_DESC_LENGTH];
  char desc[MAX_TEXT_LENGTH];
}      RESULT;

typedef struct
{
  QUESTION question[MAX_MIND_QUESTION];
  RESULT result[MAX_MIND_RESULT];
  int qcount;
  int rcount;
}      MIND;


static int
read_file(fpath, m)
  char *fpath;
  MIND *m;
{
  FILE *fp;
  int num;
  int ans;
  int result;
  char buf[MAX_TEXT_LENGTH];
  char *tmp, *tmp2;
  if (!(fp = fopen(fpath, "r")))
    return -1;

  num = -1;
  result = 0;
  while (fgets(buf, sizeof(buf), fp))
  {
    if (buf[1] == 'Q')
    {
      if (num >= 0)
        m->question[num].ans = ans;
      if (++num >= MAX_MIND_QUESTION)
      {
        fclose(fp);
        return -2;
      }
      strcpy(m->question[num].question, buf + 3);
      if (tmp2 = strchr(m->question[num].question, '\n'))
        *tmp2 = 0;
      ans = 0;
    }
    else if (buf[1] == 'A')
    {
      tmp = strchr(buf, ']');
      *tmp = 0;

      if (buf[3] == 'R')
        m->question[num].ans_next[ans] = atoi(buf + 4);
      else
        m->question[num].ans_next[ans] = atoi(buf + 3);

      strcpy(m->question[num].ans_desc[ans], tmp + 1);
      if (tmp2 = strchr(m->question[num].ans_desc[ans], '\n'))
        *tmp2 = 0;
      ++ans;
    }
    else if (buf[1] == 'R')
    {
      m->question[num].ans = ans;

      strcpy(m->result[result].title, buf + 3);
      if (tmp2 = strchr(m->result[result].title, '\n'))
        *tmp2 = 0;

      if (fgets(buf, sizeof(buf), fp))
        strcpy(m->result[result].desc, buf);
      else
        memset(m->result[result].desc, 0, MAX_TEXT_LENGTH);

      if (tmp2 = strchr(m->result[result].desc, '\n'))
        *tmp2 = 0;
      if (++result >= MAX_MIND_RESULT)
        break;
    }
  }

  m->qcount = num + 1;
  m->rcount = result;

  fclose(fp);

  return 1;
}


static int
print_quiz(src)
  char *src;
{
  int wstate = 0;
  int word = 0;
  char *str = src;
  char buf[128], *tmp;
  char form[128];
  int pos = LEN + 1;
  int height = 0;

  sprintf(form, "%%-%ds", pos + 1);

  while (*str)
  {
    height++;
    tmp = str;
    move(x++, y);
    outs(" \033[0;37mâ–\033[1;37m");

    wstate = 0;
    word = 0;
    for (; word < pos && *str; str++)
    {
      wstate = (*str < 0) ? ((wstate == 1) ? 0 : 1) : 0;
      word++;
    }

    if (!(*str < 0 && wstate == 0))
      str++;

    memset(buf, 0, sizeof(buf));
    strncpy(buf, tmp, str - tmp);
    prints(form, buf);
    if (strlen(buf) == pos)
      outs("\033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m ");
    else
      outs("\033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m ");
  }

  return height;
}


static int
draw_item(src, pos, mode)
  char *src;
  int pos;
  int mode;
{
  char buf[128];

  sprintf(buf, "%%d;37m %s %%-%ds", (mode) ? "â—†" : "  ", LEN - 2);
  move(MIND_XPOS + pos + 2, MIND_YPOS);

  outs(" \033[0;37mâ–\033[1;");
  prints(buf, (mode) ? 41 : 40, src);
  outs("\033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m ");
}


static int
draw_menu(question, no)
  QUESTION *question;
  int no;
{
  int i, cur;
  int c;
  int h;

  x = MIND_XPOS;
  y = MIND_YPOS;

  move(x++, y);
  outs(" \033[0;40;37m????????????????????????????\033[m");
  move(x++, y);
  prints(" \033[0;37;44mâ–\033[1mç¬¬ %02d é¡Œ%-43s \033[0;47;34mâ–‰\033[m", no + 1, " ");
  move(x++, y);
  prints(" \033[0;37mâ–\033[1m%-51s \033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m", " ");
  cur = 0;
  h = print_quiz(question[no].question) + 2;

  move(x++, y);
  prints(" \033[0;37mâ–\033[1m%-51s \033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m", " ");

  for (i = 0; i < question[no].ans; ++i, ++x)
    draw_item(question[no].ans_desc[i], i + h, (i == cur) ? 1 : 0);

  move(x++, y);
  prints(" \033[0;37mâ–\033[1m%-51s \033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m", " ");
  move(x++, y);
  outs(" \033[0;47;30mâ–‡\033[30;1mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡\033[40;30;1mâ–‰\033[m");

  outz("\033[1;37;42m ã€æ“ä½œèªªæ˜ã€‘q)é›¢é–‹ Enter)ä½œç­”                                                \033[m");

  while (c = vkey())
  {
    draw_item(question[no].ans_desc[cur], cur + h, 0);
    switch (c)
    {
    case KEY_UP:
      cur = (cur == 0) ? question[no].ans - 1 : cur - 1;
      break;
    case KEY_DOWN:
      cur = (cur + 1) % question[no].ans;
      break;
    case '\n':
    case ' ':
      return cur;
    case 'q':
      vmsg(NULL);
      return -892226;
    }
    draw_item(question[no].ans_desc[cur], cur + h, 1);
  }

  return 0;
}


static void
do_test(fpath, title)
  char *fpath;
  char *title;
{
  int no, ans;
  MIND m;

  if (read_file(fpath, &m) <= 0)
    return;

  no = 0;
  while (1)
  {
    vs_bar("å¿ƒç†æ¸¬é©—");
    move(3, MIND_YPOS);
    prints("ç›®å‰æ¸¬é©—çš„é¡Œç›®æ˜¯ : %s", title);
    ans = draw_menu(m.question, no);
    if (ans == -892226)
      return;
    no = m.question[no].ans_next[ans];
    if (no < 0)
    {
      x = MIND_XPOS;
      y = MIND_YPOS;
      no = -no;
      --no;

      vs_bar("å¿ƒç†æ¸¬é©—");
      move(x++, y);
      prints(" \033[0;40;37m????????????????????????????\033[m   ");
      move(x++, y);
      prints(" \033[0;37;42mâ–\033[1mçµæœï¼š%-45s \033[0;47;32mâ–‰\033[m   ", m.result[no].title);
      move(x++, y);
      prints(" \033[0;37mâ–\033[1m%-51s \033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m ", " ");

      print_quiz(m.result[no].desc);

      move(x++, y);
      prints(" \033[0;37mâ–\033[1m%-51s \033[0;47;30mâ–‰\033[40;30;1mâ–‰\033[m ", " ");
      move(x++, y);
      prints(" \033[0;47;30mâ–‡\033[30;1mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡\033[40;30;1mâ–‰\033[m ");
      vmsg(NULL);
      break;
    }
  }
}


/*-------------------------------------------------------*/
/* xover é¸å–®                                            */
/*-------------------------------------------------------*/

extern XZ xz[];
extern char xo_pool[];

static int mind_add();

typedef struct
{
  char title[56];
  char fpath[8];
}      XMIND;


static void
mind_item(num, mind)
  int num;
  XMIND *mind;
{
  prints("%6d     %-64s\n", num, mind->title);
}


static int
mind_body(xo)
  XO *xo;
{
  XMIND *mind;
  int num, max, tail;

  move(3, 0);
  clrtobot();
  max = xo->max;
  if (max <= 0)
  {
    if (vans("è¦æ–°å¢è³‡æ–™å—(Y/N)ï¼Ÿ[N] ") == 'y')
      return mind_add(xo);
    return XO_QUIT;
  }

  mind = (XMIND *) xo_pool;
  num = xo->top;
  tail = num + XO_TALL;
  if (max > tail)
    max = tail;

  do
  {
    mind_item(++num, mind++);
  } while (num < max);

  return XO_FOOT;
}


static int
mind_head(xo)
  XO *xo;
{
  vs_head("å¿ƒç†æ¸¬é©—", str_site);
  outs("[â†]é›¢é–‹ [Enter]æ¸¬é©— [q]ç€è¦½ [^P]æ–°å¢ [c]ä¿®æ”¹ [d]åˆªé™¤ [h]æŠ•ç¨¿æ ¼å¼\n"
    "\033[30;47m  ç·¨è™Ÿ     æ¸¬  é©—  å  ç¨±                                                     \033[m");
  return mind_body(xo);
}


static int
mind_load(xo)
  XO *xo;
{
  xo_load(xo, sizeof(XMIND));
  return mind_body(xo);
}


static int
mind_init(xo)
  XO *xo;
{
  xo_load(xo, sizeof(XMIND));
  return mind_head(xo);
}


static int      /* 1:æ–°å¢/ä¿®æ”¹  0:å–æ¶ˆ */
mind_edit(mind, echo)
  XMIND *mind;
  int echo;
{
  char fpath[64];

  if (echo == DOECHO)
  {
    time_t t = time(0);
    memset(mind, 0, sizeof(XMIND));
    archiv32(t, mind->fpath);
  }

  if (vget(b_lines, 0, "åç¨±ï¼š", mind->title, sizeof(mind->title), echo))
  {
    sprintf(fpath, "%s%s", DEF_PATH, mind->fpath);
    if (!vedit(fpath, 0))
      return 1;
    vmsg(echo == DOECHO ? "å–æ¶ˆæ–°å¢" : "å–æ¶ˆä¿®æ”¹");
  }

  return 0;
}


static int
mind_add(xo)
  XO *xo;
{
  XMIND mind;

  if (!HAS_PERM(PERM_SYSOP))
    return XO_NONE;

  if (mind_edit(&mind, DOECHO))
  {
    rec_add(xo->dir, &mind, sizeof(XMIND));
    xo->pos = XO_TAIL;
    xo_load(xo, sizeof(XMIND));
  }
  return mind_head(xo);
}


static int
mind_delete(xo)
  XO *xo;
{
  if (!HAS_PERM(PERM_SYSOP))
    return XO_NONE;

  if (vans(msg_del_ny) == 'y')
  {
    if (!rec_del(xo->dir, sizeof(XMIND), xo->pos, NULL))
      return mind_load(xo);
  }
  return XO_FOOT;
}


static int
mind_change(xo)
  XO *xo;
{
  XMIND *mind, mate;
  int pos, cur;

  if (!HAS_PERM(PERM_SYSOP))
    return XO_NONE;

  pos = xo->pos;
  cur = pos - xo->top;
  mind = (XMIND *) xo_pool + cur;

  mate = *mind;
  mind_edit(mind, GCARRY);
  if (memcmp(mind, &mate, sizeof(XMIND)))
  {
    rec_put(xo->dir, mind, sizeof(XMIND), pos, NULL);
    move(3 + cur, 0);
    mind_item(++pos, mind);
  }

  return mind_init(xo);
}


static int
mind_browser(xo)
  XO *xo;
{
  XMIND *mind;
  int pos, cur;
  char fpath[64];

  if (!HAS_PERM(PERM_SYSOP))
    return XO_NONE;

  pos = xo->pos;
  cur = pos - xo->top;
  mind = (XMIND *) xo_pool + cur;
  sprintf(fpath, "%s%s", DEF_PATH, mind->fpath);
  more(fpath, NULL);
  return mind_init(xo);
}


static int
mind_do(xo)
  XO *xo;
{
  XMIND *mind;
  int pos, cur;
  char fpath[64];

  pos = xo->pos;
  cur = pos - xo->top;
  mind = (XMIND *) xo_pool + cur;
  sprintf(fpath, "%s%s", DEF_PATH, mind->fpath);
  do_test(fpath, mind->title);

  return mind_init(xo);
}


static int
mind_help(xo)
  XO *xo;
{
  char fpath[64];

  sprintf(fpath, "%shelp", DEF_PATH);
  more(fpath, NULL);
  return mind_head(xo);
}


static KeyFunc mind_cb[] =
{
  XO_INIT, mind_init,
  XO_LOAD, mind_load,
  XO_HEAD, mind_head,
  XO_BODY, mind_body,

  Ctrl('P'), mind_add,
  'r', mind_do,
  'q', mind_browser,
  'c', mind_change,
  'd', mind_delete,
  'h', mind_help
};


int
main_mind()
{
  XO *xo;
  char fpath[64];

  /* å€Ÿç”¨ XZ_PALï¼Œæ‰€ä»¥ feeter æœƒä¸å°ï¼Œæ²’å·® :p */
  sprintf(fpath, "%sindex", DEF_PATH);
  xz[XZ_PAL - XO_ZONE].xo = xo = xo_new(fpath);
  xz[XZ_PAL - XO_ZONE].cb = mind_cb;
  xover(XZ_PAL);
  free(xo);

  return 0;
}

--
[1;32mâ€» Origin: [33må…ƒæ™ºå¤§å­¸ é¢¨ä¹‹å¡” [37m<bbs.yzu.edu.tw> [m
[1;32mâ€» From  : [36mbbs.yzu.edu.tw[m
