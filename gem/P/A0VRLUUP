ç™¼ä¿¡äºº: itoc.bbs@xeon.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [å•é¡Œ] æ¿¾æŽ‰ascii
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (Wed, 19 Nov 2003 09:36:42 +0800 (CST))  Updated: 2003/11/19

â€» å¼•è¿°ã€Šcpd.bbs@pitch.twbbs.org (Seasons)ã€‹ä¹‹éŠ˜è¨€ï¼š
> åƒkkcityä¸€æ¨£ï¼Œè½‰å¯„æ™‚å¯ä»¥é¸æ“‡...
> æ˜¯å¦è¦ä¿ç•™ ANSI å½©è‰²æŽ§åˆ¶ç¢¼ï¼Ÿ(Yes/No) [;47m   [m
> è¦ºå¾—å¥½åƒæ»¿ä¸éŒ¯çš„ï¼Œæ‡‰è©²æ€Žéº¼åšå¥½å‘¢ï¼Ÿ

: struct.h

#define MQ_JUSTIFY      0x01    /* èº«åˆ†èªè­‰ä¿¡å‡½ */
#define MQ_ATTACH       0x02    /* æœ‰ attachment çš„ä¿¡å‡½ */
+ #define MQ_NOANSI       0x04    /* strip æŽ‰ ANSI çš„ä¿¡ä»¶ */

: xover.c:xo_forward()

  static char rcpt[64];
  char fpath[128], folder[80], *dir, *title, *userid;
  HDR *hdr, xhdr;
  int tag, locus, userno, cc, xmode;
  int method;           /* è½‰å¯„åˆ° 0:ç«™å¤– >0:è‡ªå·± <0:å…¶ä»–ç«™å…§ä½¿ç”¨è€… */
+ int mq;

  ...
  ...

  else
  {
    if (not_addr(rcpt))
      return XO_FOOT;

    method = 0;
+   mq = (vans("æ˜¯å¦ä¿ç•™ ANSI å½©è‰²æŽ§åˆ¶ç¢¼(Y/N)ï¼Ÿ[Y] ") == 'n') ? MQ_NOANSI : 0;
  }

  ...
  ...

      else                      /* è½‰å¯„ç«™å¤– */
      {
-       if ((cc = bsmtp(fpath, title, rcpt, 0)) < 0)
+       if ((cc = bsmtp(fpath, title, rcpt, mq)) < 0)
          break;
      }

: mail.c:bsmtp()

    if (fp = fopen(fpath, "r"))
    {
      char *ptr;
+     char tmp[512];

      str = buf;
      *str++ = '.';
-     while (fgets(str, sizeof(buf) - 3, fp))
+     while (fgets(tmp, sizeof(tmp), fp))
      {
+       if (method & MQ_NOANSI)
+       {
+         str_ansi(str, tmp, sizeof(buf) - 3);
+         strcat(str, "\r\n");
+       }
+       else
+       {
+         str_ncpy(str, tmp, sizeof(buf) - 3);
          if (ptr = strchr(str, '\n'))
          {
            *ptr++ = '\r';
            *ptr++ = '\n';
            *ptr = '\0';
          }
+       }
        fputs((*str == '.' ? buf : str), fw);
      }
      fclose(fp);
    }

--
 [1;43mâ”Œ[44mâ”¼[m Or[1mig[30min[m: [44m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [31;47m processor.tfcis.org [m
 [1;41mâ””[42mâ”˜[m A[1mut[30mho[mr: [1;36mitoc [30må¾ž [35mitoc.dorm11.nctu.edu.tw [30mç™¼è¡¨[m
