ä½œè€…: itoc (æ´»åŠ›å†ç¾) çœ‹æ¿: plan
æ¨™é¡Œ: [åŠŸèƒ½] æ“‹æ‰åŒä¸€å€‹E-mailè¨»å†Šçš„ç¬¬4å€‹ID
æ™‚é–“: Sun Sep 29 18:31:16 2002                          Updated: 2005/01/09

â€» å¼•è¿°ã€ŠYangwenli.bbs@bbs.sa.ncyu.edu.tw (æ¥Šå¨åˆ©)ã€‹ä¹‹éŠ˜è¨€ï¼š
>     account.cæœƒæŠŠåŒä¸€ email èªè­‰å¤šæ¬¡çš„ ID ç´€éŒ„ä¸‹ä¾†ï¼Œ
>     èƒ½ä¸èƒ½ç›´æ¥åœ¨è¨»å†Šç¬¬4å€‹ ID çš„æ™‚å€™å°±æª”ä¸‹ä¾†å‘¢ï¼Ÿ

: global.h

  #define FN_ETC_EXPIRE   "etc/expire.conf"     /* çœ‹æ¿æ–‡ç« ç¯‡æ•¸ä¸Šé™è¨­å®š */
+ #define FN_ETC_EMAILADDR "etc/emailaddr"      /* åŒä¸€ email èªè­‰å¤šæ¬¡åˆ—è¡¨ */

: user.c:ban_addr()

  /* ä¸åœ¨ç™½åå–®ä¸Šæˆ–åœ¨é»‘åå–®ä¸Š */
- return (!acl_has(TRUST_ACLFILE, foo, host + 1) ||
-   acl_has(UNTRUST_ACLFILE, foo, host + 1) > 0);
+ if (!acl_has(TRUST_ACLFILE, foo, host + 1) ||
+   acl_has(UNTRUST_ACLFILE, foo, host + 1) > 0)
+ {
+   return 1;
+ }
+ else       /* åœ¨ç™½åå–®ä¸Šä¸”ä¸åœ¨é»‘åå–®ä¸Šï¼Œå†æª¢æŸ¥æ˜¯å¦è¶…éèªè­‰å››æ¬¡ä»¥ä¸Š */
+ {
+   /* xeon.050109: è‹¥ç”¨åŸä¾†çš„ email é‡æ–°èªè­‰ï¼Œ
+                   å³ä½¿åœ¨ emailaddr ä¸Šä¹Ÿå¯ä»¥èªè­‰ */
+   if (str_cmp(cuser.email, addr) &&
+     acl_has(FN_ETC_EMAILADDR, foo, host + 1) > 0)
+     return 1;
+ }
+ return 0;

: reaper.c

#ifdef EADDR_GROUPING
static FILE *faddr;
+ static FILE *faddr2;
#endif

: reaper.c:report_eaddr_group()

static void
report_eaddr_group()
{
  int i, j, cnt;
+ int logit;
  off_t off;
  int fd;

  SCHEMA s;
  /* funo */

  fprintf(faddr, "Email registration over %d times list\n\n", EMAIL_REG_LIMIT);

  for (i = 0; i < numC; i++)
  {
    for (cnt = 0, j = chain[i].link; j; cnt++, j = plist[j]);
    if (cnt > EMAIL_REG_LIMIT)
    {
+     logit = 0;

  ...
  ...

          fprintf(faddr, "%5d) %-13s%s[%d]\t%s\n", acct.userno, acct.userid,
            buf, acct.numlogins, acct.email);

+         if (!logit)       /* ä¸€å€‹ email åª log ä¸€æ¬¡ */
+         {
+           logit = 1;
+           fprintf(faddr2, "%s\n", acct.email);
+         }
        }
      }
    }

  }
}
#endif

: reaper.c:main()

#ifdef EADDR_GROUPING
  faddr = fopen(FN_RUN_EMAILADDR, "w");
  if (faddr == NULL)
    exit(1);
+ faddr2 = fopen(FN_ETC_EMAILADDR, "w");
+ if (faddr2 == NULL)
+   exit(1);
#endif

  ...
  ...

#ifdef EADDR_GROUPING
  free(chain);
  free(plist);
  fclose(faddr);
+ fclose(faddr2);
#endif


  æ¯é€±è·‘äº† reaper ä»¥å¾Œæœƒç”¢ç”Ÿå‡º etc/emailaddr
  è¨˜éŒ„è‘—ä½¿ç”¨è¶…éä¸‰æ¬¡çš„ email
  åœ¨é€™åå–®ä¸­çš„å°‡æ¯”ç…§ untrust.acl é»‘åå–®è¾¦ç†

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ [32mitoc.Dorm-GD2.NCTU.edu.tw[37m ç™¼è¡¨[m
