ä½œè€…: itoc (ç«™ä¸Šäººæ•¸ï¼š802) ç«™å…§: plan
æ¨™é¡Œ: [åŠŸèƒ½] ç§»é™¤éŽæœŸå‚™ä»½
æ™‚é–“: 2006/06/22 Thu 10:16:02                           Updated: 2006/06/22

/*-------------------------------------------------------*/
/* util/rmbackup.c  ( NTHU MapleBBS Ver 3.10 )           */
/*-------------------------------------------------------*/
/* target : ç§»é™¤éŽæœŸå‚™ä»½                                 */
/* create : 06/06/22                                     */
/* update :   /  /                                       */
/* author : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/

#if 0

æœ¬ç¨‹å¼æ˜¯æ‹¿ä¾†ç§»é™¤ BBS çš„å®šæœŸå‚™ä»½ï¼ŒåŸ·è¡Œçš„æ—¥æœŸå’Œ backup* ä¸€æ¨£

â—Ž æ¯é€±æŒ‰æ˜ŸæœŸå¹¾å‚™ä»½ï¼š#define CASE_BACKUP_BY_WDAY
è‹¥ crontab å‚™ä»½çš„éƒ¨åˆ†å¯«æˆé€™æ¨£
4 3 * * 2  bin/backupbrd > /dev/null 2>&1
4 3 * * 3  bin/backupgem > /dev/null 2>&1
4 3 * * 4  bin/backupusr > /dev/null 2>&1
4 3 * * 5  bin/backupoth > /dev/null 2>&1
é‚£éº¼å°±åœ¨ crontab è£¡é¢åŠ é€™äº›ä¾†åˆªé™¤å‚™ä»½
4 3 * * 2  bin/rmbackup -b > /dev/null 2>&1
4 3 * * 3  bin/rmbackup -g > /dev/null 2>&1
4 3 * * 4  bin/rmbackup -u > /dev/null 2>&1
4 3 * * 5  bin/rmbackup -o > /dev/null 2>&1

â—Ž æ¯æœˆæŒ‰æ—¥å‚™ä»½ï¼š#define CASE_BACKUP_BY_DAY
è‹¥ crontab å‚™ä»½çš„éƒ¨åˆ†å¯«æˆé€™æ¨£
4 3 1,16 * *  bin/backupbrd > /dev/null 2>&1
4 3 5,20 * *  bin/backupgem > /dev/null 2>&1
4 3 9,24 * *  bin/backupusr > /dev/null 2>&1
4 3 12,27 * *  bin/backupoth > /dev/null 2>&1
é‚£éº¼å°±åœ¨ crontab è£¡é¢åŠ é€™äº›ä¾†åˆªé™¤å‚™ä»½
4 2 1,16 * *  bin/rmbackup -b > /dev/null 2>&1
4 2 5,20 * *  bin/rmbackup -g > /dev/null 2>&1
4 2 9,24 * *  bin/rmbackup -u > /dev/null 2>&1
4 2 12,27 * *  bin/rmbackup -o > /dev/null 2>&1

#endif

#include <time.h>

#define BAKPATH         "/home/bbs/bak"     /* å‚™ä»½æª”çš„è·¯å¾‘ï¼ŒæŠ„ config.h */


/* ä»¥ä¸‹äºŒè€…é¸ä¸€å€‹ #defineï¼Œå¦ä¸€å€‹ #undef */
#define CASE_BACKUP_BY_WDAY    /* æ¯é€±æŒ‰æ˜ŸæœŸå¹¾å‚™ä»½ */
#undef  CASE_BACKUP_BY_DAY     /* æ¯æœˆæŒ‰æ—¥å‚™ä»½ */


int
main(argc, argv)
  int argc;
  char *argv[];
{
  int type;
  int yy, mm, dd;
  char *dir;
  char cmd[256];
  time_t now;
  struct tm *ptime;

  type = getopt(argc, argv, "bguo");
  if (type == 'b')
    dir = "brd";
  else if (type == 'g')
    dir = "gem";
  else if (type == 'u')
    dir = "usr";
  else if (type == 'o')
    dir = "oth";
  else
  {
    printf("%s [-b | -g | -u | -o]\n", argv[0]);
    return 0;
  }


#ifdef CASE_BACKUP_BY_WDAY

  /* æ¸…é™¤å…«é€±å‰çš„å‚™ä»½ */
  time(&now);
  now -= 86400 * 7 * 8;
  ptime = localtime(&now);
  yy = ptime->tm_year % 100;
  mm = ptime->tm_mon + 1;
  dd = ptime->tm_mday;

#elif defined(CASE_BACKUP_BY_DAY)

  /* æ¸…é™¤äºŒå€‹æœˆå‰çš„å‚™ä»½ */
  time(&now);
  ptime = localtime(&now);
  yy = ptime->tm_year % 100;
  mm = ptime->tm_mon + 1;
  dd = ptime->tm_mday;
  mm -= 2;
  if (mm <= 0)
  {
    yy--;
    mm += 12;
  }

#else

  return 0;

#endif

  sprintf(cmd, "rm -rf %s/%s%02d%02d%02d",
    BAKPATH, dir, yy, mm, dd);

  system(cmd);

  return 0;
}

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ž [32mpc512-1.EE.NCTU.edu.tw[37m ç™¼è¡¨[m
