ç™¼ä¿¡äºº: hpo14.bbs@ntust.org (é™Œç”Ÿ) çœ‹æ¿: plan
æ¨™  é¡Œ: [ä¿®æ­£] è½‰éŒ„æ–‡ç« è‡³ä¿¡ç®±: åŽŸæ–‡ç« åŠ è¨»è¨˜éŒ„
ç™¼ä¿¡ç«™: è³‡å·¥æ¸…æµç«™ (2007/05/10 Thu 03:58:15)              Updated: 2007/05/10

åƒè€ƒé€™ç¯‡å¯«çš„ [1;42m[ä¿®æ­£] è½‰éŒ„æ–‡ç« : åŽŸæ–‡ç« åŠ è¨»è¨˜éŒ„[m by guessi

å°å¼Ÿèªç‚ºï¼Œé™¤è½‰éŒ„æ–‡ç« åˆ°çœ‹æ¿æ‡‰è©²åœ¨åŽŸæ–‡åŠ è¨»ç´€éŒ„ä»¥å¤–

è‹¥æœ‰ä½¿ç”¨è€…å°‡æ–‡ç« è½‰å›žè‡ªå·±æˆ–æ˜¯ä»–äººä¿¡ç®±çš„è©±ï¼Œä¹Ÿæ‡‰è©²åœ¨åŽŸæ–‡åŠ è¨»ç´€éŒ„

ç›®å‰è‡ªå·±ä½¿ç”¨æ˜¯æ²’æœ‰å•é¡Œã€‚

: src/maple: post_forward(xo)

int
post_forward(xo)
  XO *xo;
{
  ACCT muser;
+ int result;
  HDR *hdr;

  hdr = (HDR *) xo_pool + (xo->pos - xo->top);

   â€¦â€¦

  if (acct_get("è½‰é”ä¿¡ä»¶çµ¦ï¼š", &muser) > 0)
  {
    strcpy(quote_user, hdr->owner);
    strcpy(quote_nick, hdr->nick);
    hdr_fpath([1;33mquote_file[m, xo->dir, hdr);
    sprintf(ve_title, "%.64s (fwd)", hdr->title);
    move(1, 0);
    clrtobot();
    prints("è½‰é”çµ¦: %s (%s)\næ¨™  é¡Œ: %s\n",
      muser.userid, muser.username, ve_title);

-   mail_send(muser.userid);
+   result = mail_send(muser.userid);

+   if (result >= 0)
+   {
+     char fpath[64];
+     FILE *fp;
+
+     hdr_fpath(fpath, xo->dir, hdr);

      //é€™é‚Šå°å¼Ÿä¸ç¢ºå®šèƒ½å¦ç›´æŽ¥ä½¿ç”¨ä¸Šé¢æ¨™é»ƒè‰²çš„è®Šæ•¸ç•¶ä½œ FILEçš„æª”æ¡ˆè·¯å¾‘
      //å› ç‚º hdr_path æŠ“çš„éƒ½ä¸€æ¨£
      //å¦‚æžœå¯ä»¥ï¼Œå‰‡ä¸‹é¢çš„ [1;32mfpath[m è«‹æ”¹æˆ [1;33mquote_file[m
+
+     if (fp = fopen([1;32mfpath[m, "a"))
+     {
+       char msg[32];
+
+       time_t now;
+       struct tm *ptime;
+
+       time(&now);
+       ptime = localtime(&now);
+
+       sprintf(msg, "è½‰éŒ„è‡³ %s ä¿¡ç®±", (muser.userid == cuser.userid) ?
+         muser.userid : "ç§äºº");
+
+       fprintf(fp, "\033[32mï¼ƒ \033[1m%s\033[;32m %-*s\033[m"
+         " %02d/%02d %02d:%02d\033[m\n",
+         cuser.userid, 62 - strlen(cuser.userid), msg,
+         ptime->tm_mon + 1, ptime->tm_mday, ptime->tm_hour, ptime->tm_min);
+         /* æ ¼å¼è‡ªè¨‚ ç›¡é‡èˆ‡æŽ¨æ–‡é¡žä¼¼ */
+
+       fclose(fp);
+
+     } /* è½‰éŒ„åŽŸæ–‡è¨»è¨˜éŒ„ 070510 hpo14 */
+   }

    *quote_file = '\0';
  }
  return XO_HEAD;
}

--
[1m>> [33må°ç£ç§‘æŠ€å¤§å­¸ è³‡å·¥æ¸…æµç«™ [;31m# [1;31mntust.org [;31m#[m
[1m>> [;32mAu[1mthor: 61.59.78.243[m
