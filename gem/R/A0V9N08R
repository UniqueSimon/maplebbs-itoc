ä½œè€…: DarkKiller (æ‚¸å‹•) çœ‹æ¿: Daily
æ¨™é¡Œ: Re: [docs] postfix åœ¨ anti-spam ä¸Šçš„è¨­å®š (UCE Controls)
æ™‚é–“: Wed Aug 29 17:39:50 2001

* LICENSE

  This document uses GNU FDL (Version 1.1, March 2000):
  http://www.gnu.org/licenses/fdl.txt

* AUTHOR

  Gea-Suan Lin <gslin@ccca.nctu.edu.tw>

* å‰è¨€ã€åƒè€ƒæ–‡ç»

  postfix çš„åŠŸèƒ½çš„ç¢ºè¶…ä¹ç•¶åˆæˆ‘çš„æƒ³åƒï¼Œè€Œä¸” source ä¹Ÿå¾ˆå®¹æ˜“æ‡‚ï¼Œæˆ‘æŠŠå¾ˆå¤š
  æœ¬ä¾†æ˜¯ç”¨ sendmail çš„ server éƒ½æ›æˆ postfixã€‚

  é€™ç¯‡æ–‡ç« ä¸æ˜¯çµ¦å‰›ç¢° postfix çš„äººçœ‹çš„ï¼Œä½ æ‡‰è©²è¦å° postfix æœ‰äº›è¨±äº†è§£ï¼Œ
  å¦å¤–ï¼Œæˆ‘æœƒæåˆ°ä¸€äº› regular expression çš„æ±è¥¿ï¼Œä½ å¯ä»¥ man re_format
  çœ‹åˆ°ç›¸é—œçš„ä»‹ç´¹ (æˆ‘çŸ¥é“ä½ ä¸å–œæ­¡çœ‹è‹±æ–‡ï¼Œä½†æ˜¯é€™ä»½ manpage å¯«çš„å¾ˆå¥½)ã€‚

  å¦å¤–ï¼ŒSMTP æŒ‡ä»¤çš„ä»‹ç´¹ä½ ä¹Ÿè¦æœƒä¸€äº›ï¼Œæˆ‘å€‘åœ¨ä»‹ç´¹ anti-UCE (ä¸‹é¢æœƒæåˆ°)
  çš„æ™‚å€™æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯è·Ÿé€™é»æœ‰é—œã€‚

  æˆ‘ä¸æœƒä»‹ç´¹æ‰€æœ‰çš„åŠŸèƒ½ï¼Œå®Œæ•´çš„åŠŸèƒ½é‚„æ˜¯è¦è«‹ä½ åƒè€ƒåŸæ–‡çš„æ–‡ç»è³‡æ–™ï¼š

  http://d2.nctu.edu.tw/postfix/ (postfix äº¤å¤§ web mirror site)
  /usr/local/etc/postfix/sample-smtpd.cf

  å¦‚æœä½ æœ‰ä»»ä½•å»ºè­°ï¼Œæ‚¨å¯ä»¥ mail çµ¦æˆ‘ï¼Œæˆ–æ˜¯åœ¨çœ‹æ¿ä¸Šè¨è«–ï¼Œè¬è¬ã€‚

* UCE ?

  UCE æ˜¯ Unsolicited Commercial Email çš„ç¸®å¯«ï¼Œç°¡å–®çš„èªªï¼Œå…¶å¯¦å°±æ˜¯å»£å‘Šä¿¡ã€‚

  ä¸‹é¢è¬›åˆ°çš„è¨­å®šï¼Œéƒ½æ˜¯åœ¨ /usr/local/etc/postfix/main.cf è£¡é¢ã€‚

* anti-UCE çš„æ©Ÿåˆ¶ -- smtpd_client_restrictions

  æœ‰ä¸å°‘çš„å»£å‘Šä¿¡æ˜¯å¾æ²’æœ‰åè§£çš„ IP é€£ç·šéä¾†ï¼Œå°æ–¼é€™é¡ requestï¼Œæˆ‘å€‘å¯ä»¥ç”¨
  reject_unknown_client é€™å€‹åƒæ•¸æ‹’çµ•ä»–çš„ requestã€‚

  [1msmtpd_client_restrictions = reject_unknown_client[m

  æˆ–è€…ï¼Œæˆ‘å€‘å¯ä»¥è¦æ±‚ postfix é€éä¸€å€‹è‡ªå·±è¨­çš„è¨­å®šæª”å»è¨­å®šé»‘ç™½åå–®ï¼š

  [36m# å¤ªé•·äº†ï¼Œè«‹æ¥æˆä¸€è¡Œ[m
  [1msmtpd_client_restrictions = check_client_access regexp:/usr/local/etc/[m
  [1mpostfix/client-access[m

  å…¶ä¸­çš„ regexp æ˜¯æŒ‡ä½¿ç”¨ regular expressionã€‚é€™å€‹ client-access çš„æª”æ¡ˆå…§
  å®¹ï¼Œé•·çš„åƒæ˜¯é€™å€‹æ¨£å­ï¼š

  [36m# è¨»è§£ç”¨ '#' é–‹é ­[m
  [36m#[m
  [36m# ç”¨ '/' æŠŠ regular expression åŒ…èµ·ä¾†[m
  [36m#[m
  [36m# OK è¡¨ç¤ºå…è¨±é€™å€‹ requestï¼Œä¸å†å° smtpd_client_restrictions å¾Œé¢æ‰€åˆ—çš„[m
  [36m# æ¢ä»¶åšæª¢æŸ¥äº†ã€‚[m
  /\.edu\.tw$/          OK
  /\.edu$/              OK
  /\.com\.tw$/          OK
  /\.com$/              OK
  /\.net\.tw$/          OK
  /\.net$/              OK
  /\.org\.tw$/          OK
  /\.org$/              OK
  /\.idv\.tw$/          OK
  /\.cc$/               OK
  /\.tw$/               OK
  [36m#[m
  [36m# REJECT è¡¨ç¤ºä¸åƒé€™å°ä¿¡ (å…¶å¯¦ä¹Ÿéƒ½é‚„æ²’çœ‹åˆ°ä¿¡ä»¶)[m
  /kimo\.com\.tw$/      REJECT
  [36m#[m
  [36m# é™¤äº† REJECTï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªå·±è¨‚ç†ç”±ï¼Œåªè¦æ˜¯ [45]xx [text] å³å¯ï¼š[m
  /\.hinet\.net$/       554 I don't want to receive ANY mail from hinet
  [36m#[m
  [36m# å¦‚æœéƒ½ä¸ç¬¦åˆä¸Šé¢åˆ—å‡ºä¾†çš„ï¼Œå°±ç¹¼çºŒæª¢æŸ¥å§ã€‚[m

  å¦å¤–ï¼Œpostfix æ”¯æ´ DNSBL çš„æ©Ÿåˆ¶ï¼Œé—œæ–¼ä»€éº¼æ˜¯ DNSBLï¼Œè«‹è‡ªè¡Œæ–¼ç¶²é ä¸Šæœå°‹

  æˆ‘å€‘å¯ä»¥è¨­å®š maps_rbl_domainsï¼š

  [36m# å¤ªé•·äº†ï¼Œè«‹æ¥æˆä¸€è¡Œ[m
  [1mmaps_rbl_domains = orbs.dorkslayers.com orbz.gst-group.co.uk relays.os[m
  [1mirusoft.com[m

  ç¶œåˆä»¥ä¸Šæ‰€èªªçš„ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥é€™æ¨£è¨­ï¼š

  [36m# é€™ä»£è¡¨æˆ‘å€‘å…ˆæ‹’çµ•æ²’æœ‰åè§£çš„æ©Ÿå™¨ï¼Œç„¶å¾Œå†æ‹’çµ•åœ¨ maps_rbl_domains è£¡é¢çš„[m
  [36m# IPï¼Œç„¶å¾Œå†æª¢æŸ¥ client-access è£¡é¢çš„è¨­å®šã€‚[m
  [36m#[m
  [36m# å¤ªé•·äº†ï¼Œè«‹æ¥æˆä¸€è¡Œ[m
  [1msmtpd_client_restrictions = reject_unknown_client, reject_maps_rbl, ch
  [1meck_client_access, regexp:/usr/local/etc/postfix/client-access[m

* anti-UCE çš„æ©Ÿåˆ¶ -- smtpd_sender_restrictions

  ç†è«–ä¸Šï¼Œmail from åœ¨æœ‰æŠ€å·§çš„äº‚å¡«çš„æƒ…æ³ä¸‹ï¼Œä½ ç„¡æ³•çŸ¥é“ä»–çš„çœŸå¯¦æ€§ï¼Œæ‰€ä»¥è¨­
  é€™å€‹ä¹Ÿæ²’æœ‰ä»€éº¼ç”¨ã€‚ä¸éï¼Œå°ç£çš„ spammers å°æ–¼é€ spam çš„æŠ€å·§ä¼¼ä¹é‚„æ˜¯åœç•™
  åœ¨ Sendmail 8.8.x without patch çš„éšæ®µï¼Œæ‰€ä»¥è¨­ä¸€ä¸‹æœƒæœ‰å¾ˆå¤§çš„ç”¨è™• :p

  ä¸‹é¢çš„è¨­å®šæœƒæŠŠ mail from é€éä¾†çš„ E-mail address å¾Œé¢çš„ domain æ‹¿å‡ºä¾†
  æŸ¥è©¢ï¼Œå¦‚æœä¸å­˜åœ¨ A RR æˆ–æ˜¯ MX RRï¼Œé‚£éº¼å°± reject æ‰ã€‚

  [1msmtpd_sender_restrictions = reject_unknown_sender_domain[m

* anti-UCE çš„æ©Ÿåˆ¶ -- smtpd_recipient_restrictions

  [36m# rcpt to è¨­é™[m
  smtpd_recipient_restrictions =

* anti-UCE çš„æ©Ÿåˆ¶ -- header_checks

  [36m# header çš„æª¢æŸ¥[m
  header_checks =

* å…¨éƒ¨è¨­å®šå¥½ä»¥å¾Œï¼Œé‡æ–°è¼‰å…¥ postfix

  postfix reload

--
                                    Gea-Suan Lin <gslin@informath.net>
--
â€» Origin: å°é¹¿é¹¿ <Deer.abpe.org> â—† From: infomath.math.nctu.edu.tw
