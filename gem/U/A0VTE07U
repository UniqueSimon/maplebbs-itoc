ä½œè€…: itoc (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: itoc
æ¨™é¡Œ: Re: [å•é¡Œ]æ‰¾å‡ºç²¾è¯å€å®¹é‡éå¤§çš„çœ‹æ¿
æ™‚é–“: Wed Dec 10 19:15:36 2003                          Updated: 2003/12/11

â€» å¼•è¿°ã€Šchwaian (ç„¡è¨€)ã€‹ä¹‹éŠ˜è¨€ï¼š
> æˆ‘åƒè€ƒbrdirå¯«äº†ä¸€æ”¯ æ‰¾ç²¾è¯å€å®¹é‡è¶…é5000KBå¤§å°çš„çœ‹æ¿

: src/util/Makefile

EXE =   .... gem-over

: src/util/gem-over.c æ–°å¢æ­¤ç¨‹å¼

/*-------------------------------------------------------*/
/* util/gem-over.c      ( NTHU CS MapleBBS Ver 3.10 )    */
/*-------------------------------------------------------*/
/* target : çµ±è¨ˆç²¾è¯å€éå¤§çš„çœ‹æ¿                         */
/* create : 03/12/10                                     */
/* update :   /  /                                       */
/* author : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/

#include "bbs.h"

static int total_n;         /* ç¯‡æ•¸ */
static int total_k;         /* byte æ•¸ */

static void
gem_checksize(fpath)
  char *fpath;
{
  int i;
  char *ptr, *str;
  struct stat st;
  struct dirent *de;
  DIR *dirp;

  total_n = 0;
  total_k = 0;

  if (stat(fpath, &st))
    return;

  total_n = st.st_size;
  ptr = (char *) strchr(fpath, '.');

  for (i = 0; i < 32; i++)
  {
    *ptr = radix32[i];
    *(ptr + 1) = '\0';
    if (!(dirp = opendir(fpath)))
      continue;

    *(ptr + 1) = '/';
    while (de = readdir(dirp))
    {
      str = de->d_name;

      if (*str <= ' ' || *str == '.')
        continue;

      strcpy(ptr + 2, str);

      if (!stat(fpath, &st))
      {
        if (*str == 'F')
          total_n += st.st_size;
        else if (*str == 'A')
          total_k += st.st_size;
      }
    }
    closedir(dirp);
  }

  total_n /= sizeof(HDR);
  total_k /= 1024;
}


int
main()
{
  FILE *fp;
  BRD brd;
  char fpath[64];

  chdir(BBSHOME);

  if (!(fp = fopen(FN_BRD, "r")))
    return -1;

  while (fread(&brd, sizeof(BRD), 1, fp) == 1)
  {
    if (!*brd.brdname)  /* æ­¤æ¿å·²è¢«åˆªé™¤ */
      continue;

    sprintf(fpath, "gem/brd/%s/%s", brd.brdname, FN_DIR);
    gem_checksize(fpath);

    if (total_n > 1000 || total_k > 5000)       /* 1000ç¯‡ã€5000KB */
      printf("%s æ¿ %d ç¯‡ %d bytes\n", brd.brdname, total_n, total_k);
  }
  fclose(fp);

  return 0;
}

--
 [1;43mâ”Œ[44mâ”¼[m Or[1mig[30min[m: [44m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [31;47m processor.tfcis.org [m
 [1;41mâ””[42mâ”˜[m A[1mut[30mho[mr: [1;36mitoc [30må¾ [35mitoc.dorm11.nctu.edu.tw [30mç™¼è¡¨[m
