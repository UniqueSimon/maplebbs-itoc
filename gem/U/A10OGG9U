ç™¼ä¿¡äºº: itoc.bbs@processor.tfcis.org (æ ¸å¿ƒå‹•åŠ›) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: é—œæ–¼ "ç‰ˆä¸»åˆªæ–‡æ™‚è‡ªè¡Œè¨­å®šç†ç”±"
ç™¼ä¿¡ç«™: å‹•åŠ›æ ¸å¿ƒ (2004/02/24 Tue 23:47:52)                Updated: 2006/07/04

â€» å¼•è¿°ã€ŠLoveforever.bbs@wretch.csie.nctu.edu.tw (é€é™å¦‚é¢¨..)ã€‹ä¹‹éŠ˜è¨€ï¼š
> é—œæ–¼ "ç‰ˆä¸»åˆªæ–‡æ™‚è‡ªè¡Œè¨­å®šç†ç”±"
> æˆ–æ˜¯Itocæ›¾ç¶“åœ¨å“ªå€‹ç«™ç™¼è¡¨éŽå‘¢?!
> æƒ³å°‹æ‰¾é€™å€‹åŠŸèƒ½

  æŠŠåˆªé™¤çš„æ–‡ç« åŠ ä¸Š POST_ERASE æ——æ¨™

: hdr.h

- #define POST_5        0x00000010
+ #define POST_ERASE    0x00000010      /* è¢«åˆªé™¤çš„æ–‡ç«  */

- #define MAIL_5        0x00000010
+ #define MAIL_ERASE    0x00000010

: post.c:post_delete() å¦‚æžœè¦æœ‰è¼¸å…¥ç†ç”±çš„åŠŸèƒ½å°±é€™æ¨£æ”¹

  if (vans(msg_del_ny) == 'y')
  {
    currchrono = hdr->chrono;
+   if (by_BM && vget(b_lines, 0, "è«‹è¼¸å…¥åˆªæ–‡ç†ç”±", buf, 40, DOECHO))
+     sprintf(hdr->title, "%s åˆªé™¤ç†ç”±ï¼š%s", cuser.userid, buf);
+   else
+     sprintf(hdr->title, "<< æœ¬æ–‡ç« ç¶“ %s åˆªé™¤ >>", cuser.userid);
+   hdr->xmode = POST_ERASE | (hdr->xmode & POST_BOTTOM);

: post.c:post_delete() å¦‚æžœä¸è¦æœ‰è¼¸å…¥ç†ç”±çš„åŠŸèƒ½å‰‡é€™æ¨£æ”¹

  if (vans(msg_del_ny) == 'y')
  {
    currchrono = hdr->chrono;
+   sprintf(hdr->title, "<< æœ¬æ–‡ç« ç¶“ %s åˆªé™¤ >>", cuser.userid);
+   hdr->xmode = POST_ERASE | (hdr->xmode & POST_BOTTOM);

: post.c:post_delete()

-   if (!rec_del(xo->dir, sizeof(HDR), xo->key == XZ_XPOST ?
-     hdr->xid : pos, cmpchrono))
+   if (!rec_put(xo->dir, hdr, sizeof(HDR), xo->key == XZ_XPOST ?
+     hdr->xid : pos, cmpchrono))
    {

: post.c:move_post()

- if (by_bm)
-   sprintf(post.title, "%-13s%.59s", cuser.userid, hdr->title);
- else if (!stat(fpath, &st))
+ if (!stat(fpath, &st))
    by_bm = st.st_size;

> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

  æœ‰ POST_ERASE æ——æ¨™çš„é¡¯ç¤º dï¼Œä¸¦è¦–ç‚ºå·²è®€

: post.c:post_attr()

  attr = ((mode & POST_BOTTOM) || !brh_unread(hdr->chrono) || 
+   (mode & POST_ERASE) || 
    !chkrestrict(hdr)) ? 0x20 : 0;

  ...
  ...

+ if (mode & POST_ERASE)
+   attr |= 'D';
#ifdef HAVE_REFUSEMARK
  if (mode & POST_RESTRICT)
    attr |= 'X';
  else
#endif

> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

  æŽ¥ä¸‹ä¾†è¦è®“æœ‰ POST_ERASE æ——æ¨™çš„ä»€éº¼å‹•ä½œéƒ½ä¸èƒ½åš

: post.c:post_reply()

+   if (hdr->xmode & POST_ERASE)
+     return XO_NONE;

#ifdef HAVE_REFUSEMARK
    if (!chkrestrict(hdr))
      return XO_NONE;
#endif

: post.c:post_browse()

+   if (xmode & POST_ERASE)
+     break;

#ifdef HAVE_REFUSEMARK
    if (!chkrestrict(hdr))
      break;
#endif

: post.c:post_cross()

+     if (hdr->xmode & POST_ERASE)
+       continue;

#ifdef HAVE_REFUSEMARK
      if (hdr->xmode & POST_RESTRICT)
        continue;
#endif

: post.c:post_forward()

+ if (hdr->xmode & POST_ERASE)
+   return XO_NONE;

#ifdef HAVE_REFUSEMARK
  if (!chkrestrict(hdr))
    return XO_NONE;
#endif

: post.c:post_edit()

  hdr = (HDR *) xo_pool + (xo->pos - xo->top);

+ if (hdr->xmode & POST_ERASE)
+   return XO_NONE;

: post.c:post_score()

+ if (hdr->xmode & POST_ERASE)
+   return XO_NONE;

#ifdef HAVE_REFUSEMARK
  if (!chkrestrict(hdr))
    return XO_NONE;
#endif

: xpost.c:XoXpost() åŠ xpost.c:XoNews()

+   if (head->xmode & POST_ERASE)
+     continue;

#ifdef HAVE_REFUSEMARK
    if (!chkrestrict(hdr))
      continue;
#endif

: xover.c:xo_thread()

+   if (hdr->xmode & POST_ERASE)
+     continue;

#ifdef HAVE_REFUSEMARK
    if (!chkrestrict(hdr))
      continue;
#endif

: gemc.c:gem_extend()

-   if ((hdr->chrono != chrono) &&
-     !(hdr->xmode & (GEM_FOLDER | GEM_RESTRICT | GEM_RESERVED)))
+   if ((hdr->chrono != chrono) &&
+     !(hdr->xmode & (GEM_FOLDER | GEM_RESTRICT | GEM_RESERVED | POST_ERASE)))
    {
      hdr_fpath(gpath, GemFolder, hdr);
      fputs(str_line, fp);
      f_suck(fp, gpath);
    }

: gem.c:gem_do_paste()

+ if (xmode & POST_ERASE)
+   return;

  if (xmode & (GEM_RESTRICT | GEM_RESERVED))  /* é™åˆ¶ç´šç²¾è¯å€ä¸èƒ½è¤‡è£½/è²¼ä¸Š */
    return;

: gem.c:gem_gather()

+   if (xmode & POST_ERASE)
+     continue;

    if (xmode & (GEM_RESTRICT | GEM_RESERVED))  /* é™åˆ¶ç´šç²¾è¯å€ä¸èƒ½å®šéŒ¨æ”¶éŒ„ */
      continue;


> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

  æœ€å¾Œåœ¨ expire æ™‚è¦ç æŽ‰æœ‰ POST_ERASE æ——æ¨™çš„æ–‡ç« 

: expire.c:expire()

  while (fread(&hdr, sizeof(hdr), 1, fpr) == 1)
  {
+   if (hdr.xmode & POST_ERASE)
+     keep = 0;
+   else if (hdr.xmode & POST_MARKED || total <= minp)
-   if (hdr.xmode & POST_MARKED || total <= minp)
      keep = 1;
    else if (hdr.chrono < duetime || total > maxp)
      keep = 0;
    else
      keep = 1;


--
 [1;43mâ•­[46mâ”¼[m Or[1mig[30min[m: [41m Maple-itocË™å‹•åŠ›æ ¸å¿ƒ [32;47m processor.tfcis.org [m
 [1;44mâ”¼[41mâ•¯[m A[1mut[30mho[mr: [1;33mitoc [30må¾ž [35m140.113.191.193 [30mç™¼è¡¨[m
