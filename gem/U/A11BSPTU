ç™¼ä¿¡äºº: BioStar.bbs@micro.bio.ncue.edu.tw (æ¾æ¹–å°é›²é›€) çœ‹æ¿: plan
æ¨™  é¡Œ: Re: [é–’èŠ] é¿å… so/vote.c åœ¨è³­ç›¤ç™¼éŒ¢æ™‚æ•¸å€¼æº¢ä½
ç™¼ä¿¡ç«™: åŸé¢¨?çœºæœˆ?æ“å¤©å´— (2005/06/26 Sun 15:52:31)      Updated: 2005/06/26

â€» å¼•è¿°ã€ŠBioStar (æ¾æ¹–å°é›²é›€)ã€‹ä¹‹éŠ˜è¨€ï¼š
> å‰›æ‰æƒ³åˆ°......
> è³­æ³¨èƒ½ä¸èƒ½æ˜¯é‡‘å¹£å‘¢ï¼Ÿ
> è¶…æ¥µå¯Œè±ªå¤§ç«æ‹¼......
> æ‡‰è©²æ›´åˆºæ¿€......

: include/struct.h struct VCH ä¸­å¾ nouse æ‹¿ä¸€å€‹ä¾†ç”¨......

-  char nouse[96];
+  char gold;           /* è¨˜éŒ„è³­æ³¨å–®ä½æ˜¯é‡‘å¹£:1 æˆ–éŠ€å¹£:0 */
+  char nouse[95];

: so/vote.c:vch_edit()

  else if (echo == DOECHO)      /* åªæœ‰æ–°å¢æ™‚æ‰èƒ½æ”¹è®Šè³­ç›¤çš„ç¥¨åƒ¹ */
  {
    /* è³­ç›¤å°±åªèƒ½é¸ä¸€é … */
    vch->maxblt = 1;

+   if (vans("è³­æ³¨å–®ä½è¦ç”¨é‡‘å¹£å—(Y/N)ï¼Ÿ[N] ") == 'y')
+   {
+     vget(b_lines - 5, 0, "è«‹å•æ¯ç¥¨å”®åƒ¹å¤šå°‘é‡‘å¹£ï¼Ÿ(100ï½1000)ï¼š",
+       ans, 7, DOECHO);
+     vch->gold = 1;
+   }
+   else
+   {
      vget(b_lines - 5, 0, "è«‹å•æ¯ç¥¨å”®åƒ¹å¤šå°‘éŠ€å¹£ï¼Ÿ(100ï½100000)ï¼š",
        ans, 7, DOECHO);
+     vch->gold = 0;
+   }

: so/vote.c:delvch()

      while (read(fd, &vlog, sizeof(VLOG)) == sizeof(VLOG))
      {
+       if (vch->gold)
+         paycheck.gold = vlog.numvotes * vch->price;
+       else
          paycheck.money = vlog.numvotes * vch->price;
        usr_fpath(buf, vlog.userid, FN_PAYCHECK);
        rec_add(buf, &paycheck, sizeof(PAYCHECK));
      }

: so/vote.c:viote_join()

  if (vch->vgamble == '$')
  {
-   if (cuser.money < vch->price)
+   if ((vch->gold && cuser.gold < vch->price) ||
+     (!vch->gold && cuser.money < vch->price))
    {
      vmsg("æ‚¨çš„éŒ¢ä¸å¤ åƒåŠ è³­ç›¤");
      return XO_FOOT;
    }

ï¼ˆä¸­ç•¥ï¼‰

+    if (vch->gold)
+      sprintf(buf, "æ¯å¼µè³­ç¥¨ %d é‡‘å¹£ï¼Œè«‹å•è¦è²·å¹¾å¼µï¼Ÿ[1] ", vch->price)
+    else
       sprintf(buf, "æ¯å¼µè³­ç¥¨ %d éŠ€å¹£ï¼Œè«‹å•è¦è²·å¹¾å¼µï¼Ÿ[1] ", vch->price);

ï¼ˆä¸­ç•¥ï¼‰

-     if (cuser.money >= fd)
+     if ((vch->gold && cuser.gold >= fd) ||
+       (!vch->gold && cuser.money >= fd))
        break;

ï¼ˆä¸­ç•¥ï¼‰

  if (vch->vgamble == '$')
  {
+   if (vch->gold)
+     cuser.gold -= fd;   /* fd æ˜¯è¦ä»˜çš„è³­é‡‘ */
+   else
      cuser.money -= fd;  /* fd æ˜¯è¦ä»˜çš„è³­é‡‘ */
  }

: so/vote.c:vlog_pay()

+   if (vch->gold)
+     fprintf(fp, "æ¿ä¸» %s æŠ½é ­ï¼Œå¯ç²å¾— %d é‡‘å¹£\n", vch->owner, money);
+   else
      fprintf(fp, "æ¿ä¸» %s æŠ½é ­ï¼Œå¯ç²å¾— %d éŠ€å¹£\n", vch->owner, money);

    memset(&paycheck, 0, sizeof(PAYCHECK));
    time(&paycheck.tissue);
+   if (vch->gold)
+     paycheck.gold = money;
+   else
      paycheck.money = money;

ï¼ˆä¸­ç•¥ï¼‰
+         if (vch->gold)
+         {
+           fprintf(fp, "%s è²·äº† %d å¼µï¼Œå…±å¯ç²å¾— %d é‡‘å¹£\n",
+             vlog.userid, vlog.numvotes, money);
+           paycheck.gold = money;
+         }
+         else
+         {
            fprintf(fp, "%s è²·äº† %d å¼µï¼Œå…±å¯ç²å¾— %d éŠ€å¹£\n",
              vlog.userid, vlog.numvotes, money);
            paycheck.money = money;
+         }

          sprintf(paycheck.reason, "[è³­ç›¤] %s", currboard);

--
 [1;41mâ†’[44mâ†“[m O[1mri[30mgi[mn: [1;43m å½°åŒ–å¸«å¤§ç”Ÿç‰©ç³»Ë™åŸé¢¨?çœºæœˆ?æ“å¤©å´— [47m micro.bio.ncue.edu.tw [m
 [1;45mâ†‘[42mâ†[m Au[1mt[30mho[mr: [1;33mBioStar[m å¾ [1;34m61-64-116-235-adsl-zha.STATIC.so-net.net.tw[m ç™¼è¡¨
