ä½œè€…: itoc (æ‹¯æ•‘ä¸€å€‹éˆé­‚) çœ‹æ¿: plan
æ¨™é¡Œ: [åŠŸèƒ½] ç™¼è¡¨æ–‡ç« çš„ prefix ç”±æ¿ä¸»è¨­å®š
æ™‚é–“: Tue Jun 18 23:36:31 2002                          Updated: 2007/04/16

â€» å¼•è¿°ã€Štandrian.bbs@ntcb.twbbs.org.tw (å¹»åŸŸé­”åŸå¾Œç¥–)ã€‹ä¹‹éŠ˜è¨€ï¼š
> è«‹é¸æ“‡æ–‡ç« é¡åˆ¥ï¼ˆæŒ‰ Enter è·³éï¼‰ï¼š
> é¡åˆ¥ï¼š1.[å…¬å‘Š] 2.[æ–°è] 3.[é–’èŠ] 4.[æ–‡ä»¶] 5.[å•é¡Œ] 6.[æ¸¬è©¦]
> è«‹å•æ˜¯å¦å¯ä»¥è®“æ¿ä¸»è‡ªè¡Œä¿®æ”¹ä»¥ä¸Šçš„æ–‡ç« é¡åˆ¥??  ^^

  config.h è¦ #define POPUP_ANSWER åŠ POST_PREFIX æ‰å¯ä»¥ä½¿ç”¨æœ¬åŠŸèƒ½

: manage.c:post_prefix_edit() æ–°å¢æ–¼ post_memo_edit() å¾Œé¢

#ifdef POST_PREFIX
/* ----------------------------------------------------- */
/* æ¿ä¸»åŠŸèƒ½ : ä¿®æ”¹ç™¼æ–‡é¡åˆ¥                               */
/* ----------------------------------------------------- */


static int
post_prefix_edit(xo)
  XO *xo;
{
#define NUM_PREFIX      6
  int i;
  FILE *fp;
  char fpath[64], buf[20], prefix[NUM_PREFIX][20], *menu[NUM_PREFIX + 3];
  char *prefix_def[NUM_PREFIX] =   /* é è¨­çš„é¡åˆ¥ */
  {
    "å…¬å‘Š", "æ¸¬è©¦", "é–’èŠ", "çŒæ°´", "ç„¡èŠ", "æ‰“æ··"
  };

  if (!(bbstate & STAT_BOARD))
    return XO_NONE;

  i = vans("é¡åˆ¥ (D)åˆªé™¤ (E)ä¿®æ”¹ (Q)å–æ¶ˆï¼Ÿ[E] ");

  if (i == 'q')
    return XO_FOOT;

  brd_fpath(fpath, currboard, "prefix");

  if (i == 'd')
  {
    unlink(fpath);
    return XO_FOOT;
  }

  i = 0;

  if (fp = fopen(fpath, "r"))
  {
    for (; i < NUM_PREFIX; i++)
    {
      if (fscanf(fp, "%10s", buf) != 1)
        break;
      sprintf(prefix[i], "%d.%s", i + 1, buf);
    }
    fclose(fp);
  }

  /* å¡«æ»¿è‡³ NUM_PREFIX å€‹ */
  for (; i < NUM_PREFIX; i++)
    sprintf(prefix[i], "%d.%s", i + 1, prefix_def[i]);

  menu[0] = "10";
  for (i = 1; i <= NUM_PREFIX; i++)
    menu[i] = prefix[i - 1];
  menu[NUM_PREFIX + 1] = "0.é›¢é–‹";
  menu[NUM_PREFIX + 2] = NULL;

  do
  {
    /* åœ¨ popupmenu è£¡é¢æŒ‰ å·¦éµ é›¢é–‹ */
    i = pans(3, 20, "æ–‡ç« é¡åˆ¥", menu) - '0';
    if (i >= 1 && i <= NUM_PREFIX)
    {
      strcpy(buf, prefix[i - 1] + 2);
      if (vget(b_lines, 0, "é¡åˆ¥ï¼š", buf, 10, GCARRY))
        strcpy(prefix[i - 1] + 2, buf);
    }
  } while (i);

  if (fp = fopen(fpath, "w"))
  {
    for (i = 0; i < NUM_PREFIX; i++)
      fprintf(fp, "%s ", prefix[i] + 2);
    fclose(fp);
  }

  return XO_FOOT;
}
#endif      /* POST_PREFIX */

: manage.c:post_manage()

    "WMemo   ç·¨è¼¯é€²æ¿ç•«é¢",
+#ifdef POST_PREFIX
+   "RPrefix ç·¨è¼¯æ–‡ç« é¡åˆ¥",
+#endif

  ...
  ...

- char *menu = "â— æ¿ä¸»é¸å–® (B)ä¸»é¡Œ (W)é€²æ¿ (M)å‰¯æ¿"
+ char *menu = "â— æ¿ä¸»é¸å–® (B)ä¸»é¡Œ (W)é€²æ¿ (R)é¡åˆ¥ (M)å‰¯æ¿"

  ...
  ...

  case 'w':
    return post_memo_edit(xo);

+#ifdef POST_PREFIX
+ case 'r':
+   return post_prefix_edit(xo);
+#endif

: post.c:do_post()

  else          /* itoc.020113: æ–°æ–‡ç« é¸æ“‡æ¨™é¡Œåˆ†é¡ */
  {
#define NUM_PREFIX 6
+   FILE *fp;
+   char prefix[NUM_PREFIX][10];
-   char *prefix[NUM_PREFIX] =
+   char *prefix_default[NUM_PREFIX] =
      {"[å…¬å‘Š] ", "[æ–°è] ", "[é–’èŠ] ", "[æ–‡ä»¶] ", "[å•é¡Œ] ", "[æ¸¬è©¦] "};

+   for (mode = 0; mode < NUM_PREFIX; mode++)
+     strcpy(prefix[mode], prefix_default[mode]);
+   brd_fpath(fpath, currboard, "prefix");
+   if (fp = fopen(fpath, "r"))
+   {
+     for (mode = 0; mode < NUM_PREFIX; mode++)
+     {
+       if (fscanf(fp, "%9s", fpath) != 1)
+         break;
+       strcpy(prefix[mode], fpath);
+     }
+   }

    move(21, 0);
    outs("é¡åˆ¥ï¼š");
    for (mode = 0; mode < NUM_PREFIX; mode++)
      prints("%d.%s", mode + 1, prefix[mode]);

    mode = vget(20, 0, "è«‹é¸æ“‡æ–‡ç« é¡åˆ¥ï¼ˆæŒ‰ Enter è·³éï¼‰ï¼š",
      fpath, 3, DOECHO) - '1';
    if (mode >= 0 && mode < NUM_PREFIX)         /* è¼¸å…¥æ•¸å­—é¸é … */
      rcpt = prefix[mode];
    else                                        /* ç©ºç™½è·³é */
      rcpt = NULL;
  }

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ [32mnctu5566.Dorm3.NCTU.edu.tw[37m ç™¼è¡¨[m
