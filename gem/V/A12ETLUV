發信人: guessi.bbs@cpu.tfcis.org (沒) 看板: plan
標  題: [修正] post_delete 判斷修正
發信站: 動力核心 (2006/08/21 Mon 15:10:04)                Updated: 2006/08/25

刪除文章判斷修正 :p


原  本: 板主、站務刪文[deleted] 其他[junk] [1;30m註:只判斷bbstate[m
        站務若不為板主 刪除自己張貼的文章 也送到[deleted] 不太妥

修正後:

 [1;30m(表格說明)[m
┌───────┬────────┬───────┬─────┐
│使 用 者 權 限│ 是 否 為 板 主 │ 是否為貼文者 │ 刪文後...│
├───────┼────────┼───────┼─────┤
│一 般 使 用 者│       是       │      是      │ deleted  │
├───────┼────────┼───────┼─────┤
│一 般 使 用 者│       是       │      否      │ deleted  │
├───────┼────────┼───────┼─────┤
│一 般 使 用 者│       否       │      是      │ junk     │
├───────┼────────┼───────┼─────┤
│一 般 使 用 者│       否       │      否      │ ──── │ 註: 不會發生
├───────┼────────┼───────┼─────┤
│  站 務 人 員 │       是       │      是      │ deleted  │
├───────┼────────┼───────┼─────┤
│  站 務 人 員 │       是       │      否      │ deleted  │
├───────┼────────┼───────┼─────┤
│  站 務 人 員 │       否       │      是      │ junk     │
├───────┼────────┼───────┼─────┤
│  站 務 人 員 │       否       │      否      │ deleted  │
└───────┴────────┴───────┴─────┘

判斷順序:

 0. 判斷bbstate
 1. 板主列表是否為空
 2. 是否於板主列表內
 2.1 若在列表內 一律送到[deleted]
 2.2 若不為板主 判斷是否為貼文者
 2.2.1 若為貼文者 送到[junk]
 2.2.2 反之 則送至[deleted]

 若該看板無板主 且可刪文者 即為站務 文章送至[deleted]

[32m:/src/maple/post.c:post_delete()[m

+ char *blist;

  ...
  ...


- by_BM = bbstate & STAT_BOARD;

+ blist = (bshm->bcache + brd_bno(currboard))->BM; /* bm list */

+ if (bbstate & STAT_BOARD) /* 先判斷 bbstate 若否則跳出 */
+ {
+   if (HAS_PERM(PERM_BM) &&        /* 是否擁有 PERM_BM   */
+       blist[0] > ' ' &&           /* 板主欄位是否為空   */
+       is_bm(blist, cuser.userid)) /* 使用者是否在列表中 */
+     by_BM = 1;                    /* 如果是板主         */
+   else                            /* 若板主欄位空 或不是板主 */
+   {
+     if (!str_cmp(hdr->owner, cuser.userid))
+       by_BM = 0; /* 砍自己的文章 */
+     else
+       by_BM = 1; /* 站務砍文 */
+   }
+ }
+ else /* 一般情況 */
+   by_BM = 0;



--
有錯誤 或少判斷的情況 請指正

--
[1;36m=[37m[[36m﹎[37m:[33m?[37m摃?[m◣?[1;33m?[37m:[36m﹎ [31mOrigin[37m ]|[[m  [0;31m?[1m?[1m?[0;31mO[0;31m?[1m?[1m?[0;31m?[1mcpu.tfcis.org  [37m]|[?[33m搟說[m?[1;36m﹎[37m:][36m=[m
[1;36m=[0m[[1;36m﹊[37m:[33m?[30m摃?[m╱?[1;33m?[37m:[36m﹊ [31mAuthor[m ]|[[1m61-231-213-100.dynamic.hin[m]|[?[1;33m?[30m?[37m插[30m?[36m﹊[37m:[m][1;36m=[m
