ä½œè€…: itoc (ç«™ä¸Šäººæ•¸ï¼š802) çœ‹æ¿: plan
æ¨™é¡Œ: [åŠŸèƒ½] æ–‡ç« å¯ä»¥è®“æ‰€æœ‰äººç·¨è¼¯
æ™‚é–“: 2007/03/21 Wed 22:23:43                           Updated: 2007/04/26

â€» å¼•è¿°ã€Špokky (æ„›ä½ )ã€‹ä¹‹éŠ˜è¨€ï¼š
>   å¯æ˜¯æˆ‘æƒ³å•ä½ æœ‰æ²’æœ‰BBS åŠŸèƒ½å¯ä»¥åƒç¶­åŸºç™¾ç§‘é‚£æ¨£
>   å°±æ˜¯æ–‡ç« å¯ä»¥è®“æ‰€æœ‰çš„ä½¿ç”¨è€…æ”¹ä¾†æ”¹å»
>   æ¯”å¦‚èªªä¸æ˜¯å¸¸æœ‰å«å¤§å®¶repostè¦ä¸è¦å»å®¶èšä¹‹é¡çš„
>   å¦‚æœèªªå¯ä»¥ä¸€ç¯‡æ–‡ç« è®“æ‰€æœ‰çœ‹åˆ°çš„äººéƒ½é€²å»ç·¨è¼¯
>   é€™æ¨£ç‰ˆé¢å°±æœƒçœ‹èµ·ä¾†ä¹¾æ·¨å¾ˆå¤šï½

: struct.h

- #define POST_3          0x00000004
+ #define POST_WIKI       0x00000004

: post.c:post_attr()

  if (mode & POST_MARKED)
    attr |= 'M';
+ else if (mode & POST_WIKI)
+   attr |= 'W';
  else if (!attr)
    attr = '+';

: post.c:post_edit()

  hdr = (HDR *) xo_pool + (xo->pos - xo->top);

+#ifdef HAVE_REFUSEMARK
+   if (!chkrestrict(hdr))
+     return XO_NONE;
+#endif

  hdr_fpath(fpath, xo->dir, hdr);

  if (HAS_PERM(PERM_ALLBOARD))                  /* ç«™é•·ä¿®æ”¹ */
  {
-#ifdef HAVE_REFUSEMARK
-   if (!chkrestrict(hdr))
-     return XO_NONE;
-#endif
    vedit(fpath, 0);
  }
- else if (cuser.userlevel && !strcmp(hdr->owner, cuser.userid))
+ else if (cuser.userlevel && (!strcmp(hdr->owner, cuser.userid) ||
+   (hdr->xmode & POST_WIKI)))

: post.c:post_wiki() æ–°å¢åœ¨ post_mark() å¾Œé¢

static int
post_wiki(xo)
  XO *xo;
{
  HDR *hdr;
  int pos, cur, xmode;

  if (!cuser.userlevel) /* itoc.020114: guest ä¸èƒ½å°å…¶ä»– guest çš„æ–‡ç« ç¶­åŸº */
    return XO_NONE;

  pos = xo->pos;
  cur = pos - xo->top;
  hdr = (HDR *) xo_pool + cur;

  if (!strcmp(hdr->owner, cuser.userid) || (bbstate & STAT_BOARD))
  {
    xmode = hdr->xmode;

#ifdef HAVE_LABELMARK
    if (xmode & POST_DELETE)    /* å¾…ç çš„æ–‡ç« ä¸èƒ½ wiki */
      return XO_NONE;
#endif

    hdr->xmode = xmode ^ POST_WIKI;
    currchrono = hdr->chrono;
    rec_put(xo->dir, hdr, sizeof(HDR), pos, cmpchrono);

    move(3 + cur, 7);
    outc(post_attr(hdr));
  }
  return XO_NONE;
}

: post.c:post_cb[]

+ Ctrl('W'), post_wiki,

  'h', post_help

> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <

  è¢«ç·¨è¼¯éå°±è¨˜éŒ„èµ·ä¾† (é€™è£¡é¸æ“‡è¨˜éŒ„åœ¨ã€Œç²¾è¯å€ç•°å‹•ã€)
  é€™æ¨£å°±å¯ä»¥çŸ¥é“å“ªç¯‡æ–‡ç« è¢« wiki && è¢«èª° wiki

: gem.c:gem_log()

- static void
+ void
gem_log(folder, action, hdr)

: maple.p

void brd2gem(BRD *brd, HDR *gem);
+ void gem_log(char *folder, char *action, HDr *hdr) ;

: post.c:post_edit()

  else if (cuser.userlevel && (!strcmp(hdr->owner, cuser.userid) ||
    (hdr->xmode & POST_WIKI)))

..
..

+ if (hdr->xmode & POST_WIKI)
+ {
+   /* bluesway.070323: å€Ÿfpath ä¾†å­˜ç²¾è¯å€è·¯å¾‘ */
+   gec_fpath(fpath, currboard, fn_dir);
+   gem_log(fpath, "Wiki", hdr);
+ }

  post_head(xo);

--
[1;37mâ–¡ æœ¬æ–‡ç« ç”± [33mitoc[37m å¾ [32m218-168-180-20.dynamic.hinet.net[37m ç™¼è¡¨[m
